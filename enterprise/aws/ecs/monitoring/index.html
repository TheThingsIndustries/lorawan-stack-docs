<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.134.2">
  <title>Monitoring | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/enterprise/aws/ecs/monitoring/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.d3f3815ed6609abc2ba6d0d6e3be8af6f52947117280c3cf9fbd8f5ff6ffb058.css" integrity="sha256-0/OBXtZgmrwrptDW476K9vUpRxFygMPPn72PX/b/sFg=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Monitoring">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Monitoring">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/enterprise/aws/ecs/monitoring/">
  <meta property="og:image" content="/docs/docs-thumbnail.png"/>
  <meta name="twitter:title" content="Monitoring" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NGRDCNM');</script>



  <link rel="stylesheet" href="https://ttui.thethingsindustries.com/release/1.10.1/main.css" />
</head>


<body class="theme-tts">


<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NGRDCNM"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
      </a><div class="navbar-item navbar-search-menu" id="search-input-menu">
          </div>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/concepts/">Concepts</a>
        <a class="navbar-item" href="/docs/cloud/">The Things Stack Cloud</a>
        <a class="navbar-item" href="/docs/enterprise/">The Things Stack Enterprise</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/api/">API</a>
        <a class="navbar-item" href="/docs/hardware/">Hardware</a>

      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://www.thethingsindustries.com/stack/plans/" target="_blank">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
  <script type="text/javascript">
    docsearch({
      appId: "608OILUBK2",
      apiKey: "39082cdce449b93b2aa806b44f6af4d2",
      indexName: "thethingsstack",
      container: '#search-input-menu',
      debug: false, 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">The Things Stack Enterprise</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/enterprise/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/aws/" class="">AWS</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/aws/ami/" class="">AWS Marketplace AMI</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/aws/ecs/" class="">AWS ECS</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/aws/ecs/architecture/" class="">Architecture</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/aws/ecs/prerequisites/" class="">Prerequisites</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/aws/ecs/deployment/" class="">Deployment</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/aws/ecs/database-operations/" class="">Database Operations</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/aws/ecs/monitoring/" class="is-active">Monitoring</a>
    
    



    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/aws/ecs/updating/" class="">Updating</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/aws/ecs/best-practices/" class="">Best Practices</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/aws/ecs/interop/" class="">Interoperability</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/aws/ecs/mutual-tls/" class="">Mutual TLS</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/aws/ecs/troubleshooting/" class="">Troubleshooting AWS ECS Deployment</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/aws/ecs/changelog/" class="">Template Changelog</a>
    
  </li>

</ul>


    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/kubernetes/" class="">Kubernetes</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/docker/" class="">Docker</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/join-server/" class="">The Things Join Server</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/enterprise/management/" class="">Manage The Things Stack</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        
        
        <h1 class="title is-size-2">Monitoring</h1>
        <div class="content">
          <p>This page describes how you can monitor a The Things Stack deployment on AWS ECS.</p>
<p>One of the <a href="https://www.thethingsindustries.com/docs/enterprise/aws/ecs/deployment/">deployment steps</a> was to deploy the &ldquo;Monitoring&rdquo; stack. This installed <a href="https://prometheus.io/">Prometheus</a> into your cluster.</p>
<p>The provided Prometheus image already comes with a number of recording and alerting rules that are useful for most (if not all) deployments.</p>
<h2 id="alerts">Alerts</h2>
<p>For all ECS services that form your The Things Stack deployment, the following alerts are defined:</p>
<ul>
<li><code>NoIdentityServers</code> (The cluster does not have any Identity Server instances). This means that there are no ECS tasks for the Identity Server component.</li>
<li><code>SomeIdentityServersDown</code> (Some Identity Server instances of The Things Stack are down). This means that some of the Identity Server instances are not responding. In many cases the deployment will still be online, as requests are routed to other instances.</li>
<li><code>AllIdentityServersDown</code> (All Identity Server instances of The Things Stack are down). This means that none of the Identity Server instances is responding.</li>
</ul>
<p>Similar alerts are defined for the Gateway Server, Network Server, Application Server, Join Server, etc.</p>
<p>For the deployment as a whole, the following alerts are defined:</p>
<ul>
<li><code>InternalServerErrors</code> (An instance is returning responses with 500 codes).</li>
<li><code>UpcomingCertificateExpiry</code> (A TLS certificate expires in less than 14 days).</li>
<li><code>CertificateExpired</code> (A TLS certificate has expired).</li>
<li><code>IncreasedLatency</code> (An instance is experiencing increased latency).</li>
<li><code>UpcomingLicenseExpiry</code> (The Things Stack license expires in less than 14 days).</li>
<li><code>LicenseExpired</code> (The Things Stack license expired).</li>
</ul>
<p>For several components there are alerts that fire when traffic patterns deviate from &ldquo;usual&rdquo; traffic:</p>
<ul>
<li><code>GatewayServerReceivedUplinkTrafficDrop</code> (The Gateway Server of The Things Stack received less uplink traffic than usual). This alert includes the protocol (UDP, MQTT, WS), so make sure to look at that when this alert fires.</li>
<li><code>GatewayServerForwardedUplinkTrafficDrop</code> (The Gateway Server of The Things Stack forwarded less uplink traffic than usual). This alert includes the host (cluster, packet broker), so make sure to look at that when this alert fires. If the host is &ldquo;cluster&rdquo;, there may be an issue with the Network Server. If the host is &ldquo;packetbroker&rdquo;, there may be an issue with the Packet Broker Agent.</li>
<li><code>NetworkServerReceivedUplinkTrafficDrop</code> (The Network Server of The Things Stack received less uplink traffic than usual).</li>
<li><code>ApplicationServerReceivedUplinkTrafficDrop</code> (The Application Server of The Things Stack received less uplink traffic than usual).</li>
</ul>
<p>Similar alerts for downlink traffic will be added in the future.</p>
<h2 id="metrics">Metrics</h2>
<p>In addition to the <a href="https://www.thethingsindustries.com/docs/concepts/advanced/telemetry/">metrics exported by The Things Stack</a>, the provided Prometheus image adds a number of recording rules that provide the input for the previously described alerting rules, but can also be useful in your dashboards.</p>
<p>For all services the following metrics are recorded:</p>
<ul>
<li><code>ttn_lw_log_messages_rate</code> records the rate of log messages by job (service), namespace and level. This can be useful for monitoring warning and error rates.
<ul>
<li>Before version 3.13.1 this metric was called <code>ttn_lw_log_log_messages_rate</code>.</li>
</ul>
</li>
<li><code>ttn_lw_events_publishes_rate</code> records the rate of published events by event name.</li>
</ul>
<p>For the Gateway Server:</p>
<ul>
<li><code>ttn_lw_gs_connected_gateways:by_protocol</code> and <code>ttn_lw_gs_connected_gateways:by_tenant_id</code> record the number of connected gateways in the cluster.</li>
<li><code>ttn_lw_gs_uplink_received_rate:by_protocol</code> and <code>ttn_lw_gs_uplink_received_rate:by_tenant_id</code> record the rate of uplink messages received by the Gateway Server.</li>
<li><code>ttn_lw_gs_downlink_sent_rate:by_protocol</code> and <code>ttn_lw_gs_downlink_sent_rate:by_tenant_id</code> record the rate of downlink messages sent by the Gateway Server.</li>
<li><code>ttn_lw_gs_status_received_rate:by_protocol</code> and <code>ttn_lw_gs_status_received_rate:by_tenant_id</code> record the rate of status message received by the Gateway Server.</li>
<li><code>ttn_lw_gs_uplink_forwarded_rate:by_host</code> and <code>ttn_lw_gs_uplink_forwarded_rate:by_tenant_id</code> record the rate of messages forwarded to the Network Server or Packet Broker. The <code>by_tenant_id</code> only considers messages forwarded to the Network Server.</li>
<li><code>ttn_lw_gs_uplink_dropped_rate:by_host</code> and <code>ttn_lw_gs_uplink_dropped_rate:by_tenant_id</code> record the rate of messages that are dropped for various reasons.</li>
</ul>
<p>For some of these metrics, there are also variants with <code>:avg</code> and <code>:stddev</code> suffixes that can be used for anomaly detection, and are therefore also used in alerting rules.</p>
<p>For the Packet Broker Agent:</p>
<ul>
<li><code>ttn_lw_pba_uplink_received_rate</code> record the rate of uplink messages received from Packet Broker (as a home network).</li>
<li><code>ttn_lw_pba_downlink_forwarded_rate</code> record the rate of downlink messages sent to Packet Broker (as a home network).</li>
<li><code>ttn_lw_pba_downlink_received_rate</code> record the rate of downlink messages received from Packet Broker (as a forwarder).</li>
<li><code>ttn_lw_pba_uplink_forwarded_rate</code> record the rate of uplink messages sent to Packet Broker (as a forwarder).</li>
</ul>
<p>For the Network Server:</p>
<ul>
<li><code>ttn_lw_ns_uplink_received_rate</code> and <code>ttn_lw_ns_uplink_received_rate:by_tenant_id</code> record the rate of uplink messages received from the Gateway Server or Packet Broker.</li>
<li><code>ttn_lw_ns_uplink_duplicates_rate:by_tenant_id</code> records the rate of duplicate uplinks that are merged into a single uplink.</li>
<li><code>ttn_lw_ns_uplink_processed_rate</code> and <code>ttn_lw_ns_uplink_processed_rate:by_tenant_id</code> record the rate of processed uplinks, meaning uplinks that are matched to a device.</li>
<li><code>ttn_lw_ns_uplink_forwarded_rate</code> and <code>ttn_lw_ns_uplink_forwarded_rate:by_tenant_id</code> record the rate of uplinks forwarded to an Application Server.</li>
<li><code>ttn_lw_ns_uplink_dropped_rate:by_tenant_id</code> records the rate of uplinks that are dropped for various reasons.</li>
<li><code>ttn_lw_ns_downlink_attempted_rate</code> and <code>ttn_lw_ns_downlink_attempted_rate:by_tenant_id</code> record the rate of attempted downlink messages; <code>ttn_lw_ns_downlink_forwarded_rate</code> and <code>ttn_lw_ns_downlink_forwarded_rate:by_tenant_id</code> the rate of forwarded downlink messages.</li>
</ul>
<p>For some of these metrics, there are also variants with <code>:avg</code> and <code>:stddev</code> suffixes that can be used for anomaly detection, and are therefore also used in alerting rules.</p>
<p>For the Application Server:</p>
<ul>
<li><code>ttn_lw_as_subscriptions:by_protocol</code> and <code>ttn_lw_as_subscriptions:by_tenant_id</code> record the number of active uplink subscriptions from integrations and external applications.</li>
<li><code>ttn_lw_as_pubsub_integrations:by_provider</code> and <code>ttn_lw_as_pubsub_integrations:by_tenant_id</code> record the number of active pub/sub integrations.</li>
<li><code>ttn_lw_as_uplink_received_rate</code> and <code>ttn_lw_as_uplink_received_rate:by_tenant_id</code> record the rate of uplink messages received from the Network Server.</li>
<li><code>ttn_lw_as_uplink_forwarded_rate</code> and <code>ttn_lw_as_uplink_forwarded_rate:by_tenant_id</code> record the rate of uplink messages forwarded to integrations and external applications.</li>
<li><code>ttn_lw_as_uplink_dropped_rate:by_tenant_id</code> records the rate of uplink messages dropped for various reasons.</li>
<li><code>ttn_lw_as_downlink_received_rate</code> and <code>ttn_lw_as_downlink_received_rate:by_tenant_id</code> record the rate of downlink messages received from integrations and external applications.</li>
<li><code>ttn_lw_as_downlink_forwarded_rate</code> and <code>ttn_lw_as_downlink_forwarded_rate:by_tenant_id</code> record the rate of downlink messages forwarded to the Network Server.</li>
<li><code>ttn_lw_as_downlink_dropped_rate:by_tenant_id</code> records the rate of downlink messages dropped for various reasons.</li>
</ul>
<p>For some of these metrics, there are also variants with <code>:avg</code> and <code>:stddev</code> suffixes that can be used for anomaly detection, and are therefore also used in alerting rules.</p>
<p>For the Join Server:</p>
<ul>
<li><code>ttn_lw_js_join_accepted_rate:by_tenant_id</code> and <code>ttn_lw_js_join_rejected_rate:by_tenant_id</code> record the rate of accepted and rejected join requests.</li>
</ul>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>Sometimes the monitoring service fails with <code>Essential container in task exited</code> error. This is often caused by insufficient resources. Therefore you can:</p>
<ol>
<li>
<p>Set <code>UseLongTermStorage</code> to <code>false</code> in order to disable Thanos and allow Prometheus use more of the assigned resources.</p>
</li>
<li>
<p>Increase memory available to the Prometheus task. A value of 2GB should be sufficient in almost all cases.</p>
</li>
</ol>
        </div>
          <div class="columns is-multiline">
</div>

          <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/enterprise/aws/ecs/database-operations/">← Database Operations</a>
<a class="button is-pulled-right" href="/docs/enterprise/aws/ecs/updating/">Updating →</a>
</div>

          <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#alerts'>Alerts</a></li>
    
      
      <li><a href='#metrics'>Metrics</a></li>
    
      
      <li><a href='#troubleshooting'>Troubleshooting</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-third">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/concepts/">Concepts</a></p>
        <p><a class="" href="/docs/cloud/">The Things Stack Cloud</a></p>
        <p><a class="" href="/docs/enterprise/">The Things Stack Enterprise</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/api/">API</a></p>
        <p><a class="" href="/docs/hardware/">Hardware</a></p>
      </nav>
      <nav class="column is-one-third">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
      </nav>
      
      <nav class="column is-one-third">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.3bf0da17f5ab4cc0f916662c2d2f977f7fa7259b4483f7f9eb46e875a556cc43.js" integrity="sha256-O/DaF/WrTMD5FmYsLS&#43;Xf3&#43;nJZtEg/f560bodaVWzEM=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
