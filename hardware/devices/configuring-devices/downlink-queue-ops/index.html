<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.140.0-DEV">
  <title>Downlink Queue Operations | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/hardware/devices/configuring-devices/downlink-queue-ops/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.d3f3815ed6609abc2ba6d0d6e3be8af6f52947117280c3cf9fbd8f5ff6ffb058.css" integrity="sha256-0/OBXtZgmrwrptDW476K9vUpRxFygMPPn72PX/b/sFg=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Downlink Queue Operations">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Downlink Queue Operations">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/hardware/devices/configuring-devices/downlink-queue-ops/">
  <meta property="og:image" content="/docs/docs-thumbnail.png"/>
  <meta name="twitter:title" content="Downlink Queue Operations" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NGRDCNM');</script>



  <link rel="stylesheet" href="https://ttui.thethingsindustries.com/release/1.10.1/main.css" />
</head>


<body class="theme-tts">


<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NGRDCNM"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
      </a><div class="navbar-item navbar-search-menu" id="search-input-menu">
          </div>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/concepts/">Concepts</a>
        <a class="navbar-item" href="/docs/cloud/">The Things Stack Cloud</a>
        <a class="navbar-item" href="/docs/enterprise/">The Things Stack Enterprise</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/api/">API</a>
        <a class="navbar-item" href="/docs/hardware/">Hardware</a>

      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://www.thethingsindustries.com/stack/plans/" target="_blank">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
  <script type="text/javascript">
    docsearch({
      appId: "608OILUBK2",
      apiKey: "39082cdce449b93b2aa806b44f6af4d2",
      indexName: "thethingsstack",
      container: '#search-input-menu',
      debug: false, 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Hardware</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/hardware/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/hardware/devices/" class="">Devices</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/hardware/devices/adding-devices/" class="">Adding Devices</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/hardware/devices/configuring-devices/" class="">Configuring Devices</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/hardware/devices/configuring-devices/device-location/" class="">Device location settings</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/hardware/devices/configuring-devices/mac-settings/" class="">MAC Settings</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/hardware/devices/configuring-devices/class-b/" class="">Class B Settings</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/hardware/devices/configuring-devices/class-c/" class="">Class C Settings</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/hardware/devices/configuring-devices/multicast/" class="">Multicast Groups</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/hardware/devices/configuring-devices/downlink-queue-ops/" class="is-active">Downlink Queue Operations</a>
    
    



    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/hardware/devices/configuring-devices/payload-crypto-override/" class="">Payload Crypto Override</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/hardware/devices/configuring-devices/relay-settings/" class="">Relay Settings</a>
    
  </li>

</ul>


    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/hardware/devices/concepts/" class="">Concepts</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/hardware/devices/models/" class="">Models</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/hardware/devices/troubleshooting/" class="">Troubleshooting Devices</a>
    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/hardware/gateways/" class="">Gateways</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/hardware/works-with/" class="">Works with The Things Stack</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        
        
        <h1 class="title is-size-2">Downlink Queue Operations</h1>
        <div class="content">
          <p>The Things Stack keeps a queue of downlink messages per device. Applications can keep pushing downlink messages or replace the queue with a list of downlink messages.</p>
<p>You can schedule a downlink using the CLI, MQTT or HTTP webhooks.</p>
<p>To schedule downlinks using MQTT, see <a href="https://www.thethingsindustries.com/docs/integrations/other-integrations/mqtt/">MQTT Server</a>. To schedule downlinks using webhooks, see <a href="https://www.thethingsindustries.com/docs/integrations/webhooks/scheduling-downlinks/">Scheduling Downlinks with Webhooks</a>.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  See the <a href="https://www.thethingsindustries.com/docs/hardware/devices/concepts/confirmed-downlinks-behavior/">Confirmed Downlinks Behavior</a> section to learn how confirmed downlinks behavior for class B and class C devices differs from confirmed downlinks behavior for class A devices.
</div>

<p>This guide shows how to interact with the downlink queue from the command-line interface (CLI).</p>
<div class="notification is-primary is-light has-text-dark">
  <h3 class="title has-text-dark mb-1">Command-line interface only</h3>
  <p>The instructions below use the command-line interface (CLI).</p>
  
  
  <div class="buttons">
    <a class="button is-dark is-outlined" href="https://www.thethingsindustries.com/docs/concepts/features/cli/installing-cli/">Learn how to install the CLI</a>
  </div>
</div>

<p>If there are more application downlink messages in the queue, the Network Server sets the LoRaWAN® <code>FPending</code> bit to indicate end devices that there is more downlinks available. In class A downlink, this typically triggers the device to send an uplink message to receive the downlink message. In class C, the Network Server automatically transmits all queued downlink messages.</p>
<p>We define some user parameters that will be used below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">APP_ID</span><span class="o">=</span><span class="s2">&#34;app1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">DEVICE_ID</span><span class="o">=</span><span class="s2">&#34;dev1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">PAYLOAD</span><span class="o">=</span><span class="s2">&#34;01020304&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">PRIORITY</span><span class="o">=</span><span class="s2">&#34;NORMAL&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">F_PORT</span><span class="o">=</span><span class="s2">&#34;42&#34;</span>
</span></span></code></pre></div><p>Make sure to modify these according to your setup.</p>
<h2 id="push-and-replace-downlink-queue">Push and replace downlink queue</h2>
<p>To push downlink to the end of the queue:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices downlink push <span class="nv">$APP_ID</span> <span class="nv">$DEVICE_ID</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --frm-payload <span class="nv">$PAYLOAD</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --priority <span class="nv">$PRIORITY</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --f-port <span class="nv">$F_PORT</span>
</span></span></code></pre></div><p>You must pass an <code>FPort</code> with the <code>--f-port</code> flag. Confirmed downlinks can be set using <code>--confirmed</code>.</p>
<p>To replace the existing queue with a new item:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices downlink replace <span class="nv">$APP_ID</span> <span class="nv">$DEVICE_ID</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --frm-payload <span class="nv">$PAYLOAD</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --priority <span class="nv">$PRIORITY</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --f-port <span class="nv">$F_PORT</span>
</span></span></code></pre></div><p>The Things Stack limits the application downlink queue on 10k messages per end device. When this limit is reached, no more scheduled downlinks can be placed in the queue and The Things Stack will drop them. In order to avoid hitting the application downlink queue limit and loosing downlinks, we advise scheduling downlink messages in batches.</p>
<h2 id="list-queue">List queue</h2>
<p>To see currently scheduled downlink messages:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices downlink list <span class="nv">$APP_ID</span> <span class="nv">$DEVICE_ID</span>
</span></span></code></pre></div><h2 id="clear-queue">Clear queue</h2>
<p>To clear scheduled downlink messages:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices downlink clear <span class="nv">$APP_ID</span> <span class="nv">$DEVICE_ID</span>
</span></span></code></pre></div>
        </div>
          <div class="columns is-multiline">
</div>

          <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/hardware/devices/configuring-devices/multicast/">← Multicast Groups</a>
<a class="button is-pulled-right" href="/docs/hardware/devices/configuring-devices/payload-crypto-override/">Payload Crypto Override →</a>
</div>

          <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#push-and-replace-downlink-queue'>Push and replace downlink queue</a></li>
    
      
      <li><a href='#list-queue'>List queue</a></li>
    
      
      <li><a href='#clear-queue'>Clear queue</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-fourth">
        <h3 class="title is-6">Sections</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/concepts/">Concepts</a></p>
        <p><a class="" href="/docs/cloud/">The Things Stack Cloud</a></p>
        <p><a class="" href="/docs/enterprise/">The Things Stack Enterprise</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/api/">API</a></p>
        <p><a class="" href="/docs/hardware/">Hardware</a></p>
      </nav>
      <nav class="column is-one-fourth">
        <h3 class="title is-6">Sitemap</h3>
        <p><a class="" href="https://www.thethingsindustries.com/docs/sitemap/">View our Sitemap</a></p>
      </nav>
      <nav class="column is-one-fourth">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
      </nav>
      
      <nav class="column is-one-fourth">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.3bf0da17f5ab4cc0f916662c2d2f977f7fa7259b4483f7f9eb46e875a556cc43.js" integrity="sha256-O/DaF/WrTMD5FmYsLS&#43;Xf3&#43;nJZtEg/f560bodaVWzEM=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
