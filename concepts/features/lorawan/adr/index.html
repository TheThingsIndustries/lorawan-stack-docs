<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.140.0-DEV">
  <title>Adaptive Data Rate | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/concepts/features/lorawan/adr/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.d3f3815ed6609abc2ba6d0d6e3be8af6f52947117280c3cf9fbd8f5ff6ffb058.css" integrity="sha256-0/OBXtZgmrwrptDW476K9vUpRxFygMPPn72PX/b/sFg=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Adaptive Data Rate">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Adaptive Data Rate">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/concepts/features/lorawan/adr/">
  <meta property="og:image" content="/docs/docs-thumbnail.png"/>
  <meta name="twitter:title" content="Adaptive Data Rate" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NGRDCNM');</script>



  <link rel="stylesheet" href="https://ttui.thethingsindustries.com/release/1.10.1/main.css" />
</head>


<body class="theme-tts">


<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NGRDCNM"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
      </a><div class="navbar-item navbar-search-menu" id="search-input-menu">
          </div>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/concepts/">Concepts</a>
        <a class="navbar-item" href="/docs/cloud/">The Things Stack Cloud</a>
        <a class="navbar-item" href="/docs/enterprise/">The Things Stack Enterprise</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/api/">API</a>
        <a class="navbar-item" href="/docs/hardware/">Hardware</a>

      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://www.thethingsindustries.com/stack/plans/" target="_blank">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
  <script type="text/javascript">
    docsearch({
      appId: "608OILUBK2",
      apiKey: "39082cdce449b93b2aa806b44f6af4d2",
      indexName: "thethingsstack",
      container: '#search-input-menu',
      debug: false, 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Concepts</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/concepts/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/concepts/architecture/" class="">Architecture</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/concepts/features/" class="">Features</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/concepts/features/console/" class="">Console</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/concepts/features/cli/" class="">Command-line Interface</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/concepts/features/multitenancy/" class="">Multi-tenancy</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/concepts/features/events/" class="">Gaining insights using Events</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/concepts/features/lorawan/" class="">LoRaWAN</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/concepts/features/lorawan/adr/" class="is-active">Adaptive Data Rate</a>
    
    



    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/concepts/features/lorawan/frequency-plans/" class="">Frequency Plans</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/concepts/features/lorawan/fuota/" class="">FUOTA</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/concepts/features/lorawan/version-support/" class="">LoRaWAN Version Support</a>
    
  </li>

</ul>


    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/concepts/features/sso/" class="">Single Sign-On</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/concepts/features/alerting/" class="">Alerting</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/concepts/features/network-operations-center/" class="">Network Operations Center</a>
    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/concepts/networking/" class="">Networking</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/concepts/migration/" class="">Migrate to The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/concepts/packet-broker/" class="">Packet Broker</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/concepts/server-addresses/" class="">Server Addresses</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/concepts/advanced/" class="">Advanced Topics</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/concepts/troubleshooting/" class="">Troubleshooting</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/concepts/ttn/" class="">The Things Stack Sandbox</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        
        
        <h1 class="title is-size-2">Adaptive Data Rate</h1>
        <div class="content">
          <p>Adaptive Data Rate (ADR) is a mechanism for optimizing data rates, airtime and energy consumption in the network.</p>
<p>This reference documents how ADR is implemented in The Things Stack.</p>
<h2 id="how-adr-works">How ADR Works</h2>
<p>The ADR mechanism controls the following transmission parameters of an end device:</p>
<ul>
<li>Spreading factor</li>
<li>Bandwidth</li>
<li>Transmission power</li>
</ul>
<p>See <a href="https://www.thethingsnetwork.org/docs/lorawan/adaptive-data-rate/">The Things Network LoRaWAN documentation</a> for a general description of ADR. See the <a href="https://www.thethingsnetwork.org/docs/lorawan/spreading-factors/">Spreading Factors</a> section to learn how spreading factor influences data rate, range and battery life.</p>
<p>The Things Stack supports two ADR modes explained below - dynamic and static.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  The <code>use_adr</code> and <code>adr_margin</code> parameters that were previously used to control The Things Stack ADR usage are now deprecated in favor of making ADR algorithm more configurable. The usage of new parameters to control ADR is explained below. To proceed with using below mentioned parameters, make sure to disable old ones using the <code>--unset use-adr,adr-margin</code> flag.
</div>

<h2 id="dynamic-mode">Dynamic Mode</h2>
<p>Dynamic mode represents a default The Things Stack ADR mechanism. In this mode, The Things Stack calculates ADR parameters (data rate, Tx power, number of transmissions per uplink frame) values, but a user can configure the margin and min/max values for the mentioned parameters.</p>
<p>Before configuring this mode, it&rsquo;s useful to know how it actually works, so the default The Things Stack ADR algorithm is explained below.</p>
<h3 id="the-things-stack-adr-algorithm">The Things Stack ADR Algorithm</h3>
<p>This section describes The Things Stack ADR implementation in plain english, with links to the relevant lines of source code in our open source <a href="https://github.com/TheThingsNetwork/lorawan-stack">LoRaWAN Stack Repository</a>.</p>
<p>The Things Stack ADR implementation looks at the signal-to-noise ratio (SNR) to determine the Data Rate and Tx Power, and looks at frame counters to determine packet loss, and set the number of re-transmissions accordingly.</p>
<p>The implementation is based on Semtech&rsquo;s recommended algorithm described in <a href="https://www.thethingsnetwork.org/forum/uploads/default/original/2X/7/7480e044aa93a54a910dab8ef0adfb5f515d14a1.pdf">this document</a>:</p>
<ol>
<li>Determine <a href="https://github.com/TheThingsNetwork/lorawan-stack/blob/5a816e8171f993db9659566286d45725698f032e/pkg/networkserver/mac/adr.go#L218">the maximum SNR over recent transmissions</a></li>
<li>Determine <a href="https://github.com/TheThingsNetwork/lorawan-stack/blob/5a816e8171f993db9659566286d45725698f032e/pkg/networkserver/mac/adr.go#L232">the minimum SNR to demodulate an uplink given the current parameters</a></li>
<li>Calculate <a href="https://github.com/TheThingsNetwork/lorawan-stack/blob/5a816e8171f993db9659566286d45725698f032e/pkg/networkserver/mac/adr.go#L236">the margin to further optimize the data rate</a></li>
</ol>
<ul>
<li>Part of this is configurable per device (if you use the CLI)</li>
<li>If less measurements (uplinks) are available than necessary, <a href="https://github.com/TheThingsNetwork/lorawan-stack/blob/5a816e8171f993db9659566286d45725698f032e/pkg/networkserver/mac/adr.go#L238-L240">include a safety margin</a></li>
</ul>
<ol start="4">
<li><a href="https://github.com/TheThingsNetwork/lorawan-stack/blob/5a816e8171f993db9659566286d45725698f032e/pkg/networkserver/mac/adr.go#L251-L262">Increase the data rate as long as there&rsquo;s enough margin</a></li>
<li>If there&rsquo;s still margin after reaching the maximum data rate, <a href="https://github.com/TheThingsNetwork/lorawan-stack/blob/5a816e8171f993db9659566286d45725698f032e/pkg/networkserver/mac/adr.go#L273-L281">decrease the transmit power</a></li>
<li>Depending on packet loss, <a href="https://github.com/TheThingsNetwork/lorawan-stack/blob/5a816e8171f993db9659566286d45725698f032e/pkg/networkserver/mac/adr.go#L288-L296">increase the number of retransmissions</a></li>
</ol>
<h3 id="enable-and-configure-dynamic-mode">Enable and Configure Dynamic Mode</h3>
<p>To turn on The Things Stack ADR using the <a href="https://www.thethingsindustries.com/docs/concepts/features/cli/">CLI</a>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices <span class="nb">set</span> --application-id &lt;app-id&gt; --device-id &lt;dev-id&gt; --mac-settings.adr.mode.dynamic
</span></span></code></pre></div><p>Values of parameters like data rate index, transmission power index and number of transmissions are calculated by the ADR algorithm, but their minimum and maximum values can be set by the user as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices <span class="nb">set</span> --application-id &lt;app-id&gt; --device-id &lt;dev-id&gt; --mac-settings.adr.mode.dynamic --mac-settings.adr.mode.dynamic.max-data-rate-index &lt;data_rate&gt; --mac-settings.adr.mode.dynamic.max tx-power-index &lt;power_index&gt; --mac-settings.adr.mode.dynamic.max-nb-trans &lt;nb_trans&gt; --mac-settings.adr.mode.dynamic.min-data-rate-index &lt;data_rate&gt; --mac-settings.adr.mode.dynamic.min tx-power-index &lt;power_index&gt; --mac-settings.adr.mode.dynamic.min-nb-trans &lt;nb_trans&gt;
</span></span></code></pre></div><blockquote>
<p>Please note that <code>data_rate</code> in above and following commands is data rate index which can take values from 0-6 (referring to data rate sets DR0-DR6). For example, data rate index 0 implies using SF12 in EU868 freqeuncy plan, as explained <a href="https://www.thethingsnetwork.org/docs/lorawan/regional-parameters/#eu863-870-data-rates">here</a>. You can check out detailed info for your frequency plan in the <a href="https://www.thethingsindustries.com/docs/concepts/features/lorawan/version-support/">Regional Parameters specification</a>.</p>
</blockquote>
<h3 id="configure-adr-margin">Configure ADR Margin</h3>
<p>The Things Stack Network Server calculates the ADR margin to optimize the data rate and Tx power.</p>
<p>Margin is the difference between the gateway&rsquo;s maximum measured SNR and the minimal SNR required to demodulate a message on a given data rate. Margin is used to determine how much data rate can be increased, or how much transmit power can be lowered. Increasing the ADR margin reduces the data rate, leading to a reduced overall network capacity, but also to a lower packet loss rate in lightly loaded networks. Decreasing the ADR margin leads to a data rate increase, network capacity enhancement, but also causes higher packet loss rate.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  We recommend to test the process described below on test devices before implementing it in production. It is also recommended to use different test scenarios to identify which margin best fits your environment.
</div>

<p>The Network Server uses the ADR margin of 15, but this value can be configured per device using the CLI:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices <span class="nb">set</span> --application-id &lt;app-id&gt; --device-id &lt;device-id&gt; --mac-settings.adr.mode.dynamic.margin &lt;float32&gt;
</span></span></code></pre></div><p>Keep in mind that changes to <code>mac-settings.adr.mode.dynamic.&lt;parameter&gt;</code> are persistent and will be present even after a device reset/rejoin. Read the <a href="https://www.thethingsindustries.com/docs/hardware/devices/configuring-devices/mac-settings/">MAC Settings</a> section for detailed info.</p>
<h4 id="examples">Examples</h4>
<p>Consider a device whose SNR values in the last 20 uplink messages were in range from 0 to 7. The data rate of the last received frame from the end device is DR3. Three cases presented below demonstrate how choosing a different ADR margin leads to different outcomes in terms of changing the data rate and Tx power.</p>
<p>In practice, the ADR margin value should be tuned until the optimization target is reached. The optimization target can be different (like battery duration, low packet loss, etc.) in different environments, so a user needs to decide on which margin value to adopt.</p>
<h5 id="case-1-adr-margin-set-to-default">Case 1: ADR margin set to default</h5>
<p>The default ADR margin value in The Things Stack is 15, while the minimum SNR required to demodulate a message for DR3 is 12.5.</p>
<p>First, the maximum SNR is computed for recent uplinks. In this example, the <code>SNRmax</code> is 7.</p>
<p>Then the SNR margin is calculated as follows:</p>
<p>SNR<sub>margin</sub> = SNR<sub>max</sub> - SNR<sub>DR3</sub> - margin<sub>dB</sub> = 7-(-12.5)-15 = 4.5</p>
<p>The final step is to calculate the <code>NStep</code> value to decide whether a data rate can be optimized:</p>
<p>NStep=int(SNR<sub>margin</sub>/2.5) = int (4.5/2.5) = 1</p>
<p>Considering the diagram for acting on an NStep calculation depicted <a href="https://www.thethingsnetwork.org/forum/uploads/default/original/2X/7/7480e044aa93a54a910dab8ef0adfb5f515d14a1.pdf">here</a>, the conclusion for this example is that the Network Server should increase the data rate to DR4.</p>
<h5 id="case-2-adr-margin-set-to-18">Case 2: ADR margin set to 18</h5>
<p>The SNR margin would be:</p>
<p>SNR<sub>margin</sub> = SNR<sub>max</sub> - SNR<sub>DR3</sub> - margin<sub>dB</sub> = 7-(-12.5)-18 = 1.5</p>
<p>The <code>NStep</code> value would be:</p>
<p>NStep=int(SNR<sub>margin</sub>/2.5) = int (1.5/2.5) = 0</p>
<p>In this case, according to the previously mentioned <a href="https://www.thethingsnetwork.org/forum/uploads/default/original/2X/7/7480e044aa93a54a910dab8ef0adfb5f515d14a1.pdf">diagram</a>, the Network Server should not take any action to further optimize the data rate.</p>
<h5 id="case-3-adr-margin-set-to-25">Case 3: ADR margin set to 25</h5>
<p>The SNR margin would be:</p>
<p>SNR<sub>margin</sub> = SNR<sub>max</sub> - SNR<sub>DR3</sub> - margin<sub>dB</sub> = 7-(-12.5)-25 = -5.5</p>
<p>The <code>NStep</code> value would be:</p>
<p>NStep=int(SNR<sub>margin</sub>/2.5) = int (-5.5/2.5) = -1</p>
<p>In this case, according to the previously mentioned <a href="https://www.thethingsnetwork.org/forum/uploads/default/original/2X/7/7480e044aa93a54a910dab8ef0adfb5f515d14a1.pdf">diagram</a>, if Tx power is lower than its maximum, the Network Server should increase it once by 3dB, while the data rate should not be changed.</p>
<h3 id="configure-channel-steering-mode">Configure Channel Steering Mode</h3>
<p>The channel steering modes are only applicable to <code>US915</code> and <code>AU915</code> bands. End devices in these bands can join The Things Stack network via <strong>LoRa</strong> modulated channels with a bandwidth of 500kHz. There is one such channel within a frequency sub band (FBS), and an end device which has joined via a 500kHz channel will only use this channel for transmissions. This behavior is default, and it can be enabled as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices <span class="nb">set</span> --application-id &lt;app-id&gt; --device-id &lt;dev-id&gt; --mac-settings.adr.mode.dynamic --mac-settings.adr.mode.dynamic.channel-steering.disabled
</span></span></code></pre></div><p>The end device can also be steered towards the 125kHz channels, which usually are 8 per frequency sub band (FSB), instead of using a singular 500kHz channel like mentioned above. This mode is called <strong>LoRa narrow</strong> and it can be enabled with:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices <span class="nb">set</span> --application-id &lt;app-id&gt; --device-id &lt;dev-id&gt; --mac-settings.adr.mode.dynamic --mac-settings.adr.mode.dynamic.channel-steering.lora-narrow
</span></span></code></pre></div><h3 id="configure-nbtrans-for-an-end-device-per-data-rate">Configure NbTrans for an End Device per data rate</h3>
<span class="tag is-light">New in 3.30.0</span>


<p>The Things Stack allows you fine-grained access to limit NbTrans per data rate.</p>
<div class="tabs is-boxed">
  <ul>
    
    <li data-tab="cli">
      <a>
        <span>CLI</span>
      </a>
    </li>
    
    <li data-tab="http-rest-api">
      <a>
        <span>HTTP (REST) API</span>
      </a>
    </li>
    
  </ul>
</div>
<div class="tab-content content">
  <section data-content="cli">
  <p>In this example, we are setting the min NbTrans to <code>2</code> and max NbTrans to <code>3</code> for data rate index 5 (SF7 in EU868).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli dev <span class="nb">set</span> app1 eui-1231231231231231 --mac-settings.adr.mode.dynamic.overrides.data-rate-5.min-nb-trans <span class="m">2</span>  --mac-settings.adr.mode.dynamic.overrides.data-rate-5.max-nb-trans <span class="m">3</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;ids&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;device_id&#34;</span>: <span class="s2">&#34;eui-1231231231231231&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;application_ids&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;application_id&#34;</span>: <span class="s2">&#34;app1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;dev_eui&#34;</span>: <span class="s2">&#34;1231231231231231&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;join_eui&#34;</span>: <span class="s2">&#34;1111111111111111&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;created_at&#34;</span>: <span class="s2">&#34;2024-02-29T19:22:43.994254Z&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;updated_at&#34;</span>: <span class="s2">&#34;2024-02-29T19:57:36.896606Z&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;network_server_address&#34;</span>: <span class="s2">&#34;localhost&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;mac_settings&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;adr&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;dynamic&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;overrides&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;data_rate_5&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;min_nb_trans&#34;</span>: <span class="m">3</span>
</span></span><span class="line"><span class="cl">          <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>We can now check that the changes are made.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli dev get app1 eui-1231231231231231 --mac-settings
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;ids&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;device_id&#34;</span>: <span class="s2">&#34;eui-1231231231231231&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;application_ids&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;application_id&#34;</span>: <span class="s2">&#34;app1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;dev_eui&#34;</span>: <span class="s2">&#34;1231231231231231&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;join_eui&#34;</span>: <span class="s2">&#34;1111111111111111&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;created_at&#34;</span>: <span class="s2">&#34;2024-02-29T19:22:43.994254Z&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;updated_at&#34;</span>: <span class="s2">&#34;2024-02-29T19:29:29.322193Z&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;network_server_address&#34;</span>: <span class="s2">&#34;localhost&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;mac_settings&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;rx2_data_rate_index&#34;</span>: 0,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;rx2_frequency&#34;</span>: <span class="s2">&#34;869525000&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;adr&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;dynamic&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;overrides&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;data_rate_5&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;min_nb_trans&#34;</span>: 2,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;max_nb_trans&#34;</span>: <span class="m">3</span>
</span></span><span class="line"><span class="cl">          <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div>
</section>
<section data-content="http-rest-api">
  <p>Since this override is part of the Network Server MAC Settings, we use the <a href="https://www.thethingsindustries.com/docs/api/reference/http/routes/#NsEndDeviceRegistry">NsEndDeviceRegistry API</a> to set this value.</p>
<div>
<table>
  <thead>
      <tr>
          <th>Item</th>
          <th>Value</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Endpoint</td>
          <td><a href="https://www.thethingsindustries.com/docs/api/reference/http/routes/#nsapplications%7Bend_device.ids.application_ids.application_id%7Ddevices%7Bend_device.ids.device_id%7D-put"><code>/ns/applications/{end_device.ids.application_ids.application_id}/devices/{end_device.ids.device_id}</code></a></td>
      </tr>
      <tr>
          <td>Request type</td>
          <td><code>PUT</code></td>
      </tr>
  </tbody>
</table>
</br>
</div>
<p>To set the min NbTrans to <code>2</code> and max NbTrans to <code>3</code> for for data rate index 5 (SF7 in EU868) on <code>thethings.example.com</code>, first create a JSON file named <code>req.json</code> in the same folder with the following example contents.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;end_device&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;mac_settings&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;adr&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;dynamic&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;overrides&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;data_rate_5&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;min_nb_trans&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;max_nb_trans&#34;</span><span class="p">:</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;field_mask&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;paths&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;mac_settings.adr.mode.dynamic.overrides&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The request using <code>cURL</code> is as follows.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -v -X PUT -H <span class="s2">&#34;Content-Type: application/json&#34;</span> -H <span class="s2">&#34;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-d @./req.json https://thethings.example.com/api/v3/ns/applications/test-app/devices/eui-1231231231231231
</span></span></code></pre></div>
</section>

</div>

<h2 id="static-mode">Static Mode</h2>
<p>Besides The Things Stack ADR mechanism described <a href="https://www.thethingsindustries.com/docs/concepts/features/lorawan/adr/#the-things-stack-adr-algorithm">above</a>, The Things Stack also supports using a custom ADR, meaning ADR parameters (data rate, Tx power, number of transmissions per uplink frame) can be controlled manually.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  We recommend to test the process described below on test devices before implementing it in production.
</div>

<p>Before setting ADR parameters to desired values, you first need to turn off the default The Things Stack ADR mechanism. To turn off The Things Stack ADR using the <a href="https://www.thethingsindustries.com/docs/concepts/features/cli/">CLI</a>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices <span class="nb">set</span> --application-id &lt;app-id&gt; --device-id &lt;dev-id&gt; --mac-settings.adr.mode.disabled
</span></span></code></pre></div><blockquote>
<p>Please note that <code>data_rate</code> in above and following commands is data rate index which can take values from 0-6 (referring to data rate sets DR0-DR6). For example, data rate index 0 implies using SF12 in EU868 freqeuncy plan, as explained <a href="https://www.thethingsnetwork.org/docs/lorawan/regional-parameters/#eu863-870-data-rates">here</a>. You can check out detailed info for your frequency plan in the <a href="https://www.thethingsindustries.com/docs/concepts/features/lorawan/version-support/">Regional Parameters specification</a>.</p>
</blockquote>
<p>After The Things Stack ADR mechanism is disabled, the Network Server will no longer try to optimize ADR parameters.</p>
<p>Now you can manually set ADR parameters to desired values using the CLI:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices <span class="nb">set</span> --application-id &lt;app-id&gt; --device-id &lt;dev-id&gt; --mac-settings.adr.mode.static --mac-settings.adr.mode.static.data-rate-index &lt;data_rate&gt; --mac-settings.adr.mode.static.tx-power-index &lt;power_index&gt; --mac-settings.adr.mode.static.nb-trans &lt;nb_trans&gt;
</span></span></code></pre></div><p>Static mode values that you set for ADR parameters need to be supported by the end device based on its MAC and PHY versions, and its frequency plan. Upon receiving a next uplink message, the Network Server schedules a <code>LinkADRReq</code> message with new ADR parameters included.</p>
<p>If the end device accepts all three parameters specified, then it will use them and answer with a <code>LinkADRAns</code> uplink message. We recommend setting all three parameters explicitly to avoid a possible rejection.</p>
<p>Keep in mind that changes to <code>mac-settings.adr.mode.static.&lt;parameter&gt;</code> are persistent and these values will be used even after a device reset/rejoin, until you change them.</p>
        </div>
          <div class="columns is-multiline">
</div>

          <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/concepts/features/lorawan/">← LoRaWAN</a>
<a class="button is-pulled-right" href="/docs/concepts/features/lorawan/frequency-plans/">Frequency Plans →</a>
</div>

          <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#how-adr-works'>How ADR Works</a></li>
    
      
      <li><a href='#dynamic-mode'>Dynamic Mode</a></li>
    
      
      <li><a href='#static-mode'>Static Mode</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-fourth">
        <h3 class="title is-6">Sections</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/concepts/">Concepts</a></p>
        <p><a class="" href="/docs/cloud/">The Things Stack Cloud</a></p>
        <p><a class="" href="/docs/enterprise/">The Things Stack Enterprise</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/api/">API</a></p>
        <p><a class="" href="/docs/hardware/">Hardware</a></p>
      </nav>
      <nav class="column is-one-fourth">
        <h3 class="title is-6">Sitemap</h3>
        <p><a class="" href="https://www.thethingsindustries.com/docs/sitemap/">View our Sitemap</a></p>
      </nav>
      <nav class="column is-one-fourth">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
      </nav>
      
      <nav class="column is-one-fourth">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.3bf0da17f5ab4cc0f916662c2d2f977f7fa7259b4483f7f9eb46e875a556cc43.js" integrity="sha256-O/DaF/WrTMD5FmYsLS&#43;Xf3&#43;nJZtEg/f560bodaVWzEM=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
