<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.70.0" />
  <title>Configuration and Update Server (CUPS) | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/gateways/lora-basics-station/cups/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.e4983b11ba29ba596151c737417276febde11d0ad260a85ea1e39f0f473b9cfb.css" integrity="sha256-5Jg7EbopullhUcc3QXJ2/r3hHQrSYKheoeOfD0c7nPs=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Configuration and Update Server (CUPS)">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Configuration and Update Server (CUPS)">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/gateways/lora-basics-station/cups/">
  <meta name="twitter:title" content="Configuration and Update Server (CUPS)" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
</head>


<body><nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.15</p>
      </a><div class="navbar-item navbar-search-brand">
        <div class="field has-addons has-addons-centered">
          <div class="control">
            <input id="search-input-brand" class="input search-bar" type="text" placeholder="Search the docs..." type="text">
          </div>
        </div>
      </div>
      
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a><div class="navbar-item navbar-search-menu">
            <div class="field has-addons has-addons-centered">
              <div class="control">
                <input id="search-input-menu" class="input search-bar" type="text" placeholder="Search the docs..." type="text">
              </div>
            </div>
          </div></div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="/docs/download/">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript">
    docsearch({
      apiKey: "4372282a02970d8402d43457bf95d486",
      indexName: "thethingsstack",
      inputSelector: '#search-input-brand',
      debug: false 
    });
    docsearch({
      apiKey: "4372282a02970d8402d43457bf95d486",
      indexName: "thethingsstack",
      inputSelector: '#search-input-menu',
      debug: false 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Gateways</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/gateways/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/adding-gateways/" class="">Adding Gateways</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/gateway-claiming/" class="">Gateway Claiming</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/troubleshooting/" class="">Troubleshooting Gateways</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/lora-basics-station/" class="">LoRa Basics™ Station</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/gateways/lora-basics-station/cups/" class="is-active">Configuration and Update Server (CUPS)</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/gateways/lora-basics-station/lns/" class="">LoRaWAN Network Server (LNS)</a>
    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/udp/" class="">Semtech UDP Packet Forwarder</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/rak-7240/" class="">RAK7240 WisGate Edge Prime</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/ciscowirelessgateway/" class="">Cisco Wireless Gateway for LoRaWAN</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/cloudgate/" class="">CloudGate</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/dragino-lps8/" class="">Dragino LPS8</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/kerlinkwirnetistation/" class="">Kerlink Wirnet iStation</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/kerlinkwirnetstation/" class="">Kerlink Wirnet Station</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/laird-sentrius/" class="">Laird Sentrius™ RG1xx LoRaWAN Gateway</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/mikrotik-knot/" class="">MikroTik KNOT</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/mikrotik-ltap/" class="">MikroTik LtAP</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/mikrotikrouterboard/" class="">MikroTik Routerboard wAP LoRa8 kit</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/moko-mkgw2-lw/" class="">MOKOSMART MKGW2-LW LoRaWAN Gateway</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/multitechconduit/" class="">MultiTech Conduit AEP</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/multitechconduit-mlinux/" class="">MultiTech Conduit mLinux</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/nasysoutdoorgateway/" class="">NASys LoRaWAN Outdoor Gateway</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/tektelickonamicro/" class="">Tektelic Kona Micro IoT LoRaWAN Gateway</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/thethingsindoorgateway/" class="">The Things Indoor Gateway</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/thethingskickstartergateway/" class="">The Things Kickstarter Gateway</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/thethingsoutdoor/" class="">The Things Outdoor Gateway</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/ursalinkug8x/" class="">Ursalink UG8X IoT LoRaWAN Gateway</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/lorix-one/" class="">Wifx LORIX One</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">Configuration and Update Server (CUPS)
          
        </h1>
        
        <div class="content">
          <p>LoRa Basics™ Station
can regularly connect to a Configuration and Update Server
(CUPS) server to check for configuration and software updates. This page contains information about connecting your gateway to The Things Stack to support remote management via the CUPS Protocol.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  CUPS is <strong>not required</strong> for sending and receiving LoRaWAN data, but it simplifies gateway management. CUPS support in The Things Stack is in beta and is subject to change.
</div>

<div class="notification is-warning is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Warning:</h5>
  Configuring CUPS automatically retrieves LNS credentials and configures LNS on your gateway. If you configure CUPS, your gateway will override LNS credentials in case of successful CUPS connection.
</div>

<h2 id="requirements">Requirements</h2>
<ol>
<li>User account on The Things Stack with rights to create gateways.</li>
<li>A gateway which supports LoRa Basics™ Station
.</li>
</ol>
<h2 id="create-a-gateway">Create a Gateway</h2>
<p>To connect a gateway using the CUPS protocol, you must first add the gateway in The Things Stack. This can be done either in the console, or via the command line. See instructions for <a href="https://www.thethingsindustries.com/docs/gateways/adding-gateways/">Adding Gateways</a>.</p>
<h2 id="create-separate-cups-and-lns-api-keys">Create Separate CUPS and LNS API Keys</h2>
<p>Since CUPS automatically configures LNS, you will need two API keys.</p>
<p>CUPS requires an API key for your gateway with the following rights:</p>
<ul>
<li>View gateway information</li>
<li>Edit basic gateway settings</li>
<li>Retrieve secrets associated with a gateway</li>
</ul>
<figure>
    <img src="../cups-rights.png"
         alt="CUPS API Key Rights"/> 
</figure>

<p>LNS requires an API Key with the following rights:</p>
<ul>
<li>Link as Gateway to a Gateway Server for traffic exchange, i.e. write uplink and read downlink</li>
</ul>
<figure>
    <img src="../lns-rights.png"
         alt="LNS API Key Rights"/> 
</figure>

<p>To create an API key for your gateway, follow instructions for Creating a Gateway API key in <a href="https://www.thethingsindustries.com/docs/gateways/adding-gateways/">Adding Gateways</a>.</p>
<h2 id="configure-cups-to-send-the-lns-api-key">Configure CUPS to Send the LNS API Key</h2>
<div class="tabs is-boxed">
  <ul>
    
    <li data-tab="console">
      <a>
        <span>Console</span>
      </a>
    </li>
    
    <li data-tab="cli">
      <a>
        <span>CLI</span>
      </a>
    </li>
    
  </ul>
</div>
<div class="tab-content content">
  <section data-content="console">
  <p>We need to configure CUPS in The Things Stack to transmit the LNS API key when a gateway connects. To do so in the Console, go to the <strong>General Settings</strong> page of your gateway.</p>
<p>In the <strong>LoRa Basics Station LNS Authentication Key</strong> field, paste the LNS API key you generated in the previous step.</p>
<figure>
    <img src="../lns-key.png"
         alt="LoRa Basics Station LNS Authentication Key"/> 
</figure>
<p>Press <strong>Save Changes</strong> to update the gateway settings. When your gateway connects to CUPS, The Things Stack will send the LNS configuration settings and API key.</p>
</section>
<section data-content="cli">
  <p>We need to configure CUPS in The Things Stack to transmit the LNS API key when a gateway connects. Use the following command to do so, replacing <code>&quot;your-gateway-id&quot;</code> with your gateway ID in The Things Stack and  <code>&quot;your-lns-api-key&quot;</code> with the LNS API key you created in the last step:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">export</span> <span class="nv">GTW_ID</span><span class="o">=</span><span class="s2">&#34;your-gateway-id&#34;</span>
$ <span class="nb">export</span> <span class="nv">LNS_KEY</span><span class="o">=</span><span class="s2">&#34;your-lns-api-key&#34;</span>
$ <span class="nb">export</span> <span class="nv">SECRET</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -n <span class="nv">$LNS_KEY</span> <span class="p">|</span> xxd -ps -u -c 8192<span class="k">)</span>
$ ttn-lw-cli gateways update <span class="nv">$GTW_ID</span> --lbs-lns-secret.value <span class="nv">$SECRET</span>
</code></pre></div><div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  If you receive an error running <code>ttn-lw-cli gateways update</code>, you may need to update the CLI. See instructions in <a href="https://www.thethingsindustries.com/docs/getting-started/cli/installing-cli/">Installing the CLI</a>.
</div>
<p>If successful, you should receive a response as follows:</p>
<details>
<summary>Show CLI output</summary>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;ids&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;gateway_id&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;gateway-id&gt;&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;created_at&#34;</span><span class="p">:</span> <span class="s2">&#34;2020-10-13T10:49:02.730Z&#34;</span><span class="p">,</span>
  <span class="nt">&#34;updated_at&#34;</span><span class="p">:</span> <span class="s2">&#34;2020-11-17T14:52:06.440Z&#34;</span><span class="p">,</span>
  <span class="nt">&#34;version_ids&#34;</span><span class="p">:</span> <span class="p">{</span>
<p><span class="p">},</span>
<span class="nt">&quot;lbs_lns_secret&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="nt">&quot;key_id&quot;</span><span class="p">:</span> <span class="s2">&quot;is/gateway-secrets-encryption-key&quot;</span><span class="p">,</span>
<span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;encrpyted-base64-lns-api-key&gt;&quot;</span>
<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></details></p>
</section>

</div>

<h2 id="configure-gateway">Configure Gateway</h2>
<p>All LoRa Basics™ Station
gateways support the following configuration options. Consult your gateway documentation for more information about configuring your specific gateway.</p>
<h3 id="cups-server-address">CUPS Server Address</h3>
<p>The server address is the network endpoint of The Things Stack CUPS. It is a combination of the <strong>protocol</strong> (https), the <strong>server address</strong>, and the <strong>port</strong>:</p>
<p>Enter the following in your gateway as CUPS Server Address: <code>https://&lt;server-address&gt;:443</code></p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  The <code>&lt;server-address&gt;</code> is the address of your The Things Stack deployment. See <a href="https://www.thethingsindustries.com/docs/getting-started/server-addresses/">Server Addresses</a>.
</div>

<h3 id="cups-server-certificate--cups-trust">CUPS Server Certificate / CUPS Trust</h3>
<p>This is the <a href="https://en.wikipedia.org/wiki/Certificate_authority">CA certificate</a> which secures your domain. A <code>.pem</code> file containing common certificates is available in the <a href="https://www.thethingsindustries.com/docs/reference/root-certificates/">Root Certificates Reference</a>.</p>
<p>Upload the <code>.pem</code> file in your gateway as the CUPS Server Certificate / CUPS Trust.</p>
<h3 id="cups-key-file">CUPS Key File</h3>
<p>This is a file which The Things Stack uses to verify the identity of your gateway.</p>
<p>Use the following commands to create a file called <code>cups.key</code>, replacing <code>&quot;your-cups-api-key&quot;</code> with the CUPS API key you created above.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">export</span> <span class="nv">CUPS_KEY</span><span class="o">=</span><span class="s2">&#34;your-cups-api-key&#34;</span>
$ <span class="nb">echo</span> <span class="s2">&#34;Authorization: Bearer </span><span class="nv">$CUPS_KEY</span><span class="s2">&#34;</span> <span class="p">|</span> perl -p -e <span class="s1">&#39;s/\r\n|\n|\r/\r\n/g&#39;</span>  &gt; cups.key
</code></pre></div><div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  The above command creates a file called <code>cups.key</code>, terminated with a Carriage Return Line Feed (<code>0x0D0A</code>) character. Upload this file in your gateway as the CUPS key.
</div>

<p>If the connection is successful, the CUPS server will send the LNS Server Address, LNS Trust and the LNS API Key to the gateway and it will automatically attempt to connect to the LNS Server.</p>
        </div>
        <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/gateways/lora-basics-station/">← LoRa Basics™ Station</a>
<a class="button is-pulled-right" href="/docs/gateways/lora-basics-station/lns/">LoRaWAN Network Server (LNS) →</a>
</div>

        <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#requirements'>Requirements</a></li>
    
      
      <li><a href='#create-a-gateway'>Create a Gateway</a></li>
    
      
      <li><a href='#create-separate-cups-and-lns-api-keys'>Create Separate CUPS and LNS API Keys</a></li>
    
      
      <li><a href='#configure-cups-to-send-the-lns-api-key'>Configure CUPS to Send the LNS API Key</a></li>
    
      
      <li><a href='#configure-gateway'>Configure Gateway</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/ttn-network/v3/90">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Ben Olayinka on 12 Jul 2021.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/b03897e07a682a8d7b5107bbb3ec431f8ac21fb4">
      Add server addresses page (#435)
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/gateways/lora-basics-station/cups.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.79500656c3860a54b3b38e5f5770a5130bc57306ebb67ca9b057e494f6f4b454.js" integrity="sha256-eVAGVsOGClSzs45fV3ClEwvFcwbrtnypsFfklPb0tFQ=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
