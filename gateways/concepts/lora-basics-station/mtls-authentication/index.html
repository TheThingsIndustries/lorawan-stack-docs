<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.134.2">
  <title>mTLS Authentication | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/gateways/concepts/lora-basics-station/mtls-authentication/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.5ba0be8f5f0e953584382f5875ae6ec65f7a9a9cda0dea27bd9ddb1025d10fa5.css" integrity="sha256-W6C&#43;j18OlTWEOC9Yda5uxl96mpzaDeonvZ3bECXRD6U=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="mTLS Authentication">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="mTLS Authentication">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/gateways/concepts/lora-basics-station/mtls-authentication/">
  <meta property="og:image" content="/docs/docs-thumbnail.png"/>
  <meta name="twitter:title" content="mTLS Authentication" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NGRDCNM');</script>



  <link rel="stylesheet" href="https://ttui.thethingsindustries.com/release/1.10.1/main.css" />
</head>


<body class="theme-tts">


<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NGRDCNM"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
      </a><div class="navbar-item navbar-search-menu" id="search-input-menu">
          </div>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/the-things-stack/">The Things Stack</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a>
        <a class="navbar-item" href="/docs/api/">API</a>

      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://www.thethingsindustries.com/stack/plans/" target="_blank">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
  <script type="text/javascript">
    docsearch({
      appId: "608OILUBK2",
      apiKey: "39082cdce449b93b2aa806b44f6af4d2",
      indexName: "thethingsstack",
      container: '#search-input-menu',
      debug: false, 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Gateways</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/gateways/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/concepts/" class="">Concepts</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/gateways/concepts/adding-gateways/" class="">Adding Gateways</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/gateways/concepts/lora-basics-station/" class="">LoRa Basics™ Station</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/gateways/concepts/lora-basics-station/cups/" class="">Configuration and Update Server (CUPS)</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/gateways/concepts/lora-basics-station/lns/" class="">LoRaWAN Network Server (LNS)</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/gateways/concepts/lora-basics-station/cups-forwarding/" class="">Using CUPS to redirect to a different LNS</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/gateways/concepts/lora-basics-station/mtls-authentication/" class="is-active">mTLS Authentication</a>
    
    



    
  </li>

</ul>


    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/gateways/concepts/udp/" class="">Semtech UDP Packet Forwarder</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/gateways/concepts/ttigw/" class="">The Things Industries Gateway Protocol</a>
    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/models/" class="">Models</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/gateways/troubleshooting/" class="">Troubleshooting Gateways</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">mTLS Authentication
          
        </h1>
        
        <div class="content">
          <p>The Things Stack supports mutual TLS to authenticate LoRa Basics™ Station CUPS connections in selected deployments. This guide explains how gateway vendors/resellers and users can leverage</p>
<p>To check if your deployment supports it, contact the operator.</p>
<h2 id="procedure">Procedure</h2>
<ol>
<li>The gateway vendor or user generates a CA (Certificate Authority) credentials in a secure environment. This usually consists of a public X.509 certificate and a private key.</li>
</ol>
<ul>
<li>Usually, a Root CA and one or many intermediate CAs are generated. The Root CA is typically only used generate intermediate CAs and the intermediate CAs are used to sign client/leaf certificates.</li>
</ul>
<ol start="2">
<li>The gateway vendor generates <em>unique TLS client certificates for each gateway</em>.</li>
</ol>
<ul>
<li>The public certificate uniquely identifies the gateway. The Common Name (CN) field of the certificate should be <strong>exactly</strong> equal to the hex encoded EUI-64 (16 digits). The other fields are left to the user.</li>
<li>The private key is the counterpart of the public certificate and is used for cryptographic operations while connecting to The Things Stack. Gateway vendors must ensure that this key is not easily accessible from the gateway. Anyone in possession of this key can impersonate the gateway.</li>
<li>If using RSA to generate key pairs, we recommend a minimum size of 2048 bits.</li>
</ul>
<ol start="3">
<li>
<p>The gateway vendor/user sends the CA certificate used for signing the gateway credentials to the operator of The Things Stack deployment. The operator will configure these CAs in The Things Stack.</p>
</li>
<li>
<p>The user of the gateway registers it on a The Things Stack deployment. See instructions for in the <a href="https://www.thethingsindustries.com/docs/gateways/concepts/adding-gateways/">Adding Gateways</a> guide.</p>
</li>
<li>
<p>When this gateway make a CUPS <code>/update-info</code> request to The Things Stack, it presents the client certificate. The Things Stack verifies this certificate against the configured CA certificate. If the cryptographic check is successful, The Things Stack will check rest of the CUPS request and respond with the LNS credentials.</p>
</li>
<li>
<p>The gateway can now be connected to the LNS endpoint with the credentials sent by the CUPS server and if everything is successful, the gateway will connect to The Things Stack.</p>
</li>
</ol>
<h2 id="testing">Testing</h2>
<p>In order to test mTLS authentication, you can generate self-signed certificates.</p>
<div class="notification is-warning is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Warning:</h5>
  This is only for testing. Do not use this process in production.
</div>

<ol>
<li>Create a client gateway private key. Note you can choose any length of the key.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl genrsa -out gateway.key <span class="m">2048</span>
</span></span></code></pre></div><ol start="2">
<li>Create a Root CA:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl req -x509 -sha256 -days <span class="m">1825</span> -newkey rsa:2048 -keyout root-ca.key -out root-ca.crt
</span></span></code></pre></div><ol start="3">
<li>Create a Certificate Signing Request for your client (Gateways):</li>
</ol>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  The <code>CN</code> (Common Name) field must be the hex encoded EUI64 (16 digits). Example: <code>0123456789ABCDEF</code>
</div>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl req -key gateway.key -new -out gateway.csr
</span></span></code></pre></div><ol start="4">
<li>Generate the client certificate. The following generates a gateway certificate signed by the Root CA valid for 365 days.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl X.509 -req -CA root-ca.crt -CAkey root-ca.key -in gateway.csr -out gateway.crt -days <span class="m">365</span> -CAcreateserial -sha256 -days <span class="m">365</span>
</span></span></code></pre></div><ol start="5">
<li>
<p>Send this CA certificate <code>root-ca.crt</code> to the operator of the desired The Things Stack deployment.</p>
</li>
<li>
<p>Connect using a client (e.g. <code>cURL</code>):</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -v --cert &lt;path&gt;/gateway.crt --key &lt;path&gt;/gateway.key --cacert &lt;path&gt;/root-ca.crt https://&lt;domain&gt;:8987/update-info -d <span class="s1">&#39;{&#34;router&#34;:&#34;&lt;EUI in ID6&gt;&#34;}&#39;</span>
</span></span></code></pre></div><ol start="7">
<li>If the request is successful, you will receive an HTTP <code>200</code> response code with a binary blob containing the LNS credentials.</li>
</ol>
        </div>
        <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/gateways/concepts/lora-basics-station/cups-forwarding/">← Using CUPS to redirect to a different LNS</a>
<a class="button is-pulled-right" href="/docs/gateways/concepts/udp/">Semtech UDP Packet Forwarder →</a>
</div>

        <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#procedure'>Procedure</a></li>
    
      
      <li><a href='#testing'>Testing</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-third">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/the-things-stack/">The Things Stack</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
        <p><a class="" href="/docs/api/">API</a></p>
      </nav>
      <nav class="column is-one-third">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
      </nav>
      
      <nav class="column is-one-third">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.3bf0da17f5ab4cc0f916662c2d2f977f7fa7259b4483f7f9eb46e875a556cc43.js" integrity="sha256-O/DaF/WrTMD5FmYsLS&#43;Xf3&#43;nJZtEg/f560bodaVWzEM=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
