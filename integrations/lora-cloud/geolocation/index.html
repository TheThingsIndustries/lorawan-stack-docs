<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.96.0" />
  <title>LoRa Cloud Geolocation | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/integrations/lora-cloud/geolocation/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.bdf0dbbf69f8c05c615dbde6067993588e456d126111b29ab52e2abe9789d5fd.css" integrity="sha256-vfDbv2n4wFxhXb3mBnmTWI5FbRJhEbKatS4qvpeJ1f0=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="LoRa Cloud Geolocation">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="LoRa Cloud Geolocation">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/integrations/lora-cloud/geolocation/">
  <meta name="twitter:title" content="LoRa Cloud Geolocation" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
</head>


<body><nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.23.0</p>
      </a><div class="navbar-item navbar-search-brand">
        <div class="field has-addons has-addons-centered">
          <div class="control">
            <input id="search-input-brand" class="input search-bar" type="text" placeholder="Search the docs..." type="text">
          </div>
        </div>
      </div>
      
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a><div class="navbar-item navbar-search-menu">
            <div class="field has-addons has-addons-centered">
              <div class="control">
                <input id="search-input-menu" class="input search-bar" type="text" placeholder="Search the docs..." type="text">
              </div>
            </div>
          </div></div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://accounts.thethingsindustries.com/fee-calculator">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript">
    docsearch({
      apiKey: "4372282a02970d8402d43457bf95d486",
      indexName: "thethingsstack",
      inputSelector: '#search-input-brand',
      debug: false 
    });
    docsearch({
      apiKey: "4372282a02970d8402d43457bf95d486",
      indexName: "thethingsstack",
      inputSelector: '#search-input-menu',
      debug: false 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Integrations</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/integrations/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/adding-applications/" class="">Adding Applications</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/adding-integrations/" class="">Adding Integrations</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/" class="">Cloud Integrations</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/mqtt/" class="">MQTT Server</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/pubsub/" class="">Pub/Sub</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/lora-cloud/" class="">LoRa Cloud</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/lora-cloud/das/" class="">LoRa Cloud Device &amp; Application Services</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/lora-cloud/geolocation/" class="is-active">LoRa Cloud Geolocation</a>
    
    



    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/node-red/" class="">Node-RED</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/ifttt/" class="">IFTTT</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/payload-formatters/" class="">Payload Formatters</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/storage/" class="">Storage Integration</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/webhooks/" class="">Webhooks</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">LoRa Cloud Geolocation
          
        </h1>
        
        <div class="content">
          <p><a href="https://www.loracloud.com/portal/geolocation/home">LoRa Cloud Geolocation Service</a> provides simple JSON web APIs that can be easily integrated with a LoRaWAN network or application server to enable estimating the location of LoRa-based devices.</p>
<p>In general, LoRa allows locating devices withing approximately 50m, without the need for a geolocation hardware module and no extra power consumption. Instead, the RSSI, SNR and TOA metadata that are being sent as part of your device&rsquo;s LoRa radio frames are used to estimate the location of your device. If your device can perform WiFi scans, scanning results can also be used to estimate your device&rsquo;s location. This yields a significant cost reduction compared to GPS.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  Keep in mind that TOA is available only in metadata of gateways that have appropriate high-resolution time-stamping features. Therefore, your gateway needs to support this feature in order for you to be able to use TOA-based geolocation features.
</div>

<p>Also, LoRa Cloud Geolocation integration allows estimating the location of LR1110-based devices with transceiver firmware from their GNSS scans.</p>
<p>Three query types are supported in scope of this integration and will be demonstrated below:</p>
<ul>
<li><a href="https://www.loracloud.com/documentation/geolocation?url=v3.html">LoRa TOA/RSSI</a> - allows computing the location estimates using TOA and/or RSSI information from a single or multiple LoRa frames (for all LoRa devices)</li>
<li><a href="https://www.loracloud.com/documentation/geolocation?url=gnss.html">GNSS</a> - location estimates are computed from the information contained in the GNSS scan result messages (NAV messages) (for LR1110 transceiver-based devices only)</li>
<li><a href="https://www.loracloud.com/documentation/geolocation?url=v2.html#singleframe-wi-fi-tdoa-request">TOA/WiFi</a> - the initial device location estimation is performed using the scanned WiFi access points, but if this estimation is not valid, another estimation is performed based on TOA metadata from device&rsquo;s LoRa radio frames (for all LoRa devices capable of performing WiFi scans)</li>
</ul>
<div class="notification is-warning is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Warning:</h5>
  It is important to know that you can obtain the location estimates using LoRa Cloud Geolocation LoRa TOA/RSSI query only if the uplink messages sent by your end device are picked up by at least 3 LoRaWAN gateways. If this is not the case, you will see no errors in The Things Stack Console, but you will not see the <code>Location solved</code> message containing the location estimation results either.
</div>

<p>The location of your gateway has to be publicly available for this integration, as it participates in the process of computing the end device location. This is disabled in The Things Stack by default, because the application (and end device) owner does not have be the one providing the gateway coverage. If you own the gateway, it is safe for you to explicitly allow to publish its location.</p>
<p>To make the gateway location public, tick the <strong>Gateway location → Public</strong> box when <a href="https://www.thethingsindustries.com/docs/gateways/concepts/adding-gateways/">adding your gateway</a> in The Things Stack Console.</p>
<p>If your gateway is already added in The Things Stack Console, go to your gateway&rsquo;s settings, navigate to the <strong>Location</strong> tab on the left hand menu and tick the <strong>Privacy → Publish location</strong> box.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  Using Semtech&rsquo;s <a href="https://lora-developers.semtech.com/library/tech-papers-and-guides/understanding-lora-basics-modem-e/">Modem-E firmware</a> is recommended for LR1110-based devices, hence using the <a href="https://www.thethingsindustries.com/docs/integrations/lora-cloud/das/">LoRa Cloud Device &amp; Application Services integration</a> instead of LoRa Cloud Geolocation is also recommended.
</div>

<h2 id="lora-cloud-setup">LoRa Cloud Setup</h2>
<p>Before you create the integration on The Things Stack, you first need to prepare the setup on LoRa Cloud.</p>
<p>On the <a href="https://www.loracloud.com/portal">LoRa Cloud portal</a>, navigate to <strong>LoRa Cloud Geolocation</strong>.</p>
<figure><img src="../geolocation.png"
         alt="LoRa Cloud Device &amp; Application Services"/>
</figure>

<p>Choose <strong>Manage tokens</strong> on the left hand menu. You will see that two tokens (<strong>Primary Token</strong> and <strong>Secondary Token</strong>) are pre-configured and you can use them in the next step.</p>
<figure><img src="../geolocation-tokens.png"
         alt="Pre-configured tokens"/>
</figure>

<h2 id="configure-geolocation-integration">Configure Geolocation Integration</h2>
<p>To setup LoRa Cloud Geolocation integration, navigate to your application in The Things Stack.</p>
<p>On the left hand menu, select <strong>Integrations → LoRa Cloud</strong>. Click the <strong>Expand</strong> button next to the <strong>Geolocation</strong>.</p>
<p>Next, copy one of the aforementioned tokens from LoRa Cloud Geolocation portal. Paste the token in the <strong>Token</strong> field under the <strong>Set LoRa Cloud token</strong> section.</p>
<p>Choose the <strong>Query type</strong> depending on the type of data you want to use for estimating the location of your device. As mentioned earlier, you can choose <strong>LoRa TOA/RSSI</strong>, <strong>GNSS</strong> or <strong>TOA/WiFi</strong> query type.</p>
<p>If you choose <strong>LoRa TOA/RSSI</strong>, you also have an option to enable <strong>Multiframe</strong> location lookups. Multiframe mode allows using the sequence of radio frames (instead of just a single frame) to improve the device&rsquo;s location estimation accuracy. Multiframe mode is reported to be more accurate than averaging multiple location results calculated from several single radio frames. If you choose multiframe mode, you can also set the <strong>Multiframe window size</strong> to tell how many historical messages should be sent as part of the final request, and <strong>Multiframe time window</strong> as the maximum age of considered historical messages.</p>
<p>Finish by clicking the <strong>Set token</strong> button.</p>
<figure><img src="../geolocation-integration.png"
         alt="LoRa Cloud Geolocation integration"/>
</figure>

<h2 id="obtain-location-solutions">Obtain Location Solutions</h2>
<p>This section will show you how to obtain the location estimates using LoRa® TOA/RSSI, GNSS and TOA/WiFi query types.</p>
<p>After you obtain the location results, you can further integrate your The Things Stack application with other third-party IoT platforms to visualize them, etc.</p>
<h3 id="lora-toarssi">LoRa TOA/RSSI</h3>
<p>At this point, when your LoRa device sends any uplink message and it gets picked up by at least 3 gateways, you will notice the location estimation results present in the <code>Location solved</code> message in The Things Stack <strong>Live data</strong> tab, as shown below.</p>
<figure><img src="../toa-rssi.png"
         alt="LoRa TOA/RSSI location estimate"/>
</figure>

<p>Notice the <code>Source: LORA_RSSI_GEOLOCATION</code> which indicates the type of the query you chose for geolocation.</p>
<div class="notification is-warning is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Warning:</h5>
  Keep in mind that if your device&rsquo;s uplink message was not picked up by at least 3 gateways, you will not see the Location solved message in The Things Stack <strong>Live data</strong> view, but you will not see any errors either.
</div>

<h3 id="gnss">GNSS</h3>
<p>When your LR1110 transceiver performs a GNSS scan and sends the resulting data in an uplink NAV message, you will see the location estimate present in the <code>Location solved</code> message in The Things Stack <strong>Live data</strong> tab, as shown below.</p>
<figure><img src="../gnss.png"
         alt="GNSS location estimate"/>
</figure>

<p>Notice the <code>Source: GPS</code> which indicates the type of the query you chose for geolocation.</p>
<div class="notification is-warning is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Warning:</h5>
  For GNSS-based geolocation, the GNSS payload has to be valid. Otherwise, you will see an error similar to <code>Ignore invalid GNSS message payload: &lt;payload&gt;</code>. This is likely going to happen if you are not using LR1110-based device with transceiver firmware.
</div>

<h3 id="toawifi">TOA/WiFi</h3>
<p>When your LoRa device performs a WiFi scan and sends a resulting uplink message, the payload contains the MAC addresses of WiFi adapters and RSSIs of scanned WiFi networks. You need to decode this payload using the <a href="https://www.thethingsindustries.com/docs/integrations/payload-formatters/javascript/">uplink payload formatter function</a> in a way that the <code>decoded_payload</code> object that is a part of the <code>uplink_message</code> contains the access point records, like so:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="s2">&#34;decoded_payload&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;access_points&#34;</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;bssid&#34;</span><span class="o">:</span> <span class="s2">&#34;14:60:80:9a:19:58&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;rssi&#34;</span><span class="o">:</span> <span class="o">-</span><span class="mi">20</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;bssid&#34;</span><span class="o">:</span> <span class="s2">&#34;fc:f5:28:7b:07:e5&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;rssi&#34;</span><span class="o">:</span> <span class="o">-</span><span class="mi">80</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>If estimating the location based on WiFi access point records cannot be performed, the location will be estimated using the TOA information from LoRa radio metadata and gateway location. In both cases, you will see the location estimate present in the <code>Location solved</code> message in The Things Stack <strong>Live data</strong> tab, as shown below.</p>
<figure><img src="../toa-wifi.png"
         alt="TOA/WiFi location estimate"/>
</figure>

<p>Notice the <code>Source: WIFI_RSSI_GEOLOCATION</code> which indicates the type of the query you chose for geolocation.</p>
        </div>
        <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/integrations/lora-cloud/das/">← LoRa Cloud Device &amp; Application Services</a>
<a class="button is-pulled-right" href="/docs/integrations/node-red/">Node-RED →</a>
</div>

        <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#lora-cloud-setup'>LoRa Cloud Setup</a></li>
    
      
      <li><a href='#configure-geolocation-integration'>Configure Geolocation Integration</a></li>
    
      
      <li><a href='#obtain-location-solutions'>Obtain Location Solutions</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/ttn-network/v3/90">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Krishna Iyer on 14 Oct 2022.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/11b832df984f5600c0739c6635d78cead9b0f8ae">
      Refactor gateways section (#973)
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/integrations/lora-cloud/geolocation.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.a32708c8796e7e8713fa926212adddbbf5c15cdd97676d898ecfc17bc6d9ed4f.js" integrity="sha256-oycIyHlufocT&#43;pJiEq3du/XBXN2XZ22Jjs/Be8bZ7U8=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
