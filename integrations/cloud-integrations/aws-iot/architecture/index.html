<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.96.0" />
  <title>Architecture | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/aws-iot/architecture/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.c994a55269632c4bc7be3364abf857e85ff170cc251dd025099769c910cbbcb4.css" integrity="sha256-yZSlUmljLEvHvjNkq/hX6F/xcMwlHdAlCZdpyRDLvLQ=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Architecture">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Architecture">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/aws-iot/architecture/">
  <meta name="twitter:title" content="Architecture" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
</head>


<body><nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.22.1</p>
      </a><div class="navbar-item navbar-search-brand">
        <div class="field has-addons has-addons-centered">
          <div class="control">
            <input id="search-input-brand" class="input search-bar" type="text" placeholder="Search the docs..." type="text">
          </div>
        </div>
      </div>
      
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a><div class="navbar-item navbar-search-menu">
            <div class="field has-addons has-addons-centered">
              <div class="control">
                <input id="search-input-menu" class="input search-bar" type="text" placeholder="Search the docs..." type="text">
              </div>
            </div>
          </div></div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://accounts.thethingsindustries.com/fee-calculator">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript">
    docsearch({
      apiKey: "4372282a02970d8402d43457bf95d486",
      indexName: "thethingsstack",
      inputSelector: '#search-input-brand',
      debug: false 
    });
    docsearch({
      apiKey: "4372282a02970d8402d43457bf95d486",
      indexName: "thethingsstack",
      inputSelector: '#search-input-menu',
      debug: false 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Integrations</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/integrations/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/adding-applications/" class="">Adding Applications</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/adding-integrations/" class="">Adding Integrations</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/" class="">Cloud Integrations</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/akenza/" class="">akenza</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/allthingstalk/" class="">AllThingsTalk Maker</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/anyviz/" class="">AnyViz</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/aws-iot/" class="">AWS IoT</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/aws-iot/architecture/" class="is-active">Architecture</a>
    
    



    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/aws-iot/deployment-guide/" class="">Deployment Guide</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/aws-iot/things/" class="">Managing Things</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/aws-iot/messages/" class="">Messages</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/aws-iot/metrics/" class="">Metrics</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/aws-iot/update/" class="">Update</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/aws-iot/uninstall/" class="">Uninstall</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/aws-iot/troubleshooting/" class="">Troubleshooting AWS IoT Integration</a>
    
  </li>

</ul>


    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/azure-iot-central/" class="">Azure IoT Central</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/azure-iot-hub/" class="">Azure IoT Hub</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/blockbax/" class="">Blockbax</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/cayenne/" class="">Cayenne</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/cloudstudio/" class="">Cloud Studio</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/daizy/" class="">Daizy</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/datacake/" class="">Datacake</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/dezem/" class="">deZem</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/homey/" class="">Homey</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/influxdb-cloud/" class="">InfluxDB Cloud 2.0</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/iotinabox/" class="">IoT in a Box</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/kaa/" class="">Kaa</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/losant/" class="">Losant IoT Platform</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/mclimate/" class="">MClimate</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/my-iot-open-tech/" class="">my IoT open Tech</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/qubitro/" class="">Qubitro</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/tagoio/" class="">TagoIO</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/telemetry2u/" class="">Telemetry2U</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/tellsens/" class="">Tellsens</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/thethingsio/" class="">thethings.iO</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/thinger-io/" class="">Thinger.io</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/thingsboard/" class="">ThingsBoard</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/thingspeak/" class="">ThingSpeak</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/ttnmapper/" class="">TTN Mapper</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/ubidots/" class="">Ubidots</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/uib/" class="">UIB</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/widgelix/" class="">Widgelix</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/withthegrid/" class="">Withthegrid</a>
    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/mqtt/" class="">MQTT Server</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/pubsub/" class="">Pub/Sub</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/lora-cloud/" class="">LoRa Cloud</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/node-red/" class="">Node-RED</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/ifttt/" class="">IFTTT</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/payload-formatters/" class="">Payload Formatters</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/storage/" class="">Storage Integration</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/integrations/webhooks/" class="">Webhooks</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">Architecture
          
        </h1>
        
        <div class="content">
          <p>The AWS IoT Core integration is a serverless deployment that scales automatically as your deployment grows.</p>
<figure class="plain"><img src="../architecture.svg"
         alt="Default integration architecture"/>
</figure>

<p>The key resources deployed in your AWS account are:</p>
<ul>
<li>Cross-account role for The Things Stack to connect to your AWS IoT Core MQTT endpoint</li>
<li>AWS Lambda functions to create the thing type and configure the integration as pub/sub in The Things Stack</li>
<li>AWS Lambda functions for claiming and creating devices, and for handling uplink and downlink messages</li>
<li>Secret with key encryption key (KEK) to leverage LoRaWAN end-to-end encryption</li>
<li>IoT Core rules to trigger the Lambda functions based on topics and attributes</li>
</ul>
<p>This is a serverless deployment: there are no compute resources being deployed. AWS only charges for usage, which is driven by traffic. The only continuous charges are by IoT Core connectivity from The Things Stack to your AWS account. All permissions are the minimum permissions for the integration to function.</p>
<h2 id="end-to-end-encryption">End-to-End Encryption</h2>
<p>This integration supports true LoRaWAN end-to-end encryption: the application payload is encrypted on the end device with the LoRaWAN AppSKey, and decrypted in your AWS Account. The underlying network infrastructure passes your application payload in the encrypted form - it cannot see your data.</p>
<p>When end-to-end encryption is enabled, this integration configures Join Server with your key encryption key (KEK) that is generated in your AWS Account and stored as a secret in <a href="https://aws.amazon.com/secrets-manager/">Secrets Manager</a>. Join Server encrypts the AppSKey with the KEK before passing it to the network layer. The network layer sends the encrypted AppSKey to your AWS Account, where it gets decrypted.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  This feature only works with OTAA devices registered in the in-cluster Join Server or The Things Join Server.
</div>

<p>When using this feature, your AWS application needs to process the LoRaWAN application payload in binary form, as the network layer&rsquo;s payload encoding and decoding functions cannot work with the encrypted data.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  When <strong>End-to-End Encryption</strong> option on AWS is enabled, the <strong>Skip Payload Crypto</strong> option will be enabled on the application level in The Things Stack. In this case, scheduling downlink messages from The Things Stack is restricted, and can only be achieved from AWS. Downlink scheduling through the Console and CLI is not supported.
</div>
        </div>
        <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/integrations/cloud-integrations/aws-iot/">← AWS IoT</a>
<a class="button is-pulled-right" href="/docs/integrations/cloud-integrations/aws-iot/deployment-guide/">Deployment Guide →</a>
</div>

        <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#end-to-end-encryption'>End-to-End Encryption</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/ttn-network/v3/90">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Johan Stokking on 23 Feb 2022.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/8dcaa1916de4d00ce23fbf8e2f8f58a79092f299">
      Update AWS IoT Core to new console (#784)
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/integrations/cloud-integrations/aws-iot/architecture.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.a32708c8796e7e8713fa926212adddbbf5c15cdd97676d898ecfc17bc6d9ed4f.js" integrity="sha256-oycIyHlufocT&#43;pJiEq3du/XBXN2XZ22Jjs/Be8bZ7U8=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
