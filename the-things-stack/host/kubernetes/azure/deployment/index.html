<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.112.3">
  <title>Deployment | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/the-things-stack/host/kubernetes/azure/deployment/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.5ba0be8f5f0e953584382f5875ae6ec65f7a9a9cda0dea27bd9ddb1025d10fa5.css" integrity="sha256-W6C&#43;j18OlTWEOC9Yda5uxl96mpzaDeonvZ3bECXRD6U=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Deployment">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Deployment">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/the-things-stack/host/kubernetes/azure/deployment/">
  <meta property="og:image" content="/docs/docs-thumbnail.png"/>
  <meta name="twitter:title" content="Deployment" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NGRDCNM');</script>



  <link rel="stylesheet" href="https://ttui.thethingsindustries.com/release/1.7.2/main.css" />
</head>


<body class="theme-tts">


<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NGRDCNM"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
      </a><div class="navbar-item navbar-search-menu" id="search-input-menu">
          </div>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/the-things-stack/">The Things Stack</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a>
        <a class="navbar-item" href="/docs/api/">API</a>

      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://www.thethingsindustries.com/stack/plans/">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
  <script type="text/javascript">
    docsearch({
      appId: "608OILUBK2",
      apiKey: "39082cdce449b93b2aa806b44f6af4d2",
      indexName: "thethingsstack",
      container: '#search-input-menu',
      debug: false, 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">The Things Stack</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/the-things-stack/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/concepts/" class="">Basic Concepts</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/cloud/" class="">The Things Stack Cloud</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/" class="">Host The Things Stack</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/aws/" class="">AWS</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/kubernetes/" class="">Kubernetes</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/kubernetes/generic/" class="">Generic</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/kubernetes/azure/" class="">Azure</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/kubernetes/azure/architecture/" class="">Architecture</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/kubernetes/azure/prerequisites/" class="">Prerequisites</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/kubernetes/azure/configuration/" class="">Configuration</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/kubernetes/azure/deployment/" class="is-active">Deployment</a>
    
    



    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/kubernetes/azure/troubleshooting/" class="">Troubleshooting</a>
    
  </li>

</ul>


    
  </li>

</ul>


    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/docker/" class="">Docker</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/join-server/" class="">The Things Join Server</a>
    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/interact/" class="">Interact with The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/management/" class="">Manage The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/" class="">Migrate to The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/packet-broker/" class="">Packet Broker</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/works-with/" class="">Works with The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/alerting/" class="">Alerting in The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/troubleshooting/" class="">Troubleshooting</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">Deployment
          
        </h1>
        
        <div class="content">
          <p>This page describes the steps for deploying The Things Stack on Azure Kubernetes Service.</p>
<h2 id="azure-infrastructure">Azure Infrastructure</h2>
<p>Start with the <code>1-infrastructure</code> templates that create the foundation for your deployment.</p>
<p>If you haven&rsquo;t done this before create a Terraform backend configuration file <code>config.azurerm.tfbackend</code>. You can read more about it in the <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/kubernetes/azure/configuration/#terraform-backend">Configuration</a> section.</p>
<p>Initialize the Terraform state.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ make init
</span></span></code></pre></div><p>Plan the deployment and verify everything is going to be set up correctly.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ make plan
</span></span></code></pre></div><p>This template will deploy the Azure Kubernetes Service cluster, Azure Storage containers and Azure Database Flexible Server for Postgres, with their supporting infrastructure. You can apply it after validating the deployment plan. The deployment should take about 10 to 15 minutes. If you encounter any issues, please refer to <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/kubernetes/azure/troubleshooting/">Troubleshooting</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ make apply
</span></span></code></pre></div><p>After the AKS cluster is deployed you can get the <code>kubeconfig</code> file next.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Set KUBECONFIG if you don&#39;t want to override the default kubeconfig.</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">KUBECONFIG</span><span class="o">=</span><span class="s1">&#39;local.kubeconfig&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Set KUBE_CONFIG_PATH to the location of the kubeconfig.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># If you didn&#39;t set the KUBECONFIG variable use &#39;~/.kube/config&#39; instead.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Ref https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs#file-config</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">KUBE_CONFIG_PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">/</span><span class="si">${</span><span class="nv">KUBECONFIG</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ az aks get-credentials --resource-group <span class="k">$(</span>terraform output -raw resource_group_name<span class="k">)</span> --name <span class="k">$(</span>terraform output -raw aks_cluster_name<span class="k">)</span>
</span></span></code></pre></div><div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  If <code>var.allow_cluster_admin_access</code> is disabled, then <code>kubelogin</code> must be installed.
</div>

<p>Follow the prompt to authenticate the <code>kubectl</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get pods
</span></span><span class="line"><span class="cl">To sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code xxxxxx to authenticate.
</span></span></code></pre></div><p>Export the DNS values used for <a href="#dns-infrastructure">DNS Infrastructure</a>. Use the provider chosen during the <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/kubernetes/azure/configuration/#acme-configuration">Configuration</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nv">DNS_PROVIDER</span><span class="o">=</span><span class="s1">&#39;&lt;provider&gt;&#39;</span>
</span></span><span class="line"><span class="cl">$ make dns.values <span class="p">|</span> jq &gt; <span class="s2">&#34;</span><span class="k">$(</span>git rev-parse --show-toplevel<span class="k">)</span><span class="s2">/dns/</span><span class="si">${</span><span class="nv">DNS_PROVIDER</span><span class="si">}</span><span class="s2">/dns.auto.tfvars.json&#34;</span>
</span></span></code></pre></div><p>Export the Infrastructural values used for <a href="#kubernetes-templates">Kubernetes Templates</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ make infra.values <span class="p">|</span> jq &gt; <span class="s1">&#39;../2-kubernetes/infra.auto.tfvars.json&#39;</span>
</span></span></code></pre></div><h2 id="dns-infrastructure">DNS Infrastructure</h2>
<p>Now we need to set up the DNS infrastructure. Head over to the directory of the provider you chose during the last steps of the <a href="#azure-infrastructure">Azure Infrastructure</a> section.</p>
<p>If you haven&rsquo;t done this before create a Terraform backend configuration file <code>config.azurerm.tfbackend</code>. You can read more about it in <a href="/docs/the-things-stack/host/kubernetes/azure/configuration/#terraform-backend">Terraform Backend Configuration</a>.</p>
<p>Initialize the Terraform state.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  <p><code>KUBE_CONFIG_PATH</code> should point to your <code>kubeconfig</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Example</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">KUBE_CONFIG_PATH</span><span class="o">=</span><span class="s1">&#39;~/.kube/config&#39;</span>
</span></span></code></pre></div>
</div>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ make init
</span></span></code></pre></div><p>Plan the deployment and verify everything is going to be set up correctly.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ make plan
</span></span></code></pre></div><p>Now apply the template.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ make apply
</span></span></code></pre></div><p>Verify the certificate is in ready state. This may take a couple of minutes after the deployment for the certificate to reach a ready state.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl -n tts get cert
</span></span></code></pre></div><p>In case the certificate won&rsquo;t reach a ready state head over to <a href="https://cert-manager.io/docs/troubleshooting/acme/">Troubleshooting Problems with ACME / Let&rsquo;s Encrypt Certificates</a>.</p>
<h2 id="kubernetes-templates">Kubernetes Templates</h2>
<p>Head over to the <code>2-kubernetes</code> directory next.</p>
<p>If you haven&rsquo;t done this before create a Terraform backend configuration file <code>config.azurerm.tfbackend</code>. You can read more about it in <a href="/docs/the-things-stack/host/kubernetes/azure/configuration/#terraform-backend">Terraform Backend Configuration</a>.</p>
<p>Initialize the Terraform state.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ make init
</span></span></code></pre></div><p>Plan the deployment and verify everything is going to be set up correctly.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  <p><code>KUBE_CONFIG_PATH</code> should point to your <code>kubeconfig</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Example</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">KUBE_CONFIG_PATH</span><span class="o">=</span><span class="s1">&#39;~/.kube/config&#39;</span>
</span></span></code></pre></div>
</div>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ make plan
</span></span></code></pre></div><p>Now apply the template.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ make apply
</span></span></code></pre></div><p>Once all the targets are healthy and if the configuration was correct, The Things Stack console will be accessible at <code>https://&lt;tenantID&gt;.&lt;domain&gt;</code>.</p>
        </div>
          <div class="columns is-multiline">
</div>

          <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/the-things-stack/host/kubernetes/azure/configuration/">← Configuration</a>
<a class="button is-pulled-right" href="/docs/the-things-stack/host/kubernetes/azure/troubleshooting/">Troubleshooting →</a>
</div>

          <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#azure-infrastructure'>Azure Infrastructure</a></li>
    
      
      <li><a href='#dns-infrastructure'>DNS Infrastructure</a></li>
    
      
      <li><a href='#kubernetes-templates'>Kubernetes Templates</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-third">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/the-things-stack/">The Things Stack</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
        <p><a class="" href="/docs/api/">API</a></p>
      </nav>
      <nav class="column is-one-third">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
      </nav>
      
      <nav class="column is-one-third">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.4a22f0dea0620048bc258cf6dedbdfbec40f3b5dba1dcdc6536e61e7bc20a5bf.js" integrity="sha256-SiLw3qBiAEi8JYz23tvfvsQPO126Hc3GU25h57wgpb8=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
