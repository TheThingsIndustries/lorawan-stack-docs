<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.112.3">
  <title>Troubleshooting AWS AMI Deployment | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/the-things-stack/host/aws/ami/troubleshooting/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.5ba0be8f5f0e953584382f5875ae6ec65f7a9a9cda0dea27bd9ddb1025d10fa5.css" integrity="sha256-W6C&#43;j18OlTWEOC9Yda5uxl96mpzaDeonvZ3bECXRD6U=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Troubleshooting AWS AMI Deployment">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Troubleshooting AWS AMI Deployment">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/the-things-stack/host/aws/ami/troubleshooting/">
  <meta property="og:image" content="/docs/docs-thumbnail.png"/>
  <meta name="twitter:title" content="Troubleshooting AWS AMI Deployment" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NGRDCNM');</script>



  <link rel="stylesheet" href="https://ttui.thethingsindustries.com/release/1.7.2/main.css" />
</head>


<body class="theme-tts">


<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NGRDCNM"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
      </a><div class="navbar-item navbar-search-menu" id="search-input-menu">
          </div>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/the-things-stack/">The Things Stack</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a>
        <a class="navbar-item" href="/docs/api/">API</a>

      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://www.thethingsindustries.com/stack/plans/">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
  <script type="text/javascript">
    docsearch({
      appId: "608OILUBK2",
      apiKey: "39082cdce449b93b2aa806b44f6af4d2",
      indexName: "thethingsstack",
      container: '#search-input-menu',
      debug: false, 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">The Things Stack</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/the-things-stack/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/concepts/" class="">Basic Concepts</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/cloud/" class="">The Things Stack Cloud</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/" class="">Host The Things Stack</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/aws/" class="">AWS</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/aws/ami/" class="">AWS Marketplace AMI</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/aws/ami/deployment-guide/" class="">Deployment Guide</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/aws/ami/post-deployment/" class="">Post Deployment Configuration</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/aws/ami/updating/" class="">Updating AWS AMI Deployment</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/aws/ami/best-practices/" class="">Best Practices</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/aws/ami/application-server-telemetry/" class="">Application Server Telemetry</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/aws/ami/troubleshooting/" class="is-active">Troubleshooting AWS AMI Deployment</a>
    
    



    
  </li>

</ul>


    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/aws/ecs/" class="">AWS ECS</a>
    
  </li>

</ul>


    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/kubernetes/" class="">Kubernetes</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/docker/" class="">Docker</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/join-server/" class="">The Things Join Server</a>
    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/interact/" class="">Interact with The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/management/" class="">Manage The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/" class="">Migrate to The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/packet-broker/" class="">Packet Broker</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/works-with/" class="">Works with The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/alerting/" class="">Alerting in The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/troubleshooting/" class="">Troubleshooting</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">Troubleshooting AWS AMI Deployment
          
        </h1>
        
        <div class="content">
          <!--
TODO: https://github.com/TheThingsNetwork/lorawan-stack/issues/2714
Move to generic getting started guide once ready.
-->
<p>This section contains information to troubleshoot The Things Stack deployment.</p>
<h3 id="my-cloudformation-stack-creation-failed">My CloudFormation stack creation failed</h3>
<p>The CloudFormation Events page contains information on the progress of the deployment of various AWS services. This also contains error information (if any) which can help you debug the cause of the failure.</p>
<h3 id="how-can-i-ssh-into-my-machine">How can I SSH into my machine?</h3>
<p>You can SSH into the EC2 machine using the public IP output value.</p>
<p>Log in AWS Console and open the CloudFormation resource and click on your recently deployed stack. Navigate to the <strong>Outputs</strong> tab and copy the value of the <strong>PublicIP</strong> field.</p>
<p>Now, using the private key of the <strong>SSH Key</strong> value that you entered during deployment, you can SSH into the machine using:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh -i &lt;path-to-private-key&gt; ec2-user@&lt;PublicIP&gt;
</span></span></code></pre></div><h3 id="how-can-i-see-logs-of-the-things-stack">How can I see logs of The Things Stack?</h3>
<p>The Things Stack binary runs as a <code>systemd</code> service. In order to access the logs, SSH into the machine as described above and use the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo journalctl -f -u lorawan-stack.service
</span></span></code></pre></div><h3 id="how-do-i-see-more-detailed-debug-logs-of-the-things-stack">How do I see more detailed debug logs of The Things Stack?</h3>
<p>By default, The Things Stack does not log detailed <code>DEBUG</code> messages. In order to enable this, SSH into the EC2 instance as described above and add the following lines to the file <code>/tti/lorawan-stack/config.yml</code> using an editor such as <code>nano</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">log:
</span></span><span class="line"><span class="cl">  level: debug
</span></span></code></pre></div><p>Restart the service for this to take effect:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo systemctl restart lorawan-stack.service
</span></span></code></pre></div><p>The debug logs can be read using the <code>journalctl</code>, same as above:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo journalctl -f -u lorawan-stack.service
</span></span></code></pre></div><h3 id="my-gateway-doesnt-connect-what-do-i-do">My gateway doesn&rsquo;t connect. What do I do?</h3>
<p>Please check the <a href="https://www.thethingsindustries.com/docs/gateways/troubleshooting/">Troubleshooting Gateways</a> guide.</p>
<h3 id="my-device-doesnt-join-how-do-i-fix-this">My device doesn&rsquo;t join. How do I fix this?</h3>
<p>Please check the <a href="https://www.thethingsindustries.com/docs/devices/troubleshooting/">Troubleshooting Devices</a> guide.</p>
<p>Device join failure could be due to a number of reasons. Ensure that the device settings are correct. This includes the JoinEUI, DevEUI and/or AppKey/NwkKey and the frequency plan settings. Check the logs as described above to locate the potential cause of the issue.</p>
<h3 id="i-have-tried-deploying-the-stack-a-few-times-now-i-suddenly-cannot-get-the-tls-certficate">I have tried deploying the stack a few times. Now I suddenly cannot get the TLS certficate</h3>
<p>In our stack we use Let&rsquo;s Encrypt certificates, which are requested upon stack deployment. There are quotas in place, once you hit them you need to wait before requesting a certificate again. If you&rsquo;re redeploying the stack multiple times for testing purposes, use a different domain, so that you don&rsquo;t hit the limit in your production environment. For details, please refer to the <a href="https://letsencrypt.org/docs/rate-limits/">Let&rsquo;s Encrypt website</a>.</p>
<h3 id="my-update-has-failed-and-i-dont-know-the-details">My update has failed, and I don&rsquo;t know the details</h3>
<p>You can find logs in the <code>/tti/bootstrap/*.log</code> files.</p>
<h3 id="there-are-store-errors-in-the-things-stack-logs">There are store errors in The Things Stack logs</h3>
<p>This means that The Things Stack fails to connect to the database and/or Redis. For details of your database and Redis, go to Amazon RDS and ElastiCache respectively. Refer to the <code>Resources</code> tab in the CloudFormation stack to know which RDS and ElastiCache instances belong to the The Things Stack instance. Make sure that Amazon does not signal any issues, and all metrics are within expected values. This includes, but is not limited to CPU, memory, free disk, available connections.</p>
<h3 id="migration-has-failed-with-dial-tcp-1270015432-connect-connection-refused">Migration has failed with <code>dial tcp 127.0.0.1:5432: connect: connection refused</code></h3>
<p>This error occurs when the stack executable doesn&rsquo;t properly read the configuration file.</p>
<p>To resolve this issue, you can do <code>export TTN_LW_CONFIG=/tti/lorawan-stack/config.yml</code> before running the migration command. See <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/aws/ami/updating/#database-schema-migrations">Database Schema Migrations</a>.</p>
<h3 id="how-can-i-use-a-specific-the-things-stack-binary-in-my-deployment">How can I use a specific The Things Stack binary in my deployment</h3>
<p>In order to use a specific The Things Stack binary in your deployment, run the following steps.</p>
<ol>
<li>SSH into the EC2 machine.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh ec2-user@&lt;Public IP address&gt;
</span></span></code></pre></div><ol start="2">
<li>Fetch the target version and replace the existing binary.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CURRENT_VERSION</span><span class="o">=</span>&lt;current version without the <span class="s1">&#39;v&#39;</span> prefix&gt; <span class="c1"># Example: 3.30.0</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">TARGET_VERSION</span><span class="o">=</span>&lt;target version without the <span class="s1">&#39;v&#39;</span> prefix&gt;   <span class="c1"># Example: 3.29.0</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /tti/lorawan-stack
</span></span><span class="line"><span class="cl">mv tti-lw-stack tti-lw-stack-<span class="nv">$CURRENT_VERSION</span>
</span></span><span class="line"><span class="cl">wget https://the-things-enterprise-stack-releases.s3.eu-west-1.amazonaws.com/<span class="nv">$TARGET_VERSION</span>/lorawan-stack_<span class="nv">$TARGET_VERSION_linux_amd64</span>.tar.gz
</span></span><span class="line"><span class="cl">tar -xzvf lorawan-stack_<span class="nv">$TARGET_VERSION_linux_amd64</span>.tar.gz
</span></span><span class="line"><span class="cl">cp ./lorawan-stack_<span class="nv">$TARGET_VERSION_linux_amd64</span>/tti-lw-stack ./tti-lw-stack
</span></span></code></pre></div><ol start="2">
<li>If you want to run commands with the target binary (ex: database migrations), use the following.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># This assumes that you are still in the `/tti/lorawan-stack` directory.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Check that you are using the correct version</span>
</span></span><span class="line"><span class="cl">./tti-lw-stack version
</span></span><span class="line"><span class="cl"><span class="c1"># Run an Identity Server database migration.</span>
</span></span><span class="line"><span class="cl">./tti-lw-stack is-db migrate
</span></span></code></pre></div><ol start="3">
<li>If you want to run the target The Things Stack version, use the following.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo systemctl restart lorawan-stack
</span></span></code></pre></div><ol start="4">
<li>If you want to revert to the current version, use the following.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># This assumes that you are still in the `/tti/lorawan-stack` directory.</span>
</span></span><span class="line"><span class="cl">mv tti-lw-stack tti-lw-stack-<span class="nv">$TARGET_VERSION</span>
</span></span><span class="line"><span class="cl">mv tti-lw-stack-<span class="nv">$CURRENT_VERSION</span> tti-lw-stack
</span></span><span class="line"><span class="cl">sudo systemctl restart lorawan-stack
</span></span></code></pre></div><h2 id="professional-support">Professional Support</h2>
<p>Additional paid support for this deployment is offered by The Things Industries. You can <a href="mailto:support@thethingsindustries.com">contact The Things Industries support</a> or visit <a href="https://www.thethingsindustries.com/support/">the support page</a>.</p>
        </div>
          <div class="columns is-multiline">
</div>

          <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/the-things-stack/host/aws/ami/application-server-telemetry/">← Application Server Telemetry</a>
</div>

          <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#professional-support'>Professional Support</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-third">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/the-things-stack/">The Things Stack</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
        <p><a class="" href="/docs/api/">API</a></p>
      </nav>
      <nav class="column is-one-third">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
      </nav>
      
      <nav class="column is-one-third">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.4a22f0dea0620048bc258cf6dedbdfbec40f3b5dba1dcdc6536e61e7bc20a5bf.js" integrity="sha256-SiLw3qBiAEi8JYz23tvfvsQPO126Hc3GU25h57wgpb8=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
