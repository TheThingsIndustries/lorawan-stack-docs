<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.112.3">
  <title>Migrate Active Device Session | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-between-tts-distributions/migrate-active-session/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.a66756cfe43ecf9e9bdf4eda3f7a6599499c94b1de904093e2d076c04af16f4b.css" integrity="sha256-pmdWz&#43;Q&#43;z56b307aP3plmUmclLHekECT4tB2wErxb0s=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Migrate Active Device Session">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Migrate Active Device Session">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-between-tts-distributions/migrate-active-session/">
  <meta name="twitter:title" content="Migrate Active Device Session" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NGRDCNM');</script>


</head>


<body>


<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NGRDCNM"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.25.2</p>
      </a><div class="navbar-item navbar-search-menu" id="search-input-menu">
          </div>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/the-things-stack/">The Things Stack</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a>

      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://accounts.thethingsindustries.com/fee-calculator">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
  <script type="text/javascript">
    docsearch({
      appId: "608OILUBK2",
      apiKey: "39082cdce449b93b2aa806b44f6af4d2",
      indexName: "thethingsstack",
      container: '#search-input-menu',
      debug: false, 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">The Things Stack</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/the-things-stack/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/concepts/" class="">Basic Concepts</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/cloud/" class="">The Things Stack Cloud</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/" class="">Host The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/interact/" class="">Interact with The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/management/" class="">Manage The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/" class="">Migrate to The Things Stack</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-between-tts-distributions/" class="">Migrating End Devices between The Things Stack distributions</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-between-tts-distributions/establish-new-session/" class="">Migrate Without Persisting Active Session</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-between-tts-distributions/migrate-active-session/" class="is-active">Migrate Active Device Session</a>
    
  </li>

</ul>


    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migration-tool/" class="">Migration Tool</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/" class="">Migrating End Devices from V2</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/import-devices/" class="">Import End Devices in The Things Stack</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/configure-mac-settings/" class="">Fine-tuning MAC Settings for End Devices</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/gateway-migration/" class="">Migrating Gateways</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/device-json/" class="">JSON File Reference</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/device-csv/" class="">CSV File Reference</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/faq/" class="">Migration FAQ</a>
    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/packet-broker/" class="">Packet Broker</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/troubleshooting/" class="">Troubleshooting</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">Migrate Active Device Session
          
        </h1>
        
        <div class="content">
          <p>This section explains how to migrate end devices from The Things Stack Community Edition to The Things Stack Cloud while persisting sessions that were already established between those devices and The Things Stack Community Edition.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  Keep in mind that <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-between-tts-distributions/establish-new-session/">migrating devices without persisting active sessions</a> is highly recommended.
</div>

<p>Read the instructions below to migrate your OTAA or ABP devices.</p>
<h3 id="note-on-gateway-migration">Note on Gateway Migration</h3>
<p>Even though they are both connected to <a href="https://www.thethingsindustries.com/docs/the-things-stack/packet-broker/">Packet Broker</a>, The Things Stack Community Edition and The Things Stack Cloud use different DevAddr blocks.</p>
<p>When an active device session is migrated from The Things Stack Community Edition to The Things Stack Cloud, the DevAddr that the device was assigned with (OTAA) or programmed with (ABP) when it joined The Things Stack Community Edition will be preserved. Since Packet Broker routes traffic according to the DevAddr blocks, in case of migrating an active session to The Things Stack Cloud it won&rsquo;t be able to route your device&rsquo;s traffic properly, because your device still has its Community Edition-related DevAddr.</p>
<p>Hence, to successfully migrate an active device session from The Things Stack Community Edition to The Things Stack Cloud, you also need to migrate your gateway to The Things Stack Cloud. See instructions for <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/gateway-migration/">Migrating Gateways</a>. The ideal scenario would be to migrate your gateway and your device simultaneously, in order to not loose any traffic.</p>
<h2 id="migrate-otaa-and-abp-devices">Migrate OTAA and ABP Devices</h2>
<p>Since migrating an active session implies migrating a large number of parameters that cannot be configured manually, it is possible to do it only using the <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migration-tool/">migration tool</a> or the <a href="https://www.thethingsindustries.com/docs/the-things-stack/interact/cli/">CLI</a>.</p>
<div class="tabs is-boxed">
  <ul>
    
    <li data-tab="migration-tool">
      <a>
        <span>Migration tool</span>
      </a>
    </li>
    
    <li data-tab="cli">
      <a>
        <span>CLI</span>
      </a>
    </li>
    
  </ul>
</div>
<div class="tab-content content">
  <section data-content="migration-tool">
  <p>For detailed instructions on how to configure the migration tool before exporting your device and how to adjust the following command for migrating multiple devices or whole applications, head over to <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migration-tool/export-from-tts/">Export Devices from The Things Stack</a>.</p>
<p>To export device using the <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migration-tool/">migration tool</a> with its active session, use the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-migrate device --source ttnv3 <span class="s1">&#39;my-device&#39;</span> &gt; devices.json
</span></span></code></pre></div><p>The migration tool retains session of extracted devices by default.</p>
<p>Before your device&rsquo;s session is imported in The Things Stack Cloud, you need to completely delete your device from The Things Stack Community Edition to prevent conflicts. To do it, use the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-migrate device --source ttnv3 <span class="s1">&#39;my-device&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --ttnv3.delete-source-device
</span></span></code></pre></div><p>Next, you need to import the <code>devices.json</code> file in your The Things Stack Cloud application. See instructions on how to <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/import-devices/">Import End Devices in The Things Stack</a>. Keep in mind that if you are using the CLI to import devices, you first have to configure it to connect to The Things Stack Cloud. See <a href="https://www.thethingsindustries.com/docs/the-things-stack/interact/cli/configuring-cli/">Configuring the CLI</a> guide for instructions.</p>
</section>
<section data-content="cli">
  <p>Migrating an active OTAA or ABP device session means the existing session that was established between the device and The Things Stack Community Edition will just be transferred to The Things Stack Cloud. To migrate active device sessions from The Things Stack Community Edition to The Things Stack Cloud using the CLI, follow the steps described below.</p>
<p>First, configure your CLI to connect to The Things Stack Community Edition. See <a href="https://www.thethingsindustries.com/docs/the-things-stack/interact/cli/configuring-cli/">Configuring the CLI</a> guide for instructions. Make sure you also perform a <a href="https://www.thethingsindustries.com/docs/the-things-stack/interact/cli/login/">Login with the CLI</a> to The Things Stack Community Edition.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  We recommend to use the latest version of the CLI. Instructions for upgrading the CLI if you already have it installed are available in the <a href="https://www.thethingsindustries.com/docs/the-things-stack/interact/cli/installing-cli/">Installing the CLI</a> guide.
</div>
<p>To export your OTAA device&rsquo;s session from The Things Stack Community Edition:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices get --application-id &lt;app-id&gt; --device-id &lt;device-id&gt; <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --name <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --description <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --lorawan-version <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --lorawan-phy-version <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --frequency-plan-id <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --supports-join <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --root-keys <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mac-settings <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mac-state <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --session &gt; device-session.json
</span></span></code></pre></div><p>To export your ABP device&rsquo;s session from The Things Stack Community Edition is just slightly different:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices get --application-id &lt;app-id&gt; --device-id &lt;device-id&gt; <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --name <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --description <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --lorawan-version <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --lorawan-phy-version <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --frequency-plan-id <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --supports-join <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mac-settings <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mac-state <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --session &gt; device-session.json
</span></span></code></pre></div><p>The command above will export your device&rsquo;s session to the <code>device-session.json</code> file in the current folder. Open the file with a text editor and remove the following fields: <code>join_server_address</code>, <code>network_server_address</code> and <code>application_server_address</code>.</p>
<p>Before your device&rsquo;s session is imported in The Things Stack Cloud, you need to completely delete your device from The Things Stack Community Edition to prevent conflicts.</p>
<p>Next, you need to import the <code>devices.json</code> file in your The Things Stack Cloud application. See instructions on how to <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/import-devices/">Import End Devices in The Things Stack</a>. Keep in mind that if you are using the CLI to import devices, you first have to configure it to connect to The Things Stack Cloud. Again, see <a href="https://www.thethingsindustries.com/docs/the-things-stack/interact/cli/configuring-cli/">Configuring the CLI</a> guide for instructions.</p>
</section>

</div>

<p>When your device&rsquo;s session is finally imported in The Things Stack Cloud, assuming that your gateway was also migrated to The Things Stack Cloud, you will see uplinks arriving from your device.</p>
        </div>
        
          <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/the-things-stack/migrating/migrating-between-tts-distributions/establish-new-session/">‚Üê Migrate Without Persisting Active Session</a>
</div>

          <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#migrate-otaa-and-abp-devices'>Migrate OTAA and ABP Devices</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/the-things-stack/">The Things Stack</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/ttn-network/v3/90">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Krishna Iyer on 19 Apr 2023.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/7b36a78abab91e6a6967b41f03b65551a89e54c9">
      Restructure documentation (#1076)
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/the-things-stack/migrating/migrating-between-tts-distributions/migrate-active-session/_index.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.c601451bfe16c7a1f9f8a5874bf803042c24e8aaf36ffb7ab8f2f0b1fc2d6961.js" integrity="sha256-xgFFG/4Wx6H5&#43;KWHS/gDBCwk6Krzb/t6uPLwsfwtaWE=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
