<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.112.3">
  <title>Migrate without Persisting Active Sessions | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/establish-new-session/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.1734e98fc0eb35f5e3b9f3f9a27d19d7cc102b4737ff72b5111ea78f3e79eb15.css" integrity="sha256-FzTpj8DrNfXjufP5on0Z18wQK0c3/3K1ER6njz556xU=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Migrate without Persisting Active Sessions">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Migrate without Persisting Active Sessions">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/establish-new-session/">
  <meta property="og:image" content="/docs/docs-thumbnail.png"/>
  <meta name="twitter:title" content="Migrate without Persisting Active Sessions" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NGRDCNM');</script>



  <link rel="stylesheet" href="https://ttui.thethingsindustries.com/release/1.7.2/main.css" />
</head>


<body class="theme-tts">


<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NGRDCNM"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
      </a><div class="navbar-item navbar-search-menu" id="search-input-menu">
          </div>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/the-things-stack/">The Things Stack</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a>

      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://accounts.thethingsindustries.com/fee-calculator">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
  <script type="text/javascript">
    docsearch({
      appId: "608OILUBK2",
      apiKey: "39082cdce449b93b2aa806b44f6af4d2",
      indexName: "thethingsstack",
      container: '#search-input-menu',
      debug: false, 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">The Things Stack</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/the-things-stack/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/concepts/" class="">Basic Concepts</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/cloud/" class="">The Things Stack Cloud</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/" class="">Host The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/interact/" class="">Interact with The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/management/" class="">Manage The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/" class="">Migrate to The Things Stack</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-between-tts-distributions/" class="">Migrating End Devices between The Things Stack distributions</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migration-tool/" class="">Migration Tool</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/" class="">Migrating End Devices from V2</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/major-changes/" class="">Major Changes In The Things Stack</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/packet-broker-requirements/" class="">Packet Broker Requirements for End Device Migration</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-console/" class="">Migrate using the Console</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/" class="">Migrate using the Migration Tool</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/establish-new-session/" class="is-active">Migrate without Persisting Active Sessions</a>
    
    



    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/migrate-active-session/" class="">Migrate Active Sessions</a>
    
  </li>

</ul>


    
  </li>

</ul>


    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/import-devices/" class="">Import End Devices in The Things Stack</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/configure-mac-settings/" class="">Fine-tuning MAC Settings for End Devices</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/gateway-migration/" class="">Migrating Gateways</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/device-json/" class="">JSON File Reference</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/device-csv/" class="">CSV File Reference</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/faq/" class="">Migration FAQ</a>
    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/packet-broker/" class="">Packet Broker</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/troubleshooting/" class="">Troubleshooting</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">Migrate without Persisting Active Sessions
          
        </h1>
        
        <div class="content">
          <p>This section explains how to export one or more of your end devices from V2 to a <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/device-json/">JSON file</a>, without persisting their session.</p>
<p>We strongly recommend migrating end devices without persisting active sessions.</p>
<div class="tabs is-boxed">
  <ul>
    
    <li data-tab="otaa">
      <a>
        <span>OTAA</span>
      </a>
    </li>
    
    <li data-tab="abp">
      <a>
        <span>ABP</span>
      </a>
    </li>
    
  </ul>
</div>
<div class="tab-content content">
  <section data-content="otaa">
  <p>When migrating OTAA devices without persisting active sessions, a new join needs to be performed on The Things Stack to establish a new session.</p>
<p>By establishing the new session with The Things Stack, an OTAA device gets assigned a new <strong>DevAddr</strong> and default values of some other parameters (like 5 seconds <strong>RX1 Delay</strong>). This ensures that the traffic sent by these end devices can be properly routed by the Packet Broker to and from The Things Stack.</p>
</section>
<section data-content="abp">
  <p>The <strong>DevAddr</strong> and some other parameters (like <strong>RX1 Delay</strong>) are hardcoded for ABP devices. If you do not re-program the device to change these values, you can migrate it to The Things Stack using the migration tool without its security keys, network parameters, etc. without its active session.</p>
<p>If you want your end device traffic to be routed via Packet Broker to The Things Stack, the <strong>DevAddr</strong> must be routable by the Packet Broker and the <strong>RX1 Delay</strong> value must be 5 seconds. Note that the <strong>DevAddr</strong> is routable only if you are using <strong>The Things Industries V2 (SaaS)</strong> and migrating to <strong>The Things Stack Cloud</strong>, and even that is being achieved only on customer request by contacting <a href="mailto:support@thethingsindustries.com">The Things Industries support</a>.</p>
<p>If you are not migrating from <strong>The Things Industries V2 (SaaS)</strong> to <strong>The Things Stack Cloud</strong>, Packet Broker will not be able to route your ABP device&rsquo;s traffic properly, so you will have to <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/gateway-migration/">migrate your gateway</a> to The Things Stack too. Be aware that in this case the <strong>RX1 Delay</strong> value of 1 second is persisted, and even if you do migrate your gateway, you could still be experiencing latency issues if your gateway has a high latency backhaul.</p>
<div class="notification is-warning is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Warning:</h5>
  <p>This is <strong>not a recommended practice</strong>. We advise re-programming the ABP device to change the <strong>DevAddr</strong> to the one issued by The Things Stack and <strong>RX1 Delay</strong> to 5 seconds, even if you do not want your traffic to be routed by Packet Broker.</p>
<p>In case you are able to re-program your ABP device, you will have to follow the <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-console/">Migrate using the Console</a> guide. The reason for this is that when you re-program your ABP device, its <strong>DevAddr</strong> and other parameters will no longer match the device description stored in V2, so you will not be able to export the current device description using the <code>ttn-lw-migrate</code> tool.</p>
</div>
</section>

</div>

<p>Before exporting end devices, you can first test the execution by appending the <code>--dry-run</code> and <code>--verbose</code> flags to the commands presented in the sections below.</p>
<p>Use the <code>--ttnv2.resets-to-frequency-plan</code> flag to configure the factory preset frequencies of the device, so that it can keep working with The Things Stack. The list of uplink frequencies is inferred from the <a href="https://www.thethingsindustries.com/docs/reference/frequency-plans/">Frequency Plan</a>.</p>
<h3 id="export-a-single-end-device">Export a Single End Device</h3>
<p>To export a single end device from V2:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-migrate device --source ttnv2 <span class="s2">&#34;v2-end-device-ID&#34;</span> --ttnv2.with-session<span class="o">=</span><span class="nb">false</span> &gt; devices.json
</span></span></code></pre></div><h3 id="export-a-batch-of-end-devices">Export a Batch of End Devices</h3>
<p>First, create a text file <code>device_ids.txt</code>. This file needs to contain a V2 <code>Device ID</code> for every end device you want to export from V2.</p>
<p>The format of this file is one <code>Device ID</code> per one line, i.e.:</p>
<pre tabindex="0"><code>dev1
dev2
dev3
</code></pre><p>To export a batch of end devices from V2:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-migrate device --source ttnv2 --ttnv2.with-session<span class="o">=</span><span class="nb">false</span> &lt; device_ids.txt &gt; devices.json
</span></span></code></pre></div><h3 id="export-all-end-devices-associated-with-v2-application">Export All End Devices Associated With V2 Application</h3>
<p>To export all devices contained in V2 application:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-migrate application --source ttnv2 <span class="s2">&#34;ttn-v2-application-ID&#34;</span> --ttnv2.with-session<span class="o">=</span><span class="nb">false</span> &gt; devices.json
</span></span></code></pre></div><h2 id="prevent-the-end-device-from-joining-v2-network">Prevent the End Device from Joining V2 Network</h2>
<p>Exporting end devices without their active sessions does not clear root and session keys on V2. Hence, you need to prevent your devices from re-joining the V2 network.</p>
<div class="tabs is-boxed">
  <ul>
    
    <li data-tab="otaa">
      <a>
        <span>OTAA</span>
      </a>
    </li>
    
    <li data-tab="abp">
      <a>
        <span>ABP</span>
      </a>
    </li>
    
  </ul>
</div>
<div class="tab-content content">
  <section data-content="otaa">
  To prevent OTAA device from re-joining the V2 network, the recommended practice is to change the <strong>AppKey</strong> in the V2. By changing the <strong>AppKey</strong>, the existing session on V2 will not be terminated yet, but the end device will not be able to re-join because the V2 cluster will reject its new Join Requests.
</section>
<section data-content="abp">
  ABP devices must be completely deleted from V2, especially if you have not re-programmed them with a new <strong>DevAddr</strong>. Having a device registered in V2 and The Things Stack will cause a race condition and communication issues.
</section>

</div>

<h2 id="import-end-devices-in-the-things-stack-application">Import End Devices in The Things Stack Application</h2>
<p>Now that you have exported one or more of your devices to a <code>devices.json</code> file, you can continue by importing this file in The Things Stack via Console or via CLI. See <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/import-devices/">Import End Devices in The Things Stack</a> for detailed instructions on how to do this.</p>
<div class="tabs is-boxed">
  <ul>
    
    <li data-tab="otaa">
      <a>
        <span>OTAA</span>
      </a>
    </li>
    
    <li data-tab="abp">
      <a>
        <span>ABP</span>
      </a>
    </li>
    
  </ul>
</div>
<div class="tab-content content">
  <section data-content="otaa">
  <h2 id="let-the-otaa-end-device-join-the-things-stack-network">Let the OTAA End Device Join The Things Stack Network</h2>
<p>Next, your OTAA end device needs to join The Things Stack network. Since you have not migrated your device with its active session, it will need to perform a new join.</p>
<p>Some OTAA devices ocasionally perform new joins - with these end devices, you can only wait for them to do this on their own.</p>
<p>You could also send a downlink message from the V2 Console to trigger a new join if your device supports this - contact your device maker for detailed instructions.</p>
<p>Some devices are also triggered when power cycled, or when deleted from V2.</p>
<h2 id="next-step---migrate-gateways">Next Step - Migrate Gateways</h2>
<p>Since we assume that you have not migrated your gateway from V2 yet, new Join Requests sent by your OTAA device are still being received by the V2 network. However, if you have prevented your device from joining V2 network (as recommended above), these Join Requests are not going to be accepted by the V2 Network Server.</p>
<p>Instead, these Join Requests are going to be routed to The Things Stack via Packet Broker and The Things Stack will accept them. Your OTAA device will negotiate with The Things Stack Network Server to obtain a new <strong>DevAddr</strong>, channel settings and other MAC parameters. The traffic from your end device can from now on be routed to The Things Stack thanks to the newly assigned <strong>DevAddr</strong> and <strong>RX1 Delay</strong> of 5 seconds, which fulfills the Packet Broker requirements.</p>
</section>
<section data-content="abp">
  <h2 id="next-step---migrate-gateways">Next Step - Migrate Gateways</h2>
<p>This section implies that you are keeping the <strong>DevAddr</strong> and <strong>RX1 Delay</strong> values from V2, which means Packet Broker will be able to route the traffic properly only if you are migrating from <strong>The Things Industries V2</strong> to <strong>The Things Stack Cloud</strong>. This can be only achieved on a customer request, so if this is the case please contact <a href="mailto:support@thethingsindustries.com">The Things Industries support</a> for more information.</p>
<p>If you are not migrating from <strong>The Things Industries V2</strong> to <strong>The Things Stack Cloud</strong>, please follow the guide to <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/gateway-migration/">migrate your gateway</a> to The Things Stack.</p>
</section>

</div>

<p>Even if you manage to get your end device traffic routed to The Things Stack by Packet Broker, we recommend to migrate your gateways as soon as possible.</p>
        </div>
        <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/">← Migrate using the Migration Tool</a>
<a class="button is-pulled-right" href="/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/migrate-active-session/">Migrate Active Sessions →</a>
</div>

        <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#prevent-the-end-device-from-joining-v2-network'>Prevent the End Device from Joining V2 Network</a></li>
    
      
      <li><a href='#import-end-devices-in-the-things-stack-application'>Import End Devices in The Things Stack Application</a></li>
    
      
      <li><a href='#let-the-otaa-end-device-join-the-things-stack-network'>Let the OTAA End Device Join The Things Stack Network</a></li>
    
      
      <li><a href='#next-step---migrate-gateways'>Next Step - Migrate Gateways</a></li>
    
      
      <li><a href='#next-step---migrate-gateways'>Next Step - Migrate Gateways</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/the-things-stack/">The Things Stack</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/ttn-network/v3/90">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Krishna Iyer on 19 Apr 2023.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/7b36a78abab91e6a6967b41f03b65551a89e54c9">
      Restructure documentation (#1076)
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/establish-new-session.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.4a22f0dea0620048bc258cf6dedbdfbec40f3b5dba1dcdc6536e61e7bc20a5bf.js" integrity="sha256-SiLw3qBiAEi8JYz23tvfvsQPO126Hc3GU25h57wgpb8=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
