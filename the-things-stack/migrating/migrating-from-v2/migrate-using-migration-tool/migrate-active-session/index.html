<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.96.0" />
  <title>Migrate Active Sessions | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/migrate-active-session/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.8058c473c43c01571dbb7b1b4de287fb8e077613d282e9b7b9db17271211dd60.css" integrity="sha256-gFjEc8Q8AVcdu3sbTeKH&#43;44HdhPSgum3udsXJxIR3WA=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Migrate Active Sessions">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Migrate Active Sessions">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/migrate-active-session/">
  <meta name="twitter:title" content="Migrate Active Sessions" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NGRDCNM');</script>


</head>


<body>


<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NGRDCNM"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.25.2</p>
      </a><div class="navbar-item navbar-search-menu" id="search-input-menu">
          </div>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/the-things-stack/">The Things Stack</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a>

      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://accounts.thethingsindustries.com/fee-calculator">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
  <script type="text/javascript">
    docsearch({
      appId: "608OILUBK2",
      apiKey: "39082cdce449b93b2aa806b44f6af4d2",
      indexName: "thethingsstack",
      container: '#search-input-menu',
      debug: false, 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">The Things Stack</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/the-things-stack/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/concepts/" class="">Basic Concepts</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/cloud/" class="">The Things Stack Cloud</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/" class="">Host The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/interact/" class="">Interact with The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/management/" class="">Manage The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/" class="">Migrate to The Things Stack</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-between-tts-distributions/" class="">Migrating End Devices between The Things Stack distributions</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migration-tool/" class="">Migration Tool</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/" class="">Migrating End Devices from V2</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/major-changes/" class="">Major Changes In The Things Stack</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/packet-broker-requirements/" class="">Packet Broker Requirements for End Device Migration</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-console/" class="">Migrate using the Console</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/" class="">Migrate using the Migration Tool</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/establish-new-session/" class="">Migrate without Persisting Active Sessions</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/migrate-active-session/" class="is-active">Migrate Active Sessions</a>
    
    



    
  </li>

</ul>


    
  </li>

</ul>


    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/import-devices/" class="">Import End Devices in The Things Stack</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/configure-mac-settings/" class="">Fine-tuning MAC Settings for End Devices</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/gateway-migration/" class="">Migrating Gateways</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/device-json/" class="">JSON File Reference</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/device-csv/" class="">CSV File Reference</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/faq/" class="">Migration FAQ</a>
    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/packet-broker/" class="">Packet Broker</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/troubleshooting/" class="">Troubleshooting</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">Migrate Active Sessions
          
        </h1>
        
        <div class="content">
          <p>Starting from The Things Stack version <code>3.12.0</code>, it is possible to migrate end devices together with their active sessions using the <code>ttn-lw-migrate</code> tool. This section explains how to export one or more of your end devices from V2 to a <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/device-json/">JSON file</a>, with persisting their active sessions.</p>
<p>Active device sessions can be migrated via Packet Broker only from <strong>The Things Industries V2 (SaaS)</strong> to <strong>The Things Stack Cloud</strong>, and this is achievable only on a customer request. Contact <a href="mailto:support@thethingsindustries.com">The Things Industries support</a> for more information.</p>
<p>For all other scenarios, migrating active session is achievable only if you <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/gateway-migration/">migrate your gateway to The Things Stack</a> too.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  We strongly recommend migrating end devices without persisting active sessions.
</div>

<div class="tabs is-boxed">
  <ul>
    
    <li data-tab="otaa">
      <a>
        <span>OTAA</span>
      </a>
    </li>
    
    <li data-tab="abp">
      <a>
        <span>ABP</span>
      </a>
    </li>
    
  </ul>
</div>
<div class="tab-content content">
  <section data-content="otaa">
  In the case of persisting active sessions during migration, OTAA devices do not need to perform a new join on The Things Stack network, but their existing session will be transferred from V2.
</section>
<section data-content="abp">
  The <strong>DevAddr</strong> and some other parameters (like <strong>RX1 Delay</strong>) are hardcoded for ABP devices. If you do not re-program the device to change these values, you can migrate it to The Things Stack with its active session.
</section>

</div>

<p>Remember that if you are not migrating specifically from <strong>The Things Industries V2 (SaaS)</strong> to <strong>The Things Stack Cloud</strong>, you will have to <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/gateway-migration/">migrate your gateway</a> to successfully migrate your end device with its active session.</p>
<div class="notification is-warning is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Warning:</h5>
  Exporting end devices with their active sessions will clear their root and session keys from V2, so these devices will automatically no longer work on V2.
</div>

<p>Before exporting end devices, you can first test the execution by appending the <code>--dry-run</code> and <code>--verbose</code> flags to the commands presented in the sections below.</p>
<p>Use the <code>--ttnv2.resets-to-frequency-plan</code> flag to configure the factory preset frequencies of the device, so that it can keep working with The Things Stack. The list of uplink frequencies is inferred from the <a href="https://www.thethingsindustries.com/docs/reference/frequency-plans/">Frequency Plan</a>.</p>
<h3 id="export-a-single-end-device">Export a Single End Device</h3>
<p>To export a single end device from V2 and clear its security keys:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-migrate device --source ttnv2 <span class="s2">&#34;v2-end-device-ID&#34;</span> &gt; devices.json
</span></span></code></pre></div><h3 id="export-a-batch-of-end-devices">Export a Batch of End Devices</h3>
<p>First, create a text file <code>device_ids.txt</code>. This file needs to contain a V2 <strong>Device ID</strong> for every end device you want to export from V2.</p>
<p>The format of this file is one <strong>Device ID</strong> per one line, i.e.:</p>
<pre tabindex="0"><code>dev1
dev2
dev3
</code></pre><p>To export a batch of end devices from V2 and clear their security keys:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-migrate device --source ttnv2 &lt; device_ids.txt &gt; devices.json
</span></span></code></pre></div><h3 id="export-all-end-devices-associated-with-v2-application">Export All End Devices Associated With V2 Application</h3>
<p>To export all devices contained in V2 application and clear their security keys:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-migrate application --source ttnv2 <span class="s2">&#34;ttn-v2-application-ID&#34;</span> &gt; devices.json
</span></span></code></pre></div><h2 id="import-end-devices-in-the-things-stack-application">Import End Devices in The Things Stack Application</h2>
<p>Now that you have exported one or more of your devices to a <code>devices.json</code> file, you can continue by importing this file in The Things Stack via Console or via CLI.</p>
<blockquote>
<p>See <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/import-devices/">Import End Devices in The Things Stack</a> for detailed instructions on how to do this.</p>
</blockquote>
<h2 id="next-step---migrate-gateways">Next Step - Migrate Gateways</h2>
<div class="tabs is-boxed">
  <ul>
    
    <li data-tab="otaa">
      <a>
        <span>OTAA</span>
      </a>
    </li>
    
    <li data-tab="abp">
      <a>
        <span>ABP</span>
      </a>
    </li>
    
  </ul>
</div>
<div class="tab-content content">
  <section data-content="otaa">
  Migrating your OTAA device from <strong>The Things Industries V2 (SaaS)</strong> to <strong>The Things Stack Cloud</strong> with its active session means it will keep its <strong>DevAddr</strong>, channel settings and MAC parameters from V2. It will not send new Join Requests, but the uplink traffic from your device should automatically show up in The Things Stack, because it will be routed via Packet Broker thanks to preserving your device&rsquo;s existing session.
</section>
<section data-content="abp">
  Migrating your ABP device from V2 to The Things Stack with its active session means it will keep its <strong>DevAddr</strong>, channel settings and MAC parameters from V2, i.e. the existing session will be preserved.
</section>

</div>

<p>If you are migrating an end device with its active session via Packet Broker (from <strong>The Things Industries V2</strong> to <strong>The Things Stack Cloud</strong>), you might need to set the <strong>RX1 Delay</strong> of the device to 5 seconds by <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/configure-mac-settings/">configuring MAC settings</a>, otherwise the traffic might not reach The Things Stack in time via Packet Broker.</p>
<p>In case you want to leave the <strong>RX1 Delay</strong> value as is (1 second from V2), you will need to <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/gateway-migration/">migrate your gateway to The Things Stack</a> too.</p>
<p>Even if you manage to get your end device traffic routed to The Things Stack by Packet Broker, we recommend to migrate your gateways as soon as possible.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  If you have migrated your device from V2 to The Things Stack with an active session but cannot see any uplinks from the device on The Things Stack, see <a href="https://www.thethingsindustries.com/docs/devices/troubleshooting/#i-can-see-some-received-uplinks-in-gateway-live-data-events-but-i-do-not-see-them-in-device-events">Troubleshooting Devices</a>.
</div>
        </div>
        <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/establish-new-session/">‚Üê Migrate without Persisting Active Sessions</a>
</div>

        <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#import-end-devices-in-the-things-stack-application'>Import End Devices in The Things Stack Application</a></li>
    
      
      <li><a href='#next-step---migrate-gateways'>Next Step - Migrate Gateways</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/the-things-stack/">The Things Stack</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/ttn-network/v3/90">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Krishna Iyer on 19 Apr 2023.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/7b36a78abab91e6a6967b41f03b65551a89e54c9">
      Restructure documentation (#1076)
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/migrate-active-session.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.a32708c8796e7e8713fa926212adddbbf5c15cdd97676d898ecfc17bc6d9ed4f.js" integrity="sha256-oycIyHlufocT&#43;pJiEq3du/XBXN2XZ22Jjs/Be8bZ7U8=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
