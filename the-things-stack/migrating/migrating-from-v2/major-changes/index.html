<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.134.2">
  <title>Major Changes In The Things Stack | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/major-changes/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.5ba0be8f5f0e953584382f5875ae6ec65f7a9a9cda0dea27bd9ddb1025d10fa5.css" integrity="sha256-W6C&#43;j18OlTWEOC9Yda5uxl96mpzaDeonvZ3bECXRD6U=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
  <meta name="description" content="The Things Stack for LoRaWAN">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Major Changes In The Things Stack">
  <meta itemprop="description" content="The Things Stack for LoRaWAN">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Major Changes In The Things Stack">
  <meta property="og:description" content="The Things Stack for LoRaWAN">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/major-changes/">
  <meta property="og:image" content="/docs/docs-thumbnail.png"/>
  <meta name="twitter:title" content="Major Changes In The Things Stack" />
  <meta name="twitter:description" content="The Things Stack for LoRaWAN" />
  <meta name="twitter:card" content="summary" />
  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NGRDCNM');</script>



  <link rel="stylesheet" href="https://ttui.thethingsindustries.com/release/1.10.1/main.css" />
</head>


<body class="theme-tts">


<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NGRDCNM"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
      </a><div class="navbar-item navbar-search-menu" id="search-input-menu">
          </div>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/the-things-stack/">The Things Stack</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a>
        <a class="navbar-item" href="/docs/api/">API</a>

      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://www.thethingsindustries.com/stack/plans/" target="_blank">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
  <script type="text/javascript">
    docsearch({
      appId: "608OILUBK2",
      apiKey: "39082cdce449b93b2aa806b44f6af4d2",
      indexName: "thethingsstack",
      container: '#search-input-menu',
      debug: false, 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">The Things Stack</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/the-things-stack/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/concepts/" class="">Basic Concepts</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/cloud/" class="">The Things Stack Cloud</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/host/" class="">Host The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/interact/" class="">Interact with The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/management/" class="">Manage The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/" class="">Migrate to The Things Stack</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-between-tts-distributions/" class="">Migrating End Devices between The Things Stack distributions</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migration-tool/" class="">Migration Tool</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/" class="">Migrating End Devices from V2</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/major-changes/" class="is-active">Major Changes In The Things Stack</a>
    
    



    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/packet-broker-requirements/" class="">Packet Broker Requirements for End Device Migration</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-console/" class="">Migrate using the Console</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/migrate-using-migration-tool/" class="">Migrate using the Migration Tool</a>
    
  </li>

</ul>


    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/configure-mac-settings/" class="">Fine-tuning MAC Settings for End Devices</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/gateway-migration/" class="">Migrating Gateways</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/faq/" class="">Migration FAQ</a>
    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/packet-broker/" class="">Packet Broker</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/works-with/" class="">Works with The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/alerting/" class="">Alerting in The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/the-things-stack/troubleshooting/" class="">Troubleshooting</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">Major Changes In The Things Stack
          
        </h1>
        
        <div class="content">
          <p>Before going in detail with the migration process, this section will give you a breakdown of differences between V2 and The Things Stack, along with some guidelines to make the migration process easier to manage.</p>
<h2 id="architecture">Architecture</h2>
<p>The Things Stack is made up of several components, which can be run redundantly and on distributed servers to improve scalability and robustness. See <a href="https://www.thethingsindustries.com/docs/reference/components/">Components</a> for a complete overview of the different components of The Things Stack.</p>
<h2 id="lorawan-support">LoRaWAN support</h2>
<p>The Things Stack brings full support for all LoRaWAN® versions, as well as modes to support class B and class C capabilities.</p>
<p>The Things Stack requires the LoRaWAN version (MAC) and Regional Parameters version (LoRaWAN PHY version) to be set per end device. These default to LoRaWAN version <strong>MAC V1.0.2</strong> and LoRaWAN Regional Parameters version <strong>PHY V1.0.2 Rev B</strong> for end devices imported from V2, because this configuration is the most commonly used one.</p>
<p>End devices also need to be set with a frequency plan. You will have to choose the frequency plan corresponding to your region. See <a href="https://www.thethingsindustries.com/docs/reference/frequency-plans/">Frequency Plans</a> for a list of supported Frequency Plans and their respective IDs.</p>
<h2 id="rx1-delay">RX1 Delay</h2>
<p>The RX1 delay is the time after which the first receive window (RX1) opens. In the receive window, the Network Server can schedule a downlink. The second receive window (RX2) opens exactly 1 second after the first one opens. In LoRaWAN, the RX1 delay can be between 1 and 15 seconds.</p>
<p>Devices imported from V2 are configured with an RX1 delay of 1 second. In all The Things Stack deployments, the recommended RX1 delay is 5 seconds to accommodate for high latency backhauls and/or <a href="https://www.thethingsindustries.com/docs/the-things-stack/packet-broker/">peering with Packet Broker</a>.</p>
<p>See the <a href="https://www.thethingsindustries.com/docs/devices/configuring-devices/mac-settings/">MAC settings guide</a> for more information and instructions about configuring the RX1 delay.</p>
<h2 id="mac-commands">MAC Commands</h2>
<p>The Things Stack expects that all end devices comply with the LoRaWAN specification by default, which means that the end devices should respond to Network Server MAC command requests accordingly. If a device fails to answer a MAC Command in a timely manner, there may be disruptions to the device uplink or downlink traffic. As mentioned in the LoRaWAN specification, the Network Server of The Things Stack will always prioritize MAC commands over application payloads on downlink.</p>
<p>In case a device is not fully compliant with the LORaWAN specification, it can still work on The Things Stack, but it may require custom <a href="https://www.thethingsindustries.com/docs/devices/configuring-devices/mac-settings/">MAC settings configuration</a>.</p>
<h3 id="devstatusreq">DevStatusReq</h3>
<p>The <code>DevStatusReq</code> MAC command is sent by the Network Server periodically to check the current status of the end device. Devices are expected to send a <code>DevStatusAns</code> reply.</p>
<p>For end devices that ignore this MAC command, make sure to configure the <code>StatusTimePeriodicity</code> (time duration after which a <code>DevStatusReq</code> is issued by the Network Server) and <code>StatusCountPeriodicity</code> (number of frames after which a <code>DevStatusReq</code> is issued) of the device explicitly to <code>0</code>.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  In the scope of <a href="https://www.thethingsindustries.com/docs/the-things-stack/migrating/migrating-from-v2/">Migrating from The Things Network Stack V2</a>, devices exported with the <code>ttn-lw-migrate</code> tool have these MAC settings set to <code>0</code> by default.
</div>

<p>See the <a href="https://www.thethingsindustries.com/docs/devices/configuring-devices/mac-settings/">MAC settings guide</a> for more information.</p>
<h2 id="gateway-coverage">Gateway Coverage</h2>
<p><a href="https://www.thethingsindustries.com/docs/the-things-stack/packet-broker/">Packet Broker</a> enables peering between networks, so traffic received by one network (The Things Network V2) but intended for a different network (The Things Stack) can be forwarded to and from that network. With Packet Broker enabled on both The Things Stack and The Things Network V2, you can receive traffic on The Things Stack without having to re-configure any of your gateways.</p>
<p>Packet Broker is already enabled on The Things Network V2 and The Things Stack Cloud. For The Things Stack Enterprise or The Things Stack Open Source, see how to <a href="https://www.thethingsindustries.com/docs/the-things-stack/packet-broker/connect/">Connect</a> to Packet Broker.</p>
<p>For private The Things Stack deployments with Packet Broker disabled, you will need to re-configure your gateways to connect to The Things Stack, so that you can start receiving traffic from your end devices.</p>
<p>In order to connect a gateway to The Things Stack, first follow instructions for <a href="https://www.thethingsindustries.com/docs/gateways/concepts/adding-gateways/">Adding Gateways</a>,then reconfigure the gateway to connect to The Things Stack, and regenerate its API key (if required). See <a href="https://www.thethingsindustries.com/docs/gateways/">Gateways</a> for instructions on configuring popular LoRaWAN gateways with The Things Stack.</p>
<h2 id="application-data">Application Data</h2>
<p>The Things Stack uses a different data format for uplink and downlink traffic than V2.</p>
<p>For details on the data format of V2, see the documentation from <a href="https://www.thethingsnetwork.org/docs/applications/mqtt/api.html">The Things Network</a>.</p>
<p>For details on the data format of The Things Stack, see <a href="https://www.thethingsindustries.com/docs/the-things-stack/concepts/data-formats/">Data Formats</a> section. It uses a different schema, different names, and has much richer metadata support.</p>
<h3 id="payload-formats">Payload Formats</h3>
<p>V2 has support for payload decoders, converters, validators (for uplink) and encoders (for downlink). These can be either CayenneLPP or Javascript functions.</p>
<p>The Things Stack has support for an uplink payload formatter (similar to the payload decoder) and a downlink payload formatter (similar to the payload encoder). These can be set per application, and can even be overridden per end device. CayenneLPP and Javascript functions are still supported, and now payload formatters can also be fetched from the Device Repository.</p>
<p>Migrating the V2 payload encoder and decoder to an uplink and downlink payload formatter should be straightforward.</p>
<p>See <a href="https://www.thethingsindustries.com/docs/integrations/payload-formatters/">Payload Formatters</a> for more details.</p>
<h3 id="integrations">Integrations</h3>
<p>Read the full documentation dedicated to <a href="https://www.thethingsindustries.com/docs/integrations/">Integrations</a> supported by The Things Stack.</p>
<h4 id="mqtt-traffic">MQTT Traffic</h4>
<p>The Things Stack has a new MQTT server address, so you will need to change this address in your application accordingly. You will also need to create API keys and update your MQTT credentials.</p>
<p>Read more in the <a href="https://www.thethingsindustries.com/docs/integrations/mqtt/">MQTT Server</a> section.</p>
<h4 id="webhooks">Webhooks</h4>
<p>The HTTP Integration is now called HTTP Webhooks. The payload format, downlink endpoints, paths and security settings have changed.</p>
<p>Read more in the <a href="https://www.thethingsindustries.com/docs/integrations/webhooks/">HTTP Webhooks</a> section.</p>
<h4 id="storage-integration">Storage Integration</h4>
<p>The Things Stack supports a Storage Integration similar to V2.</p>
<p>Read details in the <a href="https://www.thethingsindustries.com/docs/integrations/storage/">Storage Integration</a> section.</p>
<h2 id="api-comparison">API Comparison</h2>
<p>The Things Stack provides multiple APIs. See the full <a href="https://www.thethingsindustries.com/docs/api/reference/grpc/">API documentation</a>.</p>
<p>For example, a comparison between The Things Industries V2 and The Things Stack MQTT API is given below.</p>
<h3 id="mqtt-connection-details">MQTT Connection Details</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left"><strong>Category/Type</strong></th>
          <th style="text-align: left"><strong>The Things Industries V2</strong></th>
          <th style="text-align: left"><strong>The Things Stack</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">MQTT Public Address</td>
          <td style="text-align: left"><code>{tenant_id}.thethings.industries:1883</code></td>
          <td style="text-align: left"><code>https://thethings.example.com:1883</code> (replace with the URL of your deployment)</td>
      </tr>
      <tr>
          <td style="text-align: left">MQTT Public TLS Address</td>
          <td style="text-align: left"><code>{tenant_id}.thethings.industries:8883</code> (with using an appropriate TLS certificate)</td>
          <td style="text-align: left"><code>https://thethings.example.com:8883</code></td>
      </tr>
      <tr>
          <td style="text-align: left">Username</td>
          <td style="text-align: left"><code>{application_id}</code></td>
          <td style="text-align: left"><code>{application_id}@{tenant_id}</code></td>
      </tr>
      <tr>
          <td style="text-align: left">Password</td>
          <td style="text-align: left">Application Access Key (with default rights)</td>
          <td style="text-align: left">Application API Key (with <strong>Write downlink application traffic</strong> and <strong>Read application traffic (uplink and downlink)</strong> rights)</td>
      </tr>
      <tr>
          <td style="text-align: left">Uplink topic (subscribe)</td>
          <td style="text-align: left"><code>{application_id}/devices/{device_id}/up</code></td>
          <td style="text-align: left"><code>v3/{application id}@{tenant id}/devices/{device id}/up</code></td>
      </tr>
      <tr>
          <td style="text-align: left">Downlink scheduling topic (pub)</td>
          <td style="text-align: left"><code>{application_id}/devices/{device_id}/downSchedule</code> (the downlink as the first or last item in a downlink queue using <code>schedule</code> key value in the payload)</td>
          <td style="text-align: left">Push downlink - <code>v3/{application id}@{tenant id}/devices/{device id}/down/push</code>,                                   Replace downlink queue - <code>v3/{application id}@{tenant id}/devices/{device id}/down/replace</code></td>
      </tr>
  </tbody>
</table>
<h3 id="uplinks">Uplinks</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left"><strong>Category/Type</strong></th>
          <th style="text-align: left"><strong>The Things Industries V2</strong></th>
          <th style="text-align: left"><strong>The Things Stack</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">Overall Uplink Format</td>
          <td style="text-align: left"><details><summary>Show example</summary> {<br>&ldquo;app_id&rdquo;: &ldquo;my-app-id&rdquo;, <br>&ldquo;dev_id&rdquo;: &ldquo;my-dev-id&rdquo;, <br>&ldquo;hardware_serial&rdquo;: &ldquo;0102030405060708&rdquo;,<br>&ldquo;port&rdquo;: 1, <br>&ldquo;counter&rdquo;: 2, <br>&ldquo;is_retry&rdquo;: false, <br>&ldquo;confirmed&rdquo;: false, <br>&ldquo;payload_raw&rdquo;: &ldquo;AQIDBA==&rdquo;, <br>&ldquo;payload_fields&rdquo;: {<br>&ldquo;temperature&rdquo;: 1.0,<br>&ldquo;luminosity&rdquo;: 0.64<br>},, <br>&ldquo;metadata&rdquo;: {<br>&ldquo;airtime&rdquo;: 46336000, <br>&ldquo;time&rdquo;: &ldquo;1970-01-01T00:00:00.000000000Z&rdquo;, <br>&ldquo;frequency&rdquo;: 868.1, <br>&ldquo;modulation&rdquo;: &ldquo;LORA&rdquo;, <br>&ldquo;data_rate&rdquo;: &ldquo;SF7BW125&rdquo;,<br>&ldquo;coding_rate&rdquo;: &ldquo;4/5&rdquo;, <br>&ldquo;gateways&rdquo;: [<br>{<br>&ldquo;gtw_id&rdquo;: &ldquo;ttn-herengracht-ams&rdquo;, <br>&ldquo;timestamp&rdquo;: 12345, <br>&ldquo;time&rdquo;: &ldquo;1970-01-01T00:00:00.000000000Z&rdquo;, <br>&ldquo;channel&rdquo;: 2, <br>&ldquo;rssi&rdquo;: -25, <br>&ldquo;snr&rdquo;: 5, <br>&ldquo;rf_chain&rdquo;: 0, <br>&ldquo;latitude&rdquo;: 52.1234, <br>&ldquo;longitude&rdquo;: 6.1234, <br>&ldquo;altitude&rdquo;: 6 <br>},<br>//&hellip;more if received by more gateways&hellip;<br>],<br>&ldquo;latitude&rdquo;: 52.2345, <br>&ldquo;longitude&rdquo;: 6.2345, <br>&ldquo;altitude&rdquo;: 2 <br>}<br>} </details></td>
          <td style="text-align: left"><details><summary>Show example</summary> {<br>&ldquo;end_device_ids&rdquo; : {<br>&ldquo;device_id&rdquo; : &ldquo;my-dev-id&rdquo;,<br>&ldquo;application_ids&rdquo; : {<br>&ldquo;application_id&rdquo; : &ldquo;my-app-id&rdquo;<br>},<br>&ldquo;dev_eui&rdquo; : &ldquo;0102030405060708&rdquo;,<br>&ldquo;join_eui&rdquo; : &ldquo;0102030405060708&rdquo;,<br>&ldquo;dev_addr&rdquo; : &ldquo;01020304&rdquo;<br>},<br>&ldquo;correlation_ids&rdquo; : [<br>// …<br>],<br>&ldquo;received_at&rdquo; : &ldquo;1970-01-01T00:00:00.000000000Z&rdquo;,<br>&ldquo;uplink_message&rdquo; : {<br>&ldquo;session_key_id&rdquo; : &ldquo;AXA50tHUGUucuzS/bCGMNw==&rdquo;,<br>&ldquo;f_cnt&rdquo; : 1,<br>&ldquo;frm_payload&rdquo; : &ldquo;AQIDBA==&rdquo;,<br>&ldquo;decoded_payload&rdquo; : {<br>&ldquo;temperature&rdquo;: 1.0,<br>&ldquo;luminosity&rdquo;: 0.64<br>},<br>&ldquo;rx_metadata&rdquo; : [ {<br>&ldquo;gateway_ids&rdquo; : {<br>&ldquo;gateway_id&rdquo; : &ldquo;ttn-herengracht-ams&rdquo;,<br>&ldquo;eui&rdquo; : &ldquo;9C5C8E00001A05C4&rdquo;<br>},<br>&ldquo;time&rdquo; : &ldquo;1970-01-01T00:00:00.000000000Z&rdquo;,<br>&ldquo;timestamp&rdquo; : 12345,<br>&ldquo;rssi&rdquo; : -25,<br>&ldquo;channel_rssi&rdquo; : -25,<br>&ldquo;snr&rdquo; : 5,<br>&ldquo;uplink_token&rdquo; : &ldquo;ChIKEAoEZ3R3MRIInFyOAAAaBcQQ6L3Vlgk=&rdquo;,<br>&ldquo;channel_index&rdquo; : 2<br>} ],<br>&ldquo;settings&rdquo; : {<br>&ldquo;data_rate&rdquo; : {<br>&ldquo;lora&rdquo; : {<br>&ldquo;bandwidth&rdquo; : 125000,<br>&ldquo;spreading_factor&rdquo; : 7<br>}<br>},<br>&ldquo;data_rate_index&rdquo; : 5,<br>&ldquo;coding_rate&rdquo; : &ldquo;4/5&rdquo;,<br>&ldquo;frequency&rdquo; : &ldquo;868100000&rdquo;,<br>&ldquo;timestamp&rdquo; : 12345,<br>&ldquo;time&rdquo; : &ldquo;1970-01-01T00:00:00.000000000Z&rdquo;<br>},<br>&ldquo;received_at&rdquo; : &ldquo;1970-01-01T00:00:00.000000000Z&rdquo;<br>,&ldquo;consumed_airtime&rdquo;: &ldquo;0.051321s&rdquo;,<br>&ldquo;locations&rdquo;: {<br>&ldquo;user&rdquo;: {<br>&ldquo;latitude&rdquo;: 37.97155556731436,<br>&ldquo;longitude&rdquo;: 23.72678801175413,<br>&ldquo;altitude&rdquo;: 10,<br>&ldquo;source&rdquo;: &ldquo;SOURCE_REGISTRY&rdquo;<br>}<br>},}<br>} </details></td>
      </tr>
      <tr>
          <td style="text-align: left">Gateway fields</td>
          <td style="text-align: left"><code>metadata.gateways</code> - This object includes gateway details</td>
          <td style="text-align: left"><code>uplink_message.rx_metadata</code> - This object includes gateway details</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.gateways.timestamp</code> - Timestamp when the gateway received the message (microseconds)</td>
          <td style="text-align: left"><code>uplink_message.rx_metadata.timestamp</code> - Gateway concentrator timestamp when the Rx finished (microseconds)</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.gateways.time</code> - Time when the gateway received the message</td>
          <td style="text-align: left"><code>uplink_message.rx_metadata.time</code> - Time when the gateway received the message</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.gateways.channel</code> - Channel where the gateway received the message</td>
          <td style="text-align: left">As an alternative <code>channel_index</code> is <code>available.uplink_message.rx_metadata.channel_index</code> - Index of the gateway channel that received the message</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.gateways.rssi</code> - Signal strength of the received message</td>
          <td style="text-align: left"><code>uplink_message.rx_metadata.rssi</code> - Signal strength of the received message</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.gateways.snr</code> - Signal to noise ratio of the received message</td>
          <td style="text-align: left"><code>uplink_message.rx_metadata.snr</code> - Signal to noise ratio of the received message</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.gateways.rf_chain</code> - RF chain where the gateway received the message</td>
          <td style="text-align: left">Not available</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.gateways.latitude</code> - Latitude of the gateway reported in its status updates</td>
          <td style="text-align: left">Not available</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.gateways.longitude</code> - Longitude of the gateway</td>
          <td style="text-align: left">Not available</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.gateways.altitude</code> - Altitude of the gateway</td>
          <td style="text-align: left">Not available</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left">Not available</td>
          <td style="text-align: left"><code>uplink_message.rx_metadata.channel_rssi</code> - Received signal strength indicator of the channel (dBm)</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left">Not available</td>
          <td style="text-align: left"><code>uplink_message.rx_metadata.uplink_token</code> - Uplink token injected by gateway, Gateway Server or Network Server</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"></td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left">Uplink Metadata</td>
          <td style="text-align: left"><code>metadata</code> - This object includes metadata</td>
          <td style="text-align: left"><code>uplink_message</code> - This object includes metadata</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.airtime</code></td>
          <td style="text-align: left"><code>uplink_message.consumed_airtime</code> - Formatted as a string, with a suffix for the unit used (for example, <code>&quot;0.051321s&quot;</code> is 0.051321 seconds)</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.time</code> - Time when the server received the message</td>
          <td style="text-align: left"><code>uplink_message.received_at</code> - Server time when the Application Server received the message</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.frequency</code> - Frequency at which the message was sent</td>
          <td style="text-align: left"><code>uplink_message.settings.frequency</code> - Frequency (Hz)</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.modulation</code> - Modulation that was used (LoRa or FSK)</td>
          <td style="text-align: left">Not available, but as an alternative the modulation can be derived from <code>settings.data_rate</code></td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.data_rate</code> - Data rate that was used (LoRa only)</td>
          <td style="text-align: left"><code>uplink_message.settings.data_rate</code> - Data rate of LoRa or FSK</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.bit_rate</code> - Bit rate that was used (FSK only)</td>
          <td style="text-align: left"><code>uplink_message.settings.data_rate.fsk.bit_rate</code> - Bit rate that was used (FSK only)</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.coding_rate</code> - Coding rate that was used</td>
          <td style="text-align: left"><code>uplink_message.settings.coding_rate</code> - LoRa coding rate</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.latitude</code></td>
          <td style="text-align: left"><code>uplink_message.locations.user.latitude</code> - Latitude of the device</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.longitude</code></td>
          <td style="text-align: left"><code>uplink_message.locations.user.longitude</code> - Longitude of the device</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.altitude</code></td>
          <td style="text-align: left"><code>uplink_message.locations.user.altitude</code> - Altitude of the device</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left">Not available</td>
          <td style="text-align: left"><code>uplink_message.locations.user.source</code> - Location source</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.data_rate_index</code> - Not available</td>
          <td style="text-align: left"><code>uplink_message.data_rate_index</code> - LoRaWAN data rate index</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>metadata.payload_raw</code> - Base64 encoded payload: [0x01, 0x02, 0x03, 0x04]</td>
          <td style="text-align: left"><code>uplink_message.frm_payload</code> - Frame payload (Base64)</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>port</code> - LoRaWAN FPort</td>
          <td style="text-align: left"><code>uplink_message.f_port</code> - LoRaWAN FPort</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>counter</code> - LoRaWAN frame counter</td>
          <td style="text-align: left"><code>uplink_message.f_cnt</code> - LoRaWAN frame counter</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left">Not available</td>
          <td style="text-align: left"><code>uplink_message.session_key_id</code> - Join Server issued identifier for the session keys used by this uplink</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"></td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left">Common fields</td>
          <td style="text-align: left"><code>app_id</code></td>
          <td style="text-align: left"><code>end_device_ids.application_ids.application_id</code></td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>dev_id</code></td>
          <td style="text-align: left"><code>end_device_ids.device_id</code></td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>hardware_serial</code> - In case of LoRaWAN: the <code>DevEUI</code></td>
          <td style="text-align: left"><code>end_device_ids.dev_eui</code></td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>confirmed</code> - <code>true</code> if this message was a confirmed message</td>
          <td style="text-align: left">Not available</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left">Not available</td>
          <td style="text-align: left"><code>end_device_ids.join_eui</code></td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left">Not available</td>
          <td style="text-align: left"><code>end_device_ids.dev_addr</code></td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"></td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left">Uplink Payload fiedls</td>
          <td style="text-align: left"><code>payload_fields</code> - Object containing the results from the payload functions (left out when empty)</td>
          <td style="text-align: left"><code>uplink_message.decoded_payload</code></td>
      </tr>
      <tr>
          <td style="text-align: left">Correlation IDs</td>
          <td style="text-align: left">Not available</td>
          <td style="text-align: left"><code>correlation_ids</code></td>
      </tr>
  </tbody>
</table>
<h3 id="downlinks">Downlinks</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left"><strong>Category/Type</strong></th>
          <th style="text-align: left"><strong>The Things Industries V2</strong></th>
          <th style="text-align: left"><strong>The Things Stack</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">Downlink message overall format</td>
          <td style="text-align: left"><details><summary>Show example</summary>{<br>&ldquo;port&rdquo;: 1, <br>&ldquo;confirmed&rdquo;: false,<br>&ldquo;payload_raw&rdquo;: &ldquo;AQIDBA==&rdquo;, <br>&ldquo;schedule&rdquo;: &ldquo;replace&rdquo;,<br>}<br><br> or use payload_fields instead <br><br> {<br>&ldquo;port&rdquo;: 1,<br>&ldquo;confirmed&rdquo;: false,<br>&ldquo;payload_fields&rdquo;: {<br>&ldquo;led&rdquo;: true<br>},<br>&ldquo;schedule&rdquo;: &ldquo;replace&rdquo;, // allowed values: &ldquo;replace&rdquo; (default), &ldquo;first&rdquo;, &ldquo;last&rdquo;} </details></td>
          <td style="text-align: left"><details><summary>Show example</summary> {<br>&ldquo;downlinks&rdquo;: [{<br>&ldquo;f_port&rdquo;: 15,<br>&ldquo;frm_payload&rdquo;: &ldquo;vu8=&rdquo;,<br>&ldquo;priority&rdquo;: &ldquo;HIGH&rdquo;,<br>&ldquo;confirmed&rdquo;: true,<br>&ldquo;correlation_ids&rdquo;: [&ldquo;my-correlation-id&rdquo;]<br>}]<br>} </details></td>
      </tr>
      <tr>
          <td style="text-align: left">Individual fields comparison</td>
          <td style="text-align: left"><code>port</code></td>
          <td style="text-align: left"><code>f_port</code></td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>confirmed</code></td>
          <td style="text-align: left"><code>confirmed</code></td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>payload_raw</code></td>
          <td style="text-align: left"><code>frm_payload</code></td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>schedule</code></td>
          <td style="text-align: left">Replace and push topics are available as an alternative</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left">Not available</td>
          <td style="text-align: left"><code>priority</code> - You can specify <code>LOWEST</code>, <code>LOW</code>, <code>BELOW_NORMAL</code>, <code>NORMAL</code>, <code>ABOVE_NORMAL</code>, <code>HIGH</code> and <code>HIGHEST</code> (<code>LOWEST</code> is a default if not specified)</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left">Not available</td>
          <td style="text-align: left"><code>correlation_ids</code> - You can add multiple custom correlation IDs, for example to reference events or identifiers of your application</td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"><code>payload_fields</code></td>
          <td style="text-align: left">Not available</td>
      </tr>
  </tbody>
</table>
<h3 id="references">References</h3>
<p><a href="https://www.thethingsnetwork.org/docs/applications/mqtt/api.html">The Things Industries V2 MQTT API Documentation</a></p>
<p><a href="https://www.thethingsindustries.com/docs/integrations/mqtt/">The Things Stack MQTT API Documentation</a></p>

        </div>
        <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/the-things-stack/migrating/migrating-from-v2/">← Migrating End Devices from V2</a>
<a class="button is-pulled-right" href="/docs/the-things-stack/migrating/migrating-from-v2/packet-broker-requirements/">Packet Broker Requirements for End Device Migration →</a>
</div>

        <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#architecture'>Architecture</a></li>
    
      
      <li><a href='#lorawan-support'>LoRaWAN support</a></li>
    
      
      <li><a href='#rx1-delay'>RX1 Delay</a></li>
    
      
      <li><a href='#mac-commands'>MAC Commands</a></li>
    
      
      <li><a href='#gateway-coverage'>Gateway Coverage</a></li>
    
      
      <li><a href='#application-data'>Application Data</a></li>
    
      
      <li><a href='#api-comparison'>API Comparison</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-third">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/the-things-stack/">The Things Stack</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
        <p><a class="" href="/docs/api/">API</a></p>
      </nav>
      <nav class="column is-one-third">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
      </nav>
      
      <nav class="column is-one-third">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.3bf0da17f5ab4cc0f916662c2d2f977f7fa7259b4483f7f9eb46e875a556cc43.js" integrity="sha256-O/DaF/WrTMD5FmYsLS&#43;Xf3&#43;nJZtEg/f560bodaVWzEM=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
