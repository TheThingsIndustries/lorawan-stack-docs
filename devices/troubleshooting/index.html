<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.96.0" />
  <title>Troubleshooting Devices | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/devices/troubleshooting/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.c994a55269632c4bc7be3364abf857e85ff170cc251dd025099769c910cbbcb4.css" integrity="sha256-yZSlUmljLEvHvjNkq/hX6F/xcMwlHdAlCZdpyRDLvLQ=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Troubleshooting Devices">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Troubleshooting Devices">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/devices/troubleshooting/">
  <meta name="twitter:title" content="Troubleshooting Devices" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
</head>


<body><nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.21.2</p>
      </a><div class="navbar-item navbar-search-brand">
        <div class="field has-addons has-addons-centered">
          <div class="control">
            <input id="search-input-brand" class="input search-bar" type="text" placeholder="Search the docs..." type="text">
          </div>
        </div>
      </div>
      
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a><div class="navbar-item navbar-search-menu">
            <div class="field has-addons has-addons-centered">
              <div class="control">
                <input id="search-input-menu" class="input search-bar" type="text" placeholder="Search the docs..." type="text">
              </div>
            </div>
          </div></div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://accounts.thethingsindustries.com/fee-calculator">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript">
    docsearch({
      apiKey: "4372282a02970d8402d43457bf95d486",
      indexName: "thethingsstack",
      inputSelector: '#search-input-brand',
      debug: false 
    });
    docsearch({
      apiKey: "4372282a02970d8402d43457bf95d486",
      indexName: "thethingsstack",
      inputSelector: '#search-input-menu',
      debug: false 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Devices</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/devices/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/adding-devices/" class="">Adding Devices</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/abp-vs-otaa/" class="">ABP vs OTAA</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/best-practices/" class="">Best Practices</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/class-b/" class="">Class B</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/class-c/" class="">Class C</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/multicast/" class="">Multicast</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/downlink-queue-ops/" class="">Downlink Queue Operations</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/confirmed-downlinks-behavior/" class="">Confirmed Downlinks Behavior</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/mac-settings/" class="">MAC Settings</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/atecc608a/" class="">ATECC608A/B Secure Elements</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/device-claiming/" class="">Device Claiming</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/end-device-templates/" class="">End Device Templates</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/generate-qr-code/" class="">Generating a QR Code</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/the-things-uno/" class="">The Things Uno</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/troubleshooting/" class="is-active">Troubleshooting Devices</a>
    



    
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">Troubleshooting Devices
          
        </h1>
        
        <div class="content">
          <p>This section provides help for common issues and frequently asked questions you may have when adding devices.</p>
<h2 id="i-receive-an-error-when-registering-an-end-device">I receive an error when registering an end device.</h2>
<p>Here are some common errors and solutions:</p>
<ul>
<li>
<p><strong>ID already taken</strong>: Another end device in the application is using this ID. Choose a different Device ID. See <a href="https://www.thethingsindustries.com/docs/reference/id-eui-constraints/">ID and EUI constraints</a> for more information.</p>
</li>
<li>
<p><strong>An end device with JoinEUI <code>&lt;join-eui&gt;</code> and DevEUI <code>&lt;dev-eui&gt;</code> is already registered as <code>&lt;device-id&gt;</code> in application <code>&lt;application-id&gt;</code></strong>: Within The Things Stack deployment, only a single end device can be registered with a certain combination of DevEUI and JoinEUI/AppEUI. If you previously registered an end device with this combination of DevEUI and JoinEUI, you can delete the existing device and repeat the registration. You can also register the device using another JoinEUI, but keep in mind that you will need to configure that JoinEUI in the device as well.</p>
</li>
<li>
<p><strong>An end device with JoinEUI <code>&lt;join-eui&gt;</code> and DevEUI <code>&lt;dev-eui&gt;</code> is already registered in another tenant</strong>: Within The Things Stack deployment, only a single end device can be registered with a certain combination of DevEUI and JoinEUI/AppEUI, across all tenants. If someone already registered an end device with this combination of DevEUI and JoinEUI, you can contact the manufacturer to check if your EUIs are correct and/or provide you new EUIs. You can also register the device using another JoinEUI, but keep in mind that you will need to configure that JoinEUI in the device as well.</p>
</li>
<li>
<p><strong>Duplicate identifiers</strong>: This error occurs when an end device is deleted from the Identity Server, but the device entry persists in the Join Server, Network Server and Application Server databases. In this case, the device will not appear in The Things Stack Console, so you need to check if it is present in the Join Server/Network Server/Application Server components using the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X <span class="s1">&#39;GET&#39;</span> <span class="s1">&#39;https://thethings.example.com/api/v3/&lt;js/ns/as&gt;/applications/&lt;application_id&gt;/devices/&lt;end-device_id&gt;&#39;</span> -H <span class="s1">&#39;accept: application/json&#39;</span> -H <span class="s1">&#39;Authorization: Bearer &lt;api-key&gt;&#39;</span>
</span></span></code></pre></div><p>If the device entry is present in the above mentioned components, you can delete it with:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl <span class="s1">&#39;https://thethings.example.com/api/v3/&lt;js/ns/as&gt;/applications/&lt;application_id&gt;/devices/&lt;end-device_id&gt;&#39;</span> -X DELETE -H <span class="s1">&#39;Accept: application/json&#39;</span> -H <span class="s1">&#39;Authorization: Bearer &lt;api-key&gt;&#39;</span>
</span></span></code></pre></div></li>
</ul>
<h2 id="i-cannot-access-my-device-in-the-things-stack-console">I cannot access my device in The Things Stack Console.</h2>
<p>If you cannot access your device in the Console, i.e. you&rsquo;re seeing the <code>An unknown error occured. Please try again later...</code> error, your device is probably not properly provisioned in all The Things Stack components (Identity Server, Join Server, Network Server and Application Server). For example, this might happen if you tried to create your device <a href="https://www.thethingsindustries.com/docs/getting-started/api/#multi-step-actions">using the API</a>, but you haven&rsquo;t created it properly in all four server components.</p>
<p>This error can be resolved if you delete your device from all four above mentioned server components, and recreate it from scratch.</p>
<p>To check if your device is present in the Identity Server component:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X <span class="s1">&#39;GET&#39;</span> <span class="s1">&#39;https://thethings.example.com/api/v3/applications/&lt;application_id&gt;/devices/&lt;device_id&gt;&#39;</span> -H <span class="s1">&#39;Accept: application/json&#39;</span> -H <span class="s1">&#39;Authorization: Bearer &lt;api-key&gt;&#39;</span>
</span></span></code></pre></div><p>To check if your device is present in Join Server, Network Server and/or Application Server:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X <span class="s1">&#39;GET&#39;</span> <span class="s1">&#39;https://thethings.example.com/api/v3/&lt;js/ns/as&gt;/applications/&lt;application_id&gt;/devices/&lt;device_id&gt;&#39;</span> -H <span class="s1">&#39;Accept: application/json&#39;</span> -H <span class="s1">&#39;Authorization: Bearer &lt;api-key&gt;&#39;</span>
</span></span></code></pre></div><p>To delete your device from Identity Server:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X DELETE <span class="s1">&#39;https://thethings.example.com/api/v3/applications/&lt;application_id&gt;/devices/&lt;device_id&gt;&#39;</span> -H <span class="s1">&#39;Accept: application/json&#39;</span> -H <span class="s1">&#39;Authorization: Bearer &lt;api-key&gt;&#39;</span>
</span></span></code></pre></div><p>To delete your device from Join Server, Network Server and/or Application Server:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X DELETE <span class="s1">&#39;https://thethings.example.com/api/v3/&lt;js/ns/as&gt;/applications/&lt;application_id&gt;/devices/&lt;device_id&gt;&#39;</span> -H <span class="s1">&#39;Accept: application/json&#39;</span> -H <span class="s1">&#39;Authorization: Bearer &lt;api-key&gt;&#39;</span>
</span></span></code></pre></div><p>Next, recreate your device as documented in the <a href="https://www.thethingsindustries.com/docs/getting-started/api/#multi-step-actions">Using the API</a> section.</p>
<h2 id="how-do-i-see-device-events">How do I see device events?</h2>
<p>Device event logs can be found in the console in the device&rsquo;s general information page. See <a href="https://www.thethingsindustries.com/docs/getting-started/events/">Working with Events</a> for other ways of subscribing to events.</p>
<h2 id="i-see-no-join-requests-from-my-device-in-the-things-stack">I see no Join Requests from my device in The Things Stack.</h2>
<p>Check your network coverage, and if your device is activated and transmitting Join Requests.</p>
<p>It is possible that your device is sending Join Requests on non-default frequencies, i.e. on frequencies that The Things Stack is not listening on by default. If this is the case, Join Requests will be dropped on a gateway level. As per LoRaWAN specification, devices should be sending Join Requests on default frequencies of the defined frequency band. To fix this issue, reach out to your device manufacturer and find out which are the default frequencies for your device. Also, check out <a href="#i-can-see-some-received-uplinks-in-gateway-live-data-events-but-i-do-not-see-them-in-device-events">using inappropriate frequencies</a> below.</p>
<h2 id="my-device-will-not-join-what-do-i-do">My device will not join. What do I do?</h2>
<ul>
<li>
<p>Double check your DevEUI, JoinEUI or AppEUI, LoRaWAN and Regional Parameters Version, root keys (AppKey, and with LoRaWAN 1.1 or higher, NwkKey)</p>
</li>
<li>
<p>Check gateway and device events for traffic from your device. Below are a few common issues</p>
<ul>
<li><strong>MIC mismatch</strong> error in the device events: Possible mismatch of AppKey in device firmware to the AppKey registered in The Things Stack Console. Update the AppKey in the Console accordingly. Another cause can be using both AppKey and NwkKey for devices configured as LoRaWAN v1.0.x, where the Network Server will consider the device as capable for LoRaWAN v1.1. The configured NwkKey will be used for calculating the MIC and session key derivation in The Things Stack instead of AppKey, while the device will be using AppKey, causing the aforementioned error. You can use the command below to unset the NwkKey for the device:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices <span class="nb">set</span> --application-id &lt;app-id&gt; --device-id &lt;dev-id&gt; --unset root-keys.nwk-key
</span></span></code></pre></div><ul>
<li><strong>Uplink channel not found</strong> error in the gateway events: Indicates there is a mismatch of the frequency plans. Double check frequency plan settings in your end device and gateways (they must be the same LoRaWAN band)</li>
<li><strong>DevNonce has already been used</strong> error in the device events: Indicates a duplicate use of Devnonce. Generally happens when the device has sent too many unsuccessful Join Requests</li>
<li><strong>DevNonce is too small</strong> error in the device events: If the device is using LoRaWAN MAC version 1.1 or 1.0.4, this error occurs when DevNonce is not being incremented, so the Join Server ignores Join Requests with the same or lower DevNonce value comparing to the previous one. Contact your device&rsquo;s manufacturer to find out the correct LoRaWAN MAC and PHY versions, and configure the device in The Things Stack accordingly</li>
<li><strong>Uplink channel not found</strong> error in the device events: The device is transmitting Join Requests in the non-default channels of the band which is not in line with the LoRaWAN Specification. Contact the end-device manufacturer</li>
</ul>
</li>
<li>
<p>Double check your network connection. If there is a slow connection from the server to the gateway, the join accept message may be sent too late (this can happen when a gateway uses 3G as a backhaul). If using the CLI, run <code>ttn-lw-cli gateways connection-stats &lt;gateway-id&gt;</code> to see the round trip time (RTT) for your gateway</p>
</li>
<li>
<p>Check for duplicate use of JoinNonce (or AppNonce)</p>
</li>
<li>
<p>Adjust ADR and link check settings to conditions which the device is located in</p>
</li>
</ul>
<h2 id="my-device-is-stuck-in-a-continuous-join-loop-what-can-i-do">My device is stuck in a continuous join loop. What can I do?</h2>
<ul>
<li>Check for the errors and solutions listed above</li>
<li>If the Network Server is processing Join Requests and scheduling Join Accepts, check the gateway events and see whether the Join Accept downlink messages are being scheduled by the gateway</li>
<li>If you see any deviation in scheduling Join Accept downlinks from the gateway, follow the <a href="https://www.thethingsindustries.com/docs/gateways/troubleshooting/">Troubleshooting Gateways</a></li>
<li>Did you schedule a command to reset your device as a confirmed downlink? If yes, the downlink confirmation will never arrive. You should always schedule the reset command as an unconfirmed downlink. However, if your device is already affected, use the <strong>Reset session and MAC state</strong> option under <strong>Network layer</strong> in your device&rsquo;s settings, then manually re-join the device.</li>
</ul>
<h2 id="i-see-the-the-lorawan-version-mac-version-does-not-support-the-frequency-plan-id-frequency-plan-please-choose-a-different-mac-version-or-frequency-plan-error-while-registering-a-device-in-the-things-stack">I see the &ldquo;The LoRaWAN version <code>&lt;mac-version&gt;</code> does not support the <code>&lt;frequency-plan-id&gt;</code> frequency plan. Please choose a different MAC version or frequency plan&rdquo; error while registering a device in The Things Stack.</h2>
<p>The Things Stack returns this error when the frequency plan that you are using is not supported by the LoRaWAN MAC and PHY versions you specified. We suggest you to check your device&rsquo;s datasheet or user manual, or to contact your device manufacturer to find out correct MAC and PHY versions. You can also find your Regional Parameters document on the <a href="https://lora-alliance.org/search-site/">LoRa Alliance site</a> and find out which frequency plans are supported by it.</p>
<h2 id="no-downlinks-are-reaching-my-device-what-do-i-do">No downlinks are reaching my device. What do I do?</h2>
<ul>
<li>Check gateway and application events for traffic from your device</li>
<li>Check duty cycle restrictions</li>
<li>Device clock drift often occurs when SF12 is used</li>
<li>Check your antenna connections</li>
</ul>
<h2 id="i-do-not-see-any-uplinks-from-my-device-in-the-gateway-live-data">I do not see any uplinks from my device in the Gateway Live data.</h2>
<p>Here are some common causes and solutions:</p>
<ul>
<li>The device is not transmitting uplink messages. Check if your device is transmitting uplinks by observing its debug logs.</li>
<li>The device has no network coverage. Check if your device has a network coverage from any of the gateways registered in your tenant.</li>
<li>The device is transmitting data in a different FSB (frequency sub-band) than the one that the gateway is listening on. Check if the frequency plan and FSB that the gateway listens on are correctly configured on The Things Stack and on the device.</li>
<li>The gateway is not receiving uplinks due to hardware issues. Check if your gateway is receiving uplinks by observing its debug logs.</li>
<li>The gateway is not forwarding received uplinks to the Network Server. Check your gateway&rsquo;s debug logs for any errors or warnings. Refer to the <a href="https://www.thethingsindustries.com/docs/gateways/troubleshooting/">Troubleshooting Gateways guide</a>.</li>
</ul>
<h2 id="the-things-stack-is-no-longer-receiving-uplinks-from-my-device-what-do-i-do">The Things Stack is no longer receiving uplinks from my device. What do I do?</h2>
<ul>
<li>Check <a href="#how-do-i-see-gateway-events">gateway events</a> and <a href="#how-do-i-see-device-events">device events</a> for traffic from your device</li>
<li>Check for FCnt mismatch on ABP devices</li>
</ul>
<h2 id="how-to-infer-a-downlink-flow-in-the-things-stack">How to infer a downlink flow in The Things Stack?</h2>
<p>When scheduling messages for downlink communication, different events are generated by different The Things Stack components, and they can be observed on a gateway or on a device level.</p>
<p>Observe the following events in the Live data tab of the device overview in The Things Stack Console:</p>
<ul>
<li>When the downlink is scheduled, the Application Server generates the <code>as.down.data.receive</code> and <code>as.down.data.forward</code> events.</li>
<li>Next, the Network Server schedules the downlink to the Gateway Server. The <code>ns.down.data.schedule.attempt</code> and <code>ns.down.data.schedule.success</code> events are generated upon successful scheduling of the downlink by the Network Server. If downlink scheduling fails, the <code>ns.down.data.schedule.fail</code> event is generated instead.</li>
</ul>
<p>Observe the following events in the Live data tab of the gateway overview in The Things Stack Console:</p>
<ul>
<li>If the downlink is successfully scheduled from the Gateway Server to the gateway, the Gateway Server generates the <code>gs.down.send</code> and <code>gs.down.tx.success</code> events. This indicates that the downlink is successfully sent to the gateway and the gateway scheduled the downlink to be sent to the device. If downlink scheduling fails, the <code>gs.down.tx.fail</code> event is generated instead.</li>
</ul>
<blockquote>
<p>For more information on different events in TTS, read <a href="https://www.thethingsindustries.com/docs/reference/api/events/">Events API</a>.</p>
</blockquote>
<p>If you did not encounter any deviations in this flow, that should be an indication of a successful downlink scheduling. However, if the downlink is not reaching your device, check the gateway packet forwarder logs and search for any errors that might help you identify the cause of the downlink failure.</p>
<h2 id="when-i-schedule-a-downlink-i-see-the-nsdowndataschedulefail-event-in-the-live-data-tab-and-the-downlink-message-fails-to-be-transmitted">When I schedule a downlink, I see the <code>ns.down.data.schedule.fail</code> event in the Live data tab and the downlink message fails to be transmitted.</h2>
<p>The <code>ns.down.data.schedule.fail</code> event, that can be noticed in the Live data tab of the device overview in The Things Stack Console, indicates the downlink scheduling failure at the Network Server.</p>
<p>The <code>ns.down.data.schedule.fail</code> event usually occurs with the following errors:</p>
<ul>
<li><code>no_absolute_gateway_time</code>: Downlinks are being scheduled with the absolute time, and the absolute time of the Gateway Server is not in sync with the absolute time of the gateway. To sync them, a gateway has to either report its GPS time, or transmit five downlink frames in order for Gateway Server to infer its absolute time by observing RTTs.</li>
<li><code>scheduling_conflict</code>: Devices are synchronized, i.e. a number of devices are sending joins or uplinks at the same time. To avoid device synchronization, devices need to be configured to initiate joins or send uplinks at random times or with random delays. You can also try with improving the network coverage in your area. See <a href="https://www.thethingsindustries.com/docs/devices/best-practices/#synchronization-backoff-and-jitter">Best Practices</a> for more info about device synchronization.</li>
</ul>
<p>We also advise to double check your network connection. If the connection between the gateway and the Network Server is slow, downlink messages could be sent too late. For example, this can happen in case of:</p>
<ul>
<li>Cellular or satellite gateway backhauls</li>
<li>Cluster latencies</li>
<li>Gateway level issues</li>
</ul>
<h2 id="scheduling-a-downlink-from-the-things-stack-console-is-disabled-with-a-warning-simulation-is-disabled-for-devices-that-skip-payload-crypto">Scheduling a downlink from The Things Stack Console is disabled with a warning &ldquo;Simulation is disabled for devices that skip payload crypto&rdquo;.</h2>
<p>When using the <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/aws-iot/">AWS IoT integration</a> with the <strong>End to End Encryption</strong> option enabled, scheduling downlink messages from The Things Stack Console is restricted by default.</p>
<p>When this option is enabled, encryption and decryption at the Application Server is disabled, i.e. the <code>skip_payload_crypto</code> field for the end device is enabled on the application level. The downlinks are expected to be scheduled from the AWS IoT, and not from the The Things Stack.</p>
<p>Read more about skipping payload crypto option on an <a href="https://www.thethingsindustries.com/docs/integrations/adding-applications/#payload-encryption-and-decryption">application level</a> or on a <a href="https://www.thethingsindustries.com/docs/devices/adding-devices/#application-layer-settings">device level</a>.</p>
<h2 id="the-things-stack-intermittently-receives-uplinks-from-my-device-but-with-the-fcnt-gap">The Things Stack intermittently receives uplinks from my device, but with the FCnt gap.</h2>
<p>Your device probably does not have a good network coverage. Some common reasons:</p>
<ul>
<li>The device is using SF7, while it should be using a higher SF for better coverage and reach.</li>
<li>There might be a conflict in receiving uplinks due to <a href="https://www.thethingsindustries.com/docs/devices/best-practices/#synchronization-backoff-and-jitter">synchronization of devices</a>.</li>
</ul>
<p>Check your network coverage, and make sure your devices are within your gateway&rsquo;s reach and are using a suitable SF.</p>
<h2 id="i-can-see-some-received-uplinks-in-gateway-live-data-events-but-i-do-not-see-them-in-device-events">I can see some received uplinks in gateway Live data events, but I do not see them in device events.</h2>
<p>Possible causes and solutions:</p>
<ul>
<li>The Network Server dropping uplink messages received from the gateway
<ul>
<li>The uplinks could be coming from other devices in the gateways range, that are not registered in The Things Stack. In this case, you can just ignore them.</li>
<li>If you are facing this while trying to activate a device, please double-check that the DevEUI and JoinEUI/AppEUI on The Things Stack and on your device match.</li>
</ul>
</li>
<li>FCnt mismatch
<ul>
<li>For ABP devices, the FCnt mismatch might occur if the device resets while the <strong>Reset Frame Counters</strong> option for the device is disabled. Try enabling the <strong>Reset Frame Counters</strong> option in the device&rsquo;s overview in The Things Stack Console, or by setting <a href="https://www.thethingsindustries.com/docs/devices/mac-settings/#available-mac-settings">MAC commands</a> using the CLI.</li>
<li>For OTAA devices, the FCnt mismatch might occur due to missing packets. The maximum FCnt gap between two consecutive uplinks is <code>16384</code> according to the LoRaWAN specification. Try re-joining your OTAA device.</li>
</ul>
</li>
<li>Using inappropriate frequencies
<ul>
<li>This case applies only to ABP devices and EU/IN/AS frequency bands. Since the Network Server is initially accepting uplinks from devices only in default channels, uplinks from the device that is using non-default channels are dropped. In this case, <strong>Factory Preset Frequencies</strong> have to be set either in device&rsquo;s overview in The Things Stack Console, or by setting <a href="https://www.thethingsindustries.com/docs/devices/mac-settings/#available-mac-settings">MAC commands</a> using the CLI. If these settings are applied to an existing device, you might need to reset the device as well.</li>
</ul>
</li>
<li>Session keys mismatch
<ul>
<li>For ABP devices, if there is a mismatch between session keys (AppSKey and NwkSKey) that are hardcoded in the device and those used when registering the device on The Things Stack, uplinks will not be seen in the device&rsquo;s Live data tab. Please cross-check that your device&rsquo;s session keys match the ones used upon registration on The Things Stack.</li>
</ul>
</li>
</ul>
<p>This problem can also occur after <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/migrating-from-v2/migrate-using-migration-tool/migrate-active-session/">migrating an active device session</a> from V2 to The Things Stack, for devices that transmit uplinks on frequencies that are not part of the standard <a href="https://www.thethingsindustries.com/docs/reference/frequency-plans/">frequency plans</a> used by The Things Stack. The issue arises from the fact that factory preset frequencies were not stored in V2, so they are not present in the <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/device-json/">JSON file</a> used for importing devices in The Things Stack. There are two possible solutions:</p>
<ul>
<li>If the end device can be reset, i.e. if it can perform a re-join to The Things Stack network or at least reset frame counters (for ABP devices)
<ul>
<li>Go to <strong>General settings</strong> in the device overview in The Things Stack Console, navigate to <strong>Network layer → Advanced MAC settings</strong> and set the <strong>Factory preset frequencies</strong>, then click the <strong>Reset session and MAC state</strong> button. By resetting the device, a new session will be established with The Things Stack Network Server and the uplinks on the defined frequencies will be accepted.</li>
</ul>
</li>
<li>If the end device cannot be reset
<ul>
<li>Changes related to factory preset frequencies take effect only after a device reset, but applying the fix explained above will break the existing device session. If you really want to keep the active session or simply cannot reset the device physically, you can try adding the frequency channels manually in the <code>mac_state.current.channels</code> and <code>mac_state.desired_channels</code> parameters of the <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/device-json/">JSON file</a> before you import it to The Things Stack.</li>
</ul>
</li>
</ul>
<h2 id="i-notice-a-delay-in-scheduling-class-c-downlinks-what-can-i-do-to-fix-it">I notice a delay in scheduling Class C downlinks. What can I do to fix it?</h2>
<p>Here are some common causes of a delay in scheduling downlinks for Class C devices:</p>
<ul>
<li><strong>The <code>Supports class C</code> option not enabled in device settings</strong>: If this option is not enabled, The Things Stack treats the device as a class A device, so it schedules a downlink only after receiving an uplink. Find and enable this option under <strong>General settings → Network layer → LoRaWAN class capabilities</strong>, then trigger your device for a re-join in order for changes to have an effect.</li>
<li><strong>Device not responding immediately on a confirmed downlink or a MAC command</strong>: Your device might be configured to respond to confirmed downlinks and/or MAC commands with the next uplink, instead of immediately. All downlinks scheduled after the confirmed downlink or a MAC command will be in a pending state until the device responds with an ACK or a MAC answer. You can check pending requests with <code>ttn-lw-cli end-devices get --application-id &lt;app-id&gt; --device-id &lt;dev-id&gt; --mac-state &gt; &lt;dev-id&gt;.mac-state.txt</code>. If the device does not respond in the <code>class-c-timeout</code> interval (5 minutes by default), all pending downlinks will be discarded. In this case, you need to configure your device to immediately answer confirmed downlinks and MAC commands.</li>
<li><strong>Downlink failure</strong>: If you have already addressed the above mentioned cases, but you are still experiencing a delay in scheduling downlinks, the downlinks might not be reaching the device. Please check your end device&rsquo;s debug logs, and your gateway&rsquo;s packet forwarder logs for errors. Find the common gateway-related issues and solutions in the <a href="https://www.thethingsindustries.com/docs/gateways/troubleshooting/">Troubleshooting Gateways</a> section.</li>
</ul>
<h2 id="i-see-downlinks-being-sent-after-every-uplink-message-but-i-did-not-schedule-any-what-are-those-downlinks">I see downlinks being sent after every uplink message, but I did not schedule any. What are those downlinks?</h2>
<p>One of the possible causes might be that your end device is not answering MAC commands sent by the Network Server. The Network Server will continuously re-send those MAC commands, until the end device answers them. The recommended practice is to contact device manufacturer to resolve the issue.</p>
<h2 id="im-facing-errors-when-trying-to-change-my-devices-frequency-plan">I&rsquo;m facing errors when trying to change my device&rsquo;s frequency plan.</h2>
<p>The Network Server performs a lot of checks to ensure that the end device MAC state and MAC settings are valid with respect to the frequency plan, so that is probably the source of errors you are facing. The most common error is <code>Invalid value of field mac_settings.rx2_data_rate_index.value</code>.</p>
<p>Updating device&rsquo;s frequency plan in The Things Stack is available in some cases, e.g. for devices that haven&rsquo;t been activated yet, or when changing spreading factor only, for example from Europe 863-870 MHz (SF9 for RX2) plan to Europe 863-870 MHz (SF12 for RX2).</p>
<p>Generally speaking, changing frequency plans in The Things Stack is not recommended and in large number of cases not available either, so you should always recreate your end device using the desired frequency plan.</p>
<h2 id="i-see-a-no-decoder-defined-for-codec-codec_id-error-after-very-downlink-message">I see a &ldquo;no decoder defined for codec {codec_id}&rdquo; error after very downlink message.</h2>
<p>This error indicates that your end device was added from the <a href="https://github.com/TheThingsNetwork/lorawan-devices">Device Repository</a>, but in the device&rsquo;s codec file there are no <code>downlinkEncoder</code> and <code>downlinkDecoder</code> functions defined. To fix this, you can reach out to the device manufacturer to update your device&rsquo;s codec file in the Device Repository. Alternatively, you can define the <a href="https://www.thethingsindustries.com/docs/integrations/payload-formatters/">payload formatter</a> on your own.</p>
        </div>
        
          <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/devices/the-things-uno/">← The Things Uno</a>
</div>

          <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#i-receive-an-error-when-registering-an-end-device'>I receive an error when registering an end device.</a></li>
    
      
      <li><a href='#i-cannot-access-my-device-in-the-things-stack-console'>I cannot access my device in The Things Stack Console.</a></li>
    
      
      <li><a href='#how-do-i-see-device-events'>How do I see device events?</a></li>
    
      
      <li><a href='#i-see-no-join-requests-from-my-device-in-the-things-stack'>I see no Join Requests from my device in The Things Stack.</a></li>
    
      
      <li><a href='#my-device-will-not-join-what-do-i-do'>My device will not join. What do I do?</a></li>
    
      
      <li><a href='#my-device-is-stuck-in-a-continuous-join-loop-what-can-i-do'>My device is stuck in a continuous join loop. What can I do?</a></li>
    
      
      <li><a href='#i-see-the-the-lorawan-version-mac-version-does-not-support-the-frequency-plan-id-frequency-plan-please-choose-a-different-mac-version-or-frequency-plan-error-while-registering-a-device-in-the-things-stack'>I see the “The LoRaWAN version &lt;mac-version&gt; does not support the &lt;frequency-plan-id&gt; frequency plan. Please choose a different MAC version or frequency plan” error while registering a device in The Things Stack.</a></li>
    
      
      <li><a href='#no-downlinks-are-reaching-my-device-what-do-i-do'>No downlinks are reaching my device. What do I do?</a></li>
    
      
      <li><a href='#i-do-not-see-any-uplinks-from-my-device-in-the-gateway-live-data'>I do not see any uplinks from my device in the Gateway Live data.</a></li>
    
      
      <li><a href='#the-things-stack-is-no-longer-receiving-uplinks-from-my-device-what-do-i-do'>The Things Stack is no longer receiving uplinks from my device. What do I do?</a></li>
    
      
      <li><a href='#how-to-infer-a-downlink-flow-in-the-things-stack'>How to infer a downlink flow in The Things Stack?</a></li>
    
      
      <li><a href='#when-i-schedule-a-downlink-i-see-the-nsdowndataschedulefail-event-in-the-live-data-tab-and-the-downlink-message-fails-to-be-transmitted'>When I schedule a downlink, I see the ns.down.data.schedule.fail event in the Live data tab and the downlink message fails to be transmitted.</a></li>
    
      
      <li><a href='#scheduling-a-downlink-from-the-things-stack-console-is-disabled-with-a-warning-simulation-is-disabled-for-devices-that-skip-payload-crypto'>Scheduling a downlink from The Things Stack Console is disabled with a warning “Simulation is disabled for devices that skip payload crypto”.</a></li>
    
      
      <li><a href='#the-things-stack-intermittently-receives-uplinks-from-my-device-but-with-the-fcnt-gap'>The Things Stack intermittently receives uplinks from my device, but with the FCnt gap.</a></li>
    
      
      <li><a href='#i-can-see-some-received-uplinks-in-gateway-live-data-events-but-i-do-not-see-them-in-device-events'>I can see some received uplinks in gateway Live data events, but I do not see them in device events.</a></li>
    
      
      <li><a href='#i-notice-a-delay-in-scheduling-class-c-downlinks-what-can-i-do-to-fix-it'>I notice a delay in scheduling Class C downlinks. What can I do to fix it?</a></li>
    
      
      <li><a href='#i-see-downlinks-being-sent-after-every-uplink-message-but-i-did-not-schedule-any-what-are-those-downlinks'>I see downlinks being sent after every uplink message, but I did not schedule any. What are those downlinks?</a></li>
    
      
      <li><a href='#im-facing-errors-when-trying-to-change-my-devices-frequency-plan'>I’m facing errors when trying to change my device’s frequency plan.</a></li>
    
      
      <li><a href='#i-see-a-no-decoder-defined-for-codec-codec_id-error-after-very-downlink-message'>I see a “no decoder defined for codec {codec_id}” error after very downlink message.</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/ttn-network/v3/90">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Nejra Selimović on 20 Jul 2022.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/49b4a2033f83d1935a1ce216afe3cc9269d2f571">
      doc: Fix device FP troubleshooting and a hyperlink (#922)
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/devices/troubleshooting/_index.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.a32708c8796e7e8713fa926212adddbbf5c15cdd97676d898ecfc17bc6d9ed4f.js" integrity="sha256-oycIyHlufocT&#43;pJiEq3du/XBXN2XZ22Jjs/Be8bZ7U8=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
