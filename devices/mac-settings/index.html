<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.96.0" />
  <title>MAC Settings | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/devices/mac-settings/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.8058c473c43c01571dbb7b1b4de287fb8e077613d282e9b7b9db17271211dd60.css" integrity="sha256-gFjEc8Q8AVcdu3sbTeKH&#43;44HdhPSgum3udsXJxIR3WA=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="MAC Settings">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="MAC Settings">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/devices/mac-settings/">
  <meta name="twitter:title" content="MAC Settings" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NGRDCNM');</script>


</head>


<body>


<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NGRDCNM"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.25.2</p>
      </a><div class="navbar-item navbar-search-menu" id="search-input-menu">
          </div>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/the-things-stack/">The Things Stack</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a>

      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://accounts.thethingsindustries.com/fee-calculator">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
  <script type="text/javascript">
    docsearch({
      appId: "608OILUBK2",
      apiKey: "39082cdce449b93b2aa806b44f6af4d2",
      indexName: "thethingsstack",
      container: '#search-input-menu',
      debug: false, 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Devices</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/devices/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/adding-devices/" class="">Adding Devices</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/abp-vs-otaa/" class="">ABP vs OTAA</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/best-practices/" class="">Best Practices</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/class-b/" class="">Class B</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/class-c/" class="">Class C</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/multicast/" class="">Multicast</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/downlink-queue-ops/" class="">Downlink Queue Operations</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/confirmed-downlinks-behavior/" class="">Confirmed Downlinks Behavior</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/mac-settings/" class="is-active">MAC Settings</a>
    



    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/atecc608a/" class="">ATECC608 Secure Elements</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/device-claiming/" class="">Device Claiming</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/generate-qr-code/" class="">Generating a QR Code</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/generic-node-se/" class="">Generic Node Sensor Edition</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/the-things-node/" class="">The Things Node</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/the-things-uno/" class="">The Things Uno</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/troubleshooting/" class="">Troubleshooting Devices</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">MAC Settings
          
        </h1>
        
        <div class="content">
          <p>This section provides guidelines for configuring MAC settings for end devices from the CLI.</p>
<div class="notification is-primary is-light has-text-dark">
  <h3 class="title has-text-dark mb-1">Command-line interface only</h3>
  <p>The instructions below use the command-line interface (CLI).</p>
  
  
  <div class="buttons">
    <a class="button is-dark is-outlined" href="https://www.thethingsindustries.com/docs/the-things-stack/interact/cli/installing-cli/">Learn how to install the CLI</a>
  </div>
</div>

<h2 id="mac-settings-and-mac-state">MAC Settings and MAC State</h2>
<p>MAC settings on The Things Stack are configurable per end device. To configure persistent MAC settings, make changes to <code>mac-settings.desired_&lt;parameter&gt;</code>. Updates to <code>mac-settings.desired_&lt;parameter&gt;</code> take effect on device creation, after OTAA join or ABP FCnt reset, ResetInd, or after MAC state reset.</p>
<p><code>mac-settings.&lt;parameter&gt;</code> represents what the Network Server believes is configured on the end device, and should not be changed, unless the device does not conform to the LoRaWAN® specification. It may however be necessary to set <code>mac-settings.RX1_delay</code> for ABP devices where this is not configured as part of activation.</p>
<p><code>mac-state</code> can be used to test MAC settings in the current session. To update settings for testing in the current session, make changes to the <code>mac-state.desired_parameters.&lt;parameter&gt;</code>. Updates to the <code>mac-state.desired_parameters.&lt;parameter&gt;</code> are applied on the next uplink, and lost on reset.</p>
<p>The expected procedure for testing and updating settings is:</p>
<ol>
<li>Modify <code>mac-state.desired_parameters.&lt;parameter&gt;</code> to see changes in the current session</li>
<li>Test that everything works as expected</li>
<li>Modify <code>mac-settings.desired_&lt;parameter&gt;</code> to make the change permanent</li>
</ol>
<p>See how this applies to the Rx1 delay parameter in the example below. If no settings are provided on device creation or unset, defaults are first taken from the device Frequency Plan if available, and finally from <a href="https://www.thethingsindustries.com/docs/reference/configuration/network-server/">Network Server Configuration</a>.</p>
<h3 id="example-configure-rx1-delay">Example: Configure Rx1 Delay</h3>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  The Things Stack configures the <code>Rx1Delay</code> to 5 seconds by default to accomodate for high latency backhauls and/or peering with Packet Broker, so this is the recommended configuration. For demonstration purposes, in this example we use 6 seconds.
</div>

<p>To see Rx1 delay change in the current session, modify the <code>mac-state.desired-parameters.rx1-delay</code> parameter:</p>
<pre tabindex="0"><code>ttn-lw-cli end-devices update --application-id &lt;application-id&gt; --device-id &lt;device-id&gt; --mac-state.desired-parameters.rx1-delay RX_DELAY_6
</code></pre><p>The Network Server will schedule an <code>RxTimingSetupReq</code> MAC command to communicate a new <code>Rx1Delay</code> of 6 seconds to the device. The end device will answer with an <code>RxTimingSetupAns</code> MAC command in the next uplink. The Network Server will then start using the <code>Rx1Delay</code> of 6 seconds for scheduling downlinks. For this change to take effect, the end device does not need to perform a re-join.</p>
<p>To make the Rx1 delay change persistent upon end device re-join, modify the <code>mac-settings.desired-rx1-delay</code> parameter:</p>
<pre tabindex="0"><code>ttn-lw-cli end-devices update --application-id &lt;application-id&gt; --device-id &lt;device-id&gt; --mac-settings.desired-rx1-delay RX_DELAY_6
</code></pre><p>The Rx1 delay change will take effect only after the end device performs a re-join, i.e. in the new session. The <code>Rx1Delay</code> of 6 seconds will be communicated to the device during join procedure via Join-accept downlink message.</p>
<p>If the end device does not conform to the LoRaWAN Specification and has a custom Rx1 delay configured in it (6 seconds in this example), modify the <code>mac-settings.rx1-delay</code> parameter:</p>
<pre tabindex="0"><code>ttn-lw-cli end-devices update --application-id &lt;application-id&gt; --device-id &lt;device-id&gt; --mac-settings.rx1-delay RX_DELAY_6
</code></pre><p>The Network Server will start using the <code>Rx1Delay</code> of 6 seconds for downlink communication with the end device.</p>
<h2 id="available-mac-settings">Available MAC Settings</h2>
<p>Run the following command to get a list of all available MAC settings and available parameter values:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices <span class="nb">set</span> --help
</span></span></code></pre></div><p>You can also refer to the <a href="https://www.thethingsindustries.com/docs/reference/api/end_device/#message:MACSettings">End Device API Reference page</a> for documentation on the available MAC settings and MAC state parameters.</p>
<h2 id="class-specific-settings">Class Specific Settings</h2>
<p>Settings that are useful based on device class are:</p>
<p>All devices:</p>
<ul>
<li><code>mac-settings.factory-preset-frequencies</code></li>
</ul>
<p>Class A:</p>
<ul>
<li><code>mac-settings.desired-rx1-delay</code></li>
<li><code>mac-settings.desired-rx1-data-rate-offset</code></li>
<li><code>mac-settings.desired-rx2-data-rate-index</code></li>
<li><code>mac-settings.desired-rx2-frequency</code></li>
<li><code>mac-settings.supports-32-bit-f-cnt</code></li>
<li><code>mac-settings.use-adr</code></li>
</ul>
<p>Class A ABP:</p>
<ul>
<li><code>mac-settings.resets-f-cnt</code></li>
</ul>
<p>Class B:</p>
<ul>
<li><code>mac-settings.class-b-timeout</code></li>
<li><code>mac-settings.ping-slot-periodicity</code></li>
<li><code>mac-settings.desired-ping-slot-data-rate-index</code></li>
<li><code>mac-settings.desired-ping-slot-frequency</code></li>
</ul>
<p>Class C:</p>
<ul>
<li><code>mac-settings.class-c-timeout</code></li>
</ul>
<p>Some additional examples are included below. All settings are available at the <a href="https://www.thethingsindustries.com/docs/reference/api/end_device/#message:MACSettings">End Device API Reference page</a> and can be viewed using the <code>ttn-lw-cli end-devices set --help</code> command.</p>
<h2 id="examples">Examples</h2>
<h3 id="configure-factory-preset-frequencies-for-abp-devices">Configure Factory Preset Frequencies for ABP Devices</h3>
<p>To tell The Things Stack which frequencies are configured in an ABP device, set the <code>mac-settings.factory-preset-frequencies</code> parameter. For example, to configure a device using the default EU868 frequencies, use the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli devices update &lt;app-id&gt; &lt;device-id&gt; --mac-settings.factory-preset-frequencies 868100000,868300000,868500000,867100000,867300000,867500000,867700000,867900000
</span></span></code></pre></div><div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  For ABP devices, <code>mac-settings.factory-preset-frequencies</code> should be specified on <code>device create</code> or the settings will only take effect after MAC reset.
</div>

<h3 id="set-duty-cycle">Set Duty Cycle</h3>
<p>To change the duty cycle, set the <code>desired-max-duty-cycle</code> parameter. For example, to set the duty cycle to 0.098%, use the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices <span class="nb">set</span> &lt;app-id&gt; &lt;device-id&gt; --mac-settings.desired-max-duty-cycle DUTY_CYCLE_1024
</span></span></code></pre></div><p>See the <a href="https://www.thethingsindustries.com/docs/reference/api/end_device/#message:MACSettings">End Device API Reference</a> for available fields and definitions of constants. <code>DUTY_CYCLE_1024</code> represents 1/1024 ≈ 0.098%.</p>
<h3 id="enable-adr">Enable ADR</h3>
<p>To enable ADR, set the <code>mac-settings.use-adr</code> parameter:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices <span class="nb">set</span> &lt;app-id&gt; &lt;device-id&gt; --mac-settings.use-adr<span class="o">=</span><span class="nb">true</span> 
</span></span></code></pre></div><p>See the <a href="https://www.thethingsindustries.com/docs/reference/adr/">Adaptive Data Rate</a> section for detailed information on configuring ADR parameters and ADR margin using MAC settings.</p>
<h3 id="set-rx1-delay">Set RX1 Delay</h3>
<p>The RX1 delay of end devices is set to 5 second by default. To change it, set the <code>desired-rx1-delay</code> parameter:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices <span class="nb">set</span> &lt;app-id&gt; &lt;device-id&gt; --mac-settings.desired-rx1-delay RX_DELAY_5
</span></span></code></pre></div><h3 id="unset-mac-settings">Unset MAC settings</h3>
<p>The CLI can also be used to unset MAC settings (so that the default ones are used):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices <span class="nb">set</span> &lt;app-id&gt; &lt;device-id&gt; --unset mac-settings.rx1-delay
</span></span></code></pre></div><h2 id="session-and-mac-state-reset">Session and MAC State Reset</h2>
<p>Resetting session and MAC state for OTAA devices will wipe out all session and MAC data, and the end device will need to perform a rejoin on The Things Stack network. For ABP devices, only MAC state gets reset, while session keys, DevAddr and downlink queue are preserved.</p>
<p>Session and MAC state can be reset through the Console - navigate to your end device&rsquo;s <strong>General settings</strong> tab, scroll down to the <strong>Network layer</strong> section, press the <strong>Reset session and MAC state</strong> button and confirm.</p>
<p>To reset session and MAC state using the CLI:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ttn-lw-cli end-devices reset --application-id &lt;application-id&gt; --device-id &lt;device-id&gt;
</span></span></code></pre></div>
        </div>
        
          <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/devices/confirmed-downlinks-behavior/">← Confirmed Downlinks Behavior</a>
<a class="button is-pulled-right" href="/docs/devices/atecc608a/">ATECC608 Secure Elements →</a>
</div>

          <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#mac-settings-and-mac-state'>MAC Settings and MAC State</a></li>
    
      
      <li><a href='#available-mac-settings'>Available MAC Settings</a></li>
    
      
      <li><a href='#class-specific-settings'>Class Specific Settings</a></li>
    
      
      <li><a href='#examples'>Examples</a></li>
    
      
      <li><a href='#session-and-mac-state-reset'>Session and MAC State Reset</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/the-things-stack/">The Things Stack</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/ttn-network/v3/90">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Krishna Iyer on 19 Apr 2023.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/7b36a78abab91e6a6967b41f03b65551a89e54c9">
      Restructure documentation (#1076)
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/devices/mac-settings/_index.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.a32708c8796e7e8713fa926212adddbbf5c15cdd97676d898ecfc17bc6d9ed4f.js" integrity="sha256-oycIyHlufocT&#43;pJiEq3du/XBXN2XZ22Jjs/Be8bZ7U8=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
