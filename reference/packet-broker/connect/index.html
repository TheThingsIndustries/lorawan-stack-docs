<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.70.0" />
  <title>Connect | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/reference/packet-broker/connect/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.25b30cdd256bfe2021b3a162f05871509954bca5cc3a6e85d1f515ea9ed6aa0f.css" integrity="sha256-JbMM3SVr/iAhs6Fi8FhxUJlUvKXMOm6F0fUV6p7Wqg8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Connect">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Connect">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/reference/packet-broker/connect/">
  <meta name="twitter:title" content="Connect" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
</head>


<body><nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.14</p>
      </a><div class="navbar-item navbar-search-brand">
        <div class="field has-addons has-addons-centered">
          <div class="control">
            <input id="search-input-brand" class="input search-bar" type="text" placeholder="Search the docs..." type="text">
          </div>
        </div>
      </div>
      
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a><div class="navbar-item navbar-search-menu">
            <div class="field has-addons has-addons-centered">
              <div class="control">
                <input id="search-input-menu" class="input search-bar" type="text" placeholder="Search the docs..." type="text">
              </div>
            </div>
          </div></div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="/docs/download/">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript">
    docsearch({
      apiKey: "4372282a02970d8402d43457bf95d486",
      indexName: "thethingsstack",
      inputSelector: '#search-input-brand',
      debug: false 
    });
    docsearch({
      apiKey: "4372282a02970d8402d43457bf95d486",
      indexName: "thethingsstack",
      inputSelector: '#search-input-menu',
      debug: false 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Reference</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/reference/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/stripe/" class="">Billing with Stripe</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/adr/" class="">Adaptive Data Rate</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/api/" class="">API</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/application-packages/" class="">Application Packages</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/cli/" class="">Command-Line Interface</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/components/" class="">Components</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/configuration/" class="">Configuration</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/data-formats/" class="">Data Formats</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/data-retention/" class="">Data Retention and Privacy</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/email-templates/" class="">Email Templates</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/federated-auth/" class="">Federated Authentication</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/frequency-plans/" class="">Frequency Plans</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/glossary/" class="">Glossary</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/id-eui-constraints/" class="">ID and EUI Constraints</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/interop-repository/" class="">Interoperability Repository</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/lbs-implementation-guide/implementation-details/" class="">LoRa Basics Station Implementation Guide</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/spec-regional-parameters/" class="">LoRaWAN Specification and Regional Parameters</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/networking/" class="">Networking</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/packet-broker/" class="">Packet Broker</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/reference/packet-broker/connect/" class="is-active">Connect</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/reference/packet-broker/configure/" class="">Configure</a>
    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/purge/" class="">Purging Entities</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/rate-limiting/" class="">Rate Limiting</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/root-certificates/" class="">Root Certificates</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/telemetry/" class="">Telemetry</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/reference/branding/" class="">Web UI Branding</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">Connect
          
        </h1>
        
        <h2 class="subtitle">
          
            
            





  
    
  

  
    
  



  

  

<a href="/docs/download" target="_blank" class="badge-stack has-tooltip has-tooltip-arrow has-tooltip-light" data-tooltip="Enterprise and Open Source Only">

  <img class="badge" src="/docs/img/tts_frames/frame_enterprise.svg"></img>

  <img class="badge" src="/docs/img/tts_frames/frame_open_source.svg"></img>

</a>


          
          
          
        </h2>
        
        <div class="content">
          <p>This section explains how to connect The Things Stack to Packet Broker.</p>
<div class="notification is-primary is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Info:</h5>
  <p>The Things Stack Cloud and The Things Network are already connected to Packet Broker. Use this section to connect your The Things Stack Enterprise or Open Source deployment to Packet Broker.</p>
<p>If you are using The Things Stack Cloud or if your The Things Stack deployment is connected to Packet Broker, proceed to <a href="/docs/reference/packet-broker/configure/">configure Packet Broker</a>.</p>

</div>

<h2 id="prerequisites">Prerequisites</h2>
<ol>
<li>A LoRa Alliance NetID or a tenant of a host NetID</li>
</ol>
<ul>
<li>To obtain a NetID, <a href="https://lora-alliance.org/become-a-member">become a member of the LoRa Alliance</a></li>
<li>To obtain a DevAddr block, <a href="mailto:sales@thethingsindustries.com">contact The Things Industries sales</a></li>
</ul>
<ol start="2">
<li>Access to Packet Broker with an API key</li>
</ol>
<ul>
<li>To obtain access to Packet Broker, <a href="mailto:sales@thethingsindustries.com">contact The Things Industries sales</a></li>
</ul>
<ol start="3">
<li>The Things Stack installed and configured. See <a href="https://www.thethingsindustries.com/docs/getting-started/">Getting Started</a></li>
<li>Packet Broker CLI installed and configured. See <a href="https://github.com/packetbroker/pb">Packet Broker CLI</a></li>
</ol>
<h2 id="define-devaddr-prefix-by-netid">Define DevAddr Prefix by NetID</h2>
<p>If you own a NetID, enter your NetID to obtain your DevAddr prefix:</p>
<div class="field">
  <label class="label">NetID (hex)</label>
  <div class="control">
    <input class="input" type="text" data-content="net-id" placeholder="net-id" maxlength="6" minlength="6">
  </div>
</div>

<script>
  window.addEventListener('load', function (e) {
    var $netIDInput = document.querySelector('input[data-content="net-id"]');
    var query = new URLSearchParams(window.location.search);
    $netIDInput.value = query.has('net-id') ? query.get('net-id') : '000013';
    var $devAddrPrefixSpans = document.querySelectorAll('span[data-content="dev-addr-prefix"]')
    function update() {
      var netID = parseInt($netIDInput.value ? $netIDInput.value : '000013', 16);
      if (netID == NaN) {
        netID = 0;
      }
      var type = netID >> 21;
      var nwkIDMask;
      switch (type) {
        case 0b000, 0b001:
          nwkIDMask = 0x3f;
        case 0b010:
          nwkIDMask = 0x1ff;
        default:
          nwkIDMask = 0x1fffff;
      }
      var nwkID = netID & nwkIDMask;
      var nwkIDBits = [6, 6, 9, 11, 12, 13, 15, 17][type];
      var nwkAddrBits = [25, 24, 20, 17, 15, 13, 10, 7][type];
      var typePrefix = type > 0 ? ((1 << type) - 1 << 32 - type) >>> 0 : 0;
      var devAddrBase = typePrefix + ((nwkID & (1 << nwkIDBits) - 1) << nwkAddrBits);
      $devAddrPrefixSpans.forEach(function($span) {
        $span.innerText = ('00000000' + devAddrBase.toString(16).toUpperCase()).slice(-8) + '/' + (32 - nwkAddrBits).toString();
      });
    }
    update();
    $netIDInput.addEventListener('keyup', update);
  });
</script>

<p>Your DevAddr prefix is: <code><span data-content="dev-addr-prefix"></span></code></p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  This guide uses The Things Network NetID <code>000013</code> as example, which has DevAddr prefix <code>26000000/7</code>.
</div>

<h2 id="configure-packet-broker-agent">Configure Packet Broker Agent</h2>
<p>The Packet Broker Agent component of The Things Stack connects to Packet Broker. The Packet Broker Agent can be configured as Forwarder and as Home Network in your <code>ttn-lw-stack.yaml</code> configuration file:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Add Packet Broker configuration to your configuration file:</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># Packet Broker Agent configuration</span><span class="w">
</span><span class="w"></span><span class="k">pba</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="c"># See https://packetbroker.org for available hosts</span><span class="w">
</span><span class="w">  </span><span class="k">data-plane-address</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;eu.packetbroker.io:443&#39;</span><span class="w">
</span><span class="w">  </span><span class="k">net-id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;000013&#39;</span><span class="w">
</span><span class="w">  </span><span class="k">tenant-id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;my-tenant&#39;</span><span class="w"> </span><span class="c"># Leave empty if you own the NetID and you don&#39;t use tenants</span><span class="w">
</span><span class="w">  </span><span class="k">cluster-id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;my-cluster&#39;</span><span class="w"> </span><span class="c"># Unique identifier of your routing cluster</span><span class="w">
</span><span class="w">  </span><span class="k">authentication-mode</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;oauth2&#39;</span><span class="w">
</span><span class="w">  </span><span class="k">oauth2</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">client-id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="c"># API key ID</span><span class="w">
</span><span class="w">    </span><span class="k">client-secret</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="c"># Secret API key value</span><span class="w">
</span><span class="w">  </span><span class="k">forwarder</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">enable</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="c"># generate 16 bytes (openssl rand -hex 16)</span><span class="w">
</span><span class="w">    </span><span class="k">token-key</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;00112233445566770011223344556677&#39;</span><span class="w">
</span><span class="w">  </span><span class="k">home-network</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">enable</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></code></pre></div><p>See <a href="https://www.thethingsindustries.com/docs/reference/configuration/packet-broker-agent/">Packet Broker Agent configuration</a> for all configuration options.</p>
<h2 id="configure-gateway-server">Configure Gateway Server</h2>
<p>Configure the Gateway Server to forward traffic for the current network to the Network Server in the cluster, and route all traffic to Packet Broker (via Packet Broker Agent):</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Edit the Gateway Server configuration in your configuration file:</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># Gateway Server configuration</span><span class="w">
</span><span class="w"></span><span class="k">gs</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">forward</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="c"># Forward traffic to the Network Server in the cluster</span><span class="w">
</span><span class="w">  </span>- <span class="s1">&#39;cluster=26000000/7&#39;</span><span class="w"> </span><span class="c"># Enter your DevAddr range</span><span class="w">
</span><span class="w">  </span><span class="c"># Forward all traffic also to Packet Broker</span><span class="w">
</span><span class="w">  </span>- <span class="s1">&#39;packetbroker=00000000/0&#39;</span><span class="w">
</span></code></pre></div><p>See <a href="https://www.thethingsindustries.com/docs/reference/configuration/gateway-server/">Gateway Server configuration</a> for all configuration options.</p>
<h2 id="configure-network-server">Configure Network Server</h2>
<p>Configure the Network Server to issue device addresses (DevAddr) that fall within your NetID:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Edit the Network Server configuration in your configuration file:</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># Network Server configuration.</span><span class="w">
</span><span class="w"></span><span class="k">ns</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">net-id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;000013&#39;</span><span class="w">
</span></code></pre></div><p>If you are using a NetID tenant with one or more DevAddr blocks, configure the Network Server to use those blocks:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Network Server configuration.</span><span class="w">
</span><span class="w"></span><span class="k">ns</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">net-id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;000013&#39;</span><span class="w">
</span><span class="w">  </span><span class="k">dev-addr-prefixes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="s1">&#39;27111100/16&#39;</span><span class="w">
</span><span class="w">  </span>- <span class="s1">&#39;27222200/16&#39;</span><span class="w">
</span></code></pre></div><div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  By default, the Network Server uses NetID <code>000000</code> which is intended for experimentation purposes. Only devices that are activated with a DevAddr that refers to a NetID will have their traffic routed by Packet Broker to your network.
</div>

<p>See <a href="https://www.thethingsindustries.com/docs/reference/configuration/network-server/">Network Server configuration</a> for all configuration options.</p>
<h2 id="configure-packet-broker">Configure Packet Broker</h2>
<p>When The Things Stack is connected to Packet Broker, you can proceed with <a href="/docs/reference/packet-broker/configure/">Packet Broker Configuration</a>.</p>
<h2 id="advanced-test-uplink-and-downlink">Advanced: Test Uplink and Downlink</h2>
<p>See <a href="https://github.com/packetbroker/pb#publish-and-subscribe-traffic">Publish and Subscribe Traffic</a> on how to publish test messages and subscribe to traffic using Packet Broker CLI.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  Packet Broker Agent uses the configured <code>cluster-id</code> as Forwarder ID and subscription group.
</div>


        </div>
        <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/reference/packet-broker/">← Packet Broker</a>
<a class="button is-pulled-right" href="/docs/reference/packet-broker/configure/">Configure →</a>
</div>

        <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#prerequisites'>Prerequisites</a></li>
    
      
      <li><a href='#define-devaddr-prefix-by-netid'>Define DevAddr Prefix by NetID</a></li>
    
      
      <li><a href='#configure-packet-broker-agent'>Configure Packet Broker Agent</a></li>
    
      
      <li><a href='#configure-gateway-server'>Configure Gateway Server</a></li>
    
      
      <li><a href='#configure-network-server'>Configure Network Server</a></li>
    
      
      <li><a href='#configure-packet-broker'>Configure Packet Broker</a></li>
    
      
      <li><a href='#advanced-test-uplink-and-downlink'>Advanced: Test Uplink and Downlink</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/network-and-routing/v3">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Ben Olayinka on 05 May 2021.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/b5ead966fa1b5418399c3497d0d4c07a1def4d3e">
      doc: Add note about regions in PB
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/reference/packet-broker/connect.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.79500656c3860a54b3b38e5f5770a5130bc57306ebb67ca9b057e494f6f4b454.js" integrity="sha256-eVAGVsOGClSzs45fV3ClEwvFcwbrtnypsFfklPb0tFQ=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
