<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.70.0" />
  <title>Migrate Active Sessions | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/getting-started/migrating/migrating-from-v2/migrate-using-migration-tool/migrate-active-session/" />
  <link rel="alternate icon" href="/docs/favicon.ico">
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.cf9447944fbcc7bdf6a5140d8d9c5c7c741f08af5d17e0b1c3bd26da8cd08507.css" integrity="sha256-z5RHlE&#43;8x732pRQNjZxcfHQfCK9dF&#43;Cxw70m2ozQhQc=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Migrate Active Sessions">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Migrate Active Sessions">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/getting-started/migrating/migrating-from-v2/migrate-using-migration-tool/migrate-active-session/">
  <meta name="twitter:title" content="Migrate Active Sessions" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
</head>
<body><nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.13</p>
      </a>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a>
      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="/docs/download/">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav>
<section class="search-container">
    <div class="container">
      <div class="columns is-vcentered">
        <div class="column">
          <div class="field has-addons has-addons-centered">
            <div class="control">
              <input class="input search-bar" id="search-input" type="text" placeholder="Search" type="text">
            </div>
          </div>
        </div>
      </div>
    </div>
</section>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
apiKey: "4372282a02970d8402d43457bf95d486",
indexName: "thethingsstack",
inputSelector: '#search-input',
debug: false 
});
</script>
<div class="container" role="document">
  <div class="columns my-0">
      <div class="column is-one-fifth-tablet is-one-third sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Getting Started</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/getting-started/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/quick-start/" class="">Quick Start</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/what-is-tts/" class="">What Is The Things Stack?</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/cli/" class="">Command-line Interface</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/console/" class="">Console</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/installation/" class="">Installing The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/" class="">Migrating to The Things Stack</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/major-changes/" class="">Major Changes In The Things Stack</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/migrating-from-v2/" class="">Migrating End Devices from V2</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/migrating-from-v2/packet-broker-requirements/" class="">Packet Broker Requirements for End Device Migration</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/migrating-from-v2/migrate-using-console/" class="">Migrate using the Console</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/migrating-from-v2/migrate-using-migration-tool/" class="">Migrate using the Migration Tool</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/migrating-from-v2/migrate-using-migration-tool/establish-new-session/" class="">Migrate without Persisting Active Sessions</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/migrating-from-v2/migrate-using-migration-tool/migrate-active-session/" class="is-active">Migrate Active Sessions</a>
    
  </li>

</ul>


    
  </li>

</ul>


    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/migrate-from-chirpstack/" class="">Migrating End Devices from ChirpStack</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/import-devices/" class="">Import End Devices in The Things Stack</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/migration-tool/" class="">Migration Tool</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/configure-mac-settings/" class="">Fine-tuning MAC Settings for End Devices</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/gateway-migration/" class="">Migrating Gateways</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/device-json/" class="">JSON File Reference</a>
    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/ttn/" class="">The Things Network</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/" class="">The Things Stack AWS Launcher</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/cloud-hosted/" class="">The Things Stack Cloud</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/troubleshooting/" class="">Troubleshooting Getting Started</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/upgrading/" class="">Upgrading The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/user-management/" class="">Users and Organizations</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/api/" class="">Using the API</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/events/" class="">Working with Events</a>
  </li>
</ul>



</nav>








      </div>
      <div class="column sidebar-middle">

<div class="docs-content">
<h1 class="title is-size-2">Migrate Active Sessions
  
  
  
    <span class="new-in-version">New in 3.12.0</span>

  
  
</h1>

<div class="content">
  <p>Starting from The Things Stack version <code>3.12.0</code>, it is possible to migrate end devices together with their active sessions using the <code>ttn-lw-migrate</code> tool. This section explains how to export one or more of your end devices from V2 to a <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/device-json/">JSON file</a>, with persisting their active sessions.</p>
<div class="notification is-warning is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Warning:</h5>
  <p>Active device sessions can be migrated via Packet Broker only from <strong>The Things Industries V2 (SaaS)</strong> to <strong>The Things Stack Cloud</strong>, and this is achievable only on a customer request. Contact <a href="mailto:support@thethingsindustries.com">The Things Industries support</a> for more information.</p>
<p>For all other scenarios, migrating active session is achievable only if you <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/gateway-migration/">migrate your gateway to The Things Stack</a> too. However, we strongly recommend The Things Network community members to keep their gateways registered on The Things Network V2 for as long as possible, or to agree on performing coordinated migration to The Things Stack, as this will ensure the community does not loose their LoRaWAN coverage.</p>

</div>

<div class="notification is-primary is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Info:</h5>
  We strongly recommend migrating end devices without persisting active sessions.
</div>

<div class="tabs is-boxed">
  <ul>
    
    <li data-tab="otaa">
      <a>
        <span>OTAA</span>
      </a>
    </li>
    
    <li data-tab="abp">
      <a>
        <span>ABP</span>
      </a>
    </li>
    
  </ul>
</div>
<div class="tab-content content">
  <section data-content="otaa">
  In the case of persisting active sessions during migration, OTAA devices do not need to perform a new join on The Things Stack network, but their existing session will be transferred from V2.
</section>
<section data-content="abp">
  <p>The <strong>DevAddr</strong> and some other parameters (like <strong>RX1 Delay</strong>) are hardcoded for ABP devices. If you do not re-program the device to change these values, you can migrate it to The Things Stack with its active session.</p>
<p>Remember that if you are not migrating specifically from <strong>The Things Industries V2 (SaaS)</strong> to <strong>The Things Stack Cloud</strong>, you will have to <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/gateway-migration/">migrate your gateway</a> to successfully migrate your end device with its active session.</p>
</section>

</div>

<div class="notification is-warning is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Warning:</h5>
  Exporting end devices with their active sessions will clear their root and session keys from V2, so these devices will automatically no longer work on V2.
</div>

<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  Before exporting end devices, you can first test the execution by appending the <code>--dry-run</code> and <code>--verbose</code> flags to the commands presented in the sections below.
</div>

<h3 id="export-a-single-end-device">Export a Single End Device</h3>
<p>To export a single end device from V2 and clear its security keys:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ttn-lw-migrate device --source ttnv2 <span class="s2">&#34;v2-end-device-ID&#34;</span> &gt; devices.json
</code></pre></div><h3 id="export-a-batch-of-end-devices">Export a Batch of End Devices</h3>
<p>First, create a text file <code>device_ids.txt</code>. This file needs to contain a V2 <strong>Device ID</strong> for every end device you want to export from V2.</p>
<p>The format of this file is one <strong>Device ID</strong> per one line, i.e.:</p>
<pre><code>dev1
dev2
dev3
</code></pre><p>To export a batch of end devices from V2 and clear their security keys:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ttn-lw-migrate device --source ttnv2 &lt; device_ids.txt &gt; devices.json
</code></pre></div><h3 id="export-all-end-devices-associated-with-v2-application">Export All End Devices Associated With V2 Application</h3>
<p>To export all devices contained in V2 application and clear their security keys:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ttn-lw-migrate application --source ttnv2 <span class="s2">&#34;ttn-v2-application-ID&#34;</span> &gt; devices.json
</code></pre></div><h2 id="import-end-devices-in-the-things-stack-application">Import End Devices in The Things Stack Application</h2>
<p>Now that you have exported one or more of your devices to a <code>devices.json</code> file, you can continue by importing this file in The Things Stack via Console or via CLI.</p>
<blockquote>
<p>See <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/import-devices/">Import End Devices in The Things Stack</a> for detailed instructions on how to do this.</p>
</blockquote>
<h2 id="next-step---migrate-gateways">Next Step - Migrate Gateways</h2>
<div class="tabs is-boxed">
  <ul>
    
    <li data-tab="otaa">
      <a>
        <span>OTAA</span>
      </a>
    </li>
    
    <li data-tab="abp">
      <a>
        <span>ABP</span>
      </a>
    </li>
    
  </ul>
</div>
<div class="tab-content content">
  <section data-content="otaa">
  Migrating your OTAA device from <strong>The Things Industries V2 (SaaS)</strong> to <strong>The Things Stack Cloud</strong> with its active session means it will keep its <strong>DevAddr</strong>, channel settings and MAC parameters from V2. It will not send new Join Requests, but the uplink traffic from your device should automatically show up in The Things Stack, because it will be routed via Packet Broker thanks to preserving your device&rsquo;s existing session.
</section>
<section data-content="abp">
  Migrating your ABP device from <strong>The Things Industries V2 (SaaS)</strong> to <strong>The Things Stack Cloud</strong> with its active session means it will keep its <strong>DevAddr</strong>, channel settings and MAC parameters from V2. Once properly migrated, the uplink traffic from your end device should automatically show up in The Things Stack, because it will be routed via Packet Broker thanks to preserving your device&rsquo;s existing session.
</section>

</div>

<p>If you are migrating an end device with its active session via Packet Broker, you will need to set the <strong>RX1 Delay</strong> of the device to 5 seconds by <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/configure-mac-settings/">configuring MAC settings</a>, otherwise the traffic might not reach The Things Stack in time via Packet Broker.</p>
<p>You can leave the <strong>RX1 Delay</strong> value as is (1 second from V2), but then you will need to <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/gateway-migration/">migrate your gateway to The Things Stack</a> too - keep in mind that if your gateway has a high-latency backhaul, you could still experience latency issues.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  Even if you manage to get your end device traffic routed to The Things Stack via Packet Broker, we recommend you get in touch with your local The Things Network community and agree on coordinating the migration of gateways, so you do not loose the LoRaWAN network coverage. See how to <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/gateway-migration/">migrate your gateway to The Things Stack</a>.
</div>
</div>
<div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/getting-started/migrating/migrating-from-v2/migrate-using-migration-tool/establish-new-session/">‚Üê Migrate without Persisting Active Sessions</a>
</div>

<script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
</div>


      </div>
      <div class="column is-hidden-touch is-one-quarter is-one-fifth-widescreen sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#import-end-devices-in-the-things-stack-application'>Import End Devices in The Things Stack Application</a></li>
    
      
      <li><a href='#next-step---migrate-gateways'>Next Step - Migrate Gateways</a></li>
    
  </ul>


  </nav>

      </div>
  </div>
</div>


<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/network-and-routing/v3">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Nejra on 05 May 2021.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/fb7323953601e8b119025450db03a29517d2e62e">
      doc: Fix migration docs
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/getting-started/migrating/migrating-from-v2/migrate-using-migration-tool/migrate-active-session.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.af1cdce2271a42369c7c022fb683df665bf882e1fdc766a89a6ee99196bc4f9e.js" integrity="sha256-rxzc4icaQjacfAIvtoPfZlv4guH9x2aomm7pkZa8T54=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
