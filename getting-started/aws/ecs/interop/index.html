<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.70.0" />
  <title>Interoperability | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/interop/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.cfe865954edfe434e98142c39643957012b2f6f55c7a22b86ac263279cadc889.css" integrity="sha256-z&#43;hllU7f5DTpgULDlkOVcBKy9vVceiK4asJjJ5ytyIk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
  <meta name="description" content="LoRaWAN Backend Interfaces">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Interoperability">
  <meta itemprop="description" content="LoRaWAN Backend Interfaces">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Interoperability">
  <meta property="og:description" content="LoRaWAN Backend Interfaces">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/interop/">
  <meta name="twitter:title" content="Interoperability" />
  <meta name="twitter:description" content="LoRaWAN Backend Interfaces" />
  <meta name="twitter:card" content="summary" />
</head>


<body><nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.17.1</p>
      </a><div class="navbar-item navbar-search-brand">
        <div class="field has-addons has-addons-centered">
          <div class="control">
            <input id="search-input-brand" class="input search-bar" type="text" placeholder="Search the docs..." type="text">
          </div>
        </div>
      </div>
      
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a><div class="navbar-item navbar-search-menu">
            <div class="field has-addons has-addons-centered">
              <div class="control">
                <input id="search-input-menu" class="input search-bar" type="text" placeholder="Search the docs..." type="text">
              </div>
            </div>
          </div></div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://www.thethingsindustries.com/deployment/">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript">
    docsearch({
      apiKey: "4372282a02970d8402d43457bf95d486",
      indexName: "thethingsstack",
      inputSelector: '#search-input-brand',
      debug: false 
    });
    docsearch({
      apiKey: "4372282a02970d8402d43457bf95d486",
      indexName: "thethingsstack",
      inputSelector: '#search-input-menu',
      debug: false 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Getting Started</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/getting-started/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/quick-start/" class="">Quick Start</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/what-is-tts/" class="">What Is The Things Stack?</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/troubleshooting/" class="">Troubleshooting Getting Started</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/cli/" class="">Command-line Interface</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/console/" class="">Console</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/installation/" class="">Installing The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/" class="">Migrating to The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/packet-broker/" class="">Packet Broker</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/server-addresses/" class="">Server Addresses</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/sso/" class="">Single Sign-On</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/ttn/" class="">The Things Network</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/" class="">The Things Stack AWS Launcher</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ami/" class="">AWS Marketplace AMI</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/" class="">AWS ECS</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/architecture/" class="">Architecture</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/prerequisites/" class="">Prerequisites</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/deployment/" class="">Deployment</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/interop/" class="is-active">Interoperability</a>
    
    



    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/troubleshooting/" class="">Troubleshooting AWS ECS Deployment</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/updating/" class="">Updating</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/database-operations/" class="">Database Operations</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/monitoring/" class="">Monitoring</a>
    
  </li>

</ul>


    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/cloud-hosted/" class="">The Things Stack Cloud</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/upgrading/" class="">Upgrading The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/user-management/" class="">Users and Organizations</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/api/" class="">Using the API</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/events/" class="">Working with Events</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">Interoperability
          
        </h1>
        
        <div class="content">
          <p>The Things Stack exposes the Join Server API defined by LoRaWAN Backend Interfaces 1.0 and 1.1. This is used for interoperability between LoRaWAN networks.</p>
<p>The functionality can be exposed either by the Join Server or by the Identity Server, but not both at once. Join Server is capable of handling the join flow, that is <code>HomeNSReq</code>, <code>JoinReq</code> and <code>AppSKeyReq</code> requests. Identity Server can only answer to <code>HomeNSReq</code>. Typically, you should enable interoperability if you want to use device activations through Packet Broker. You can use Join Server interoperability if you want to expose the entire join flow to other LoRaWAN network servers.</p>
<h1 id="tls">TLS</h1>
<p>Normally, AWS Load Balancer terminates TLS, and then forwards unencrypted packets to The Things Stack via AWS internal network. This assures that all clients connecting to The Things Stack are certain of its authenticity.</p>
<p>This doesn&rsquo;t work the other way around though, as AWS Load Balancer doesn&rsquo;t verify client certificates. It is up to you where you choose to terminate TLS:</p>
<h2 id="tls-termination-by-the-aws-load-balancer">TLS termination by the AWS Load Balancer</h2>
<p>When parameters <code>InteropEnabled</code>, <code>InteropEnabledIS</code> and <code>InteropEnabledJS</code> in templates <code>3-2-load-balancer</code>, <code>5-3a-ecs-is-service</code> and <code>5-4-ecs-services</code> are set to <code>server-only-authentication</code>, TLS is terminated by the AWS Load Balancer, just like any other connection. This is only suitable for use cases where you don&rsquo;t need to verify client authenticity.</p>
<h2 id="tls-termination-by-the-things-stack">TLS termination by The Things Stack</h2>
<p>When parameters <code>InteropEnabled</code>, <code>InteropEnabledIS</code> and <code>InteropEnabledJS</code> in templates <code>3-2-load-balancer</code>, <code>5-3a-ecs-is-service</code> and <code>5-4-ecs-services</code> are set to <code>mutual-authentication</code>, TLS-encrypted connections are forwarded to The Things Stack, which terminates the encryption. This allows the stack to verify client certificates stored in the S3 bucket.</p>
<h1 id="join-server-interoperability">Join Server interoperability</h1>
<h2 id="deployment">Deployment</h2>
<p>In this setup, you are assumed to use two accounts: one account for The Things Stack, and another one only for the Crypto Server.</p>
<h3 id="step-1-deploy-the-things-stack">Step 1: deploy The Things Stack</h3>
<p>Deploy The Things Stack normally. For the <code>PeerRequesterAccountId</code> parameter in <code>1-1-vpc</code>, use the ID of the account where you want to deploy Crypto Server. Do not enable interop and assume that The Things Stack doesn&rsquo;t connect to the Crypto Server.</p>
<h3 id="step-2-add-certificates">Step 2: add certificates</h3>
<p>For the server certificate:</p>
<ul>
<li>if you use <code>server-only-authentication</code>, AWS Load Balancer will use existing certificate</li>
<li>if you use <code>mutual-authentication</code>, then use the certbot task to request a certificate. It will be put into AWS Secrets Manager, and then fetched by The Things Stack</li>
</ul>
<p>If you&rsquo;re using <code>mutual-authentication</code>, you need to populate client certificates stored in the interop config bucket, created in template <code>2-4b-routing-s3</code>. In this bucket you need to place a file <code>config.yml</code>, which contains a map <code>&lt;net-id&gt;: &lt;ca.pem&gt;</code>. Example configuration:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">000000</span><span class="p">:</span><span class="w"> </span>ca<span class="m">-000000.</span>pem<span class="w">
</span><span class="w"></span><span class="k">000009</span><span class="p">:</span><span class="w"> </span>ca<span class="m">-000009.</span>pem<span class="w">
</span></code></pre></div><h3 id="step-3-deploy-the-crypto-server">Step 3: deploy the Crypto Server</h3>
<p>Deploy the template <code>200-1-crypto</code>. This template is designed to be deployed in a separate account, but same region. No other templates are needed for Crypto Server, this is a self-contained deployment.</p>
<ul>
<li>the tuple <code>${Cluster}.${Environment}.${NetworkName}</code> should NOT be identical. We suggest using the same <code>NetworkName</code> and <code>Environment</code>, but different <code>Cluster</code></li>
<li>the <code>CidrBlock</code> parameter should NOT be identical</li>
<li>the <code>ClusterSecretValue</code> parameter MUST be identical</li>
<li>the <code>DefaultTenantID</code> parameter MUST be identical</li>
<li>the <code>Domain</code> parameter MUST be identical</li>
<li>skip the <code>ServicesDNSZone</code> parameter</li>
<li>refer to outputs of the <code>1-1-vpc</code> template for the <code>Peer*</code> parameters</li>
</ul>
<h3 id="step-4-peer-networks">Step 4: peer networks</h3>
<p>Deploy the template <code>6-1-vpc-peering</code> where you had deployed the Join Server to create the peering association. Refer to the Crypto Server stack for inputs of <code>6-1-vpc-peering</code>.</p>
<p>The Things Stack uses Route53 for service discovery. In order to enable the Join Server &lt;-&gt; Crypto Server service discovery, you need to associate the <code>${Cluster}.${Environment}.${NetworkName}.cluster.local</code> hosted zone of Join Server with the VPC of Crypto Server and vice versa. For details on how to do it, refer to the <a href="https://aws.amazon.com/premiumsupport/knowledge-center/route53-private-hosted-zone/">AWS Documentation</a>.</p>
<h3 id="step-5-activate-the-connection">Step 5: activate the connection</h3>
<p>Go through the Join Server stack and turn on switches for Interop:</p>
<ul>
<li><code>3-2-load-balancer</code>: set <code>InteropEnabled</code> to value other than <code>disabled</code></li>
<li><code>5-3a-ecs-is-service</code>: since you&rsquo;re setting up Join Server, not Identity Server interoperability, leave <code>InteropEnabledIS</code> as <code>disabled</code></li>
<li><code>5-4-ecs-services</code>:
<ul>
<li>set <code>InteropEnabledJS</code> to the same value as previously <code>InteropEnabled</code></li>
<li>set <code>CryptoServerDNSName</code> to <code>cs.${Cluster}.${Environment}.${NetworkName}.cluster.local</code>, where values for tuple <code>${Cluster}.${Environment}.${NetworkName}</code> come from the Crypto Server deployment</li>
<li>set <code>InteropPacketBrokerEnabled</code> to a value relevant for your use case</li>
<li>set <code>InteropPacketBrokerTokenIssuer</code> to a value relevant for your use case</li>
</ul>
</li>
</ul>
<p>Set the <code>ServicesDNSZone</code> parameter in the Crypto Server deployment. The value is expected to be in format <code>${Cluster}.${Environment}.${NetworkName}.cluster.local</code>, where where values for the tuple <code>${Cluster}.${Environment}.${NetworkName}</code> come from the Join Server deployment</p>
<h3 id="step-6-encrypt-key-values-for-secure-element-parts">Step 6: encrypt key values for secure element parts</h3>
<p>Go to the Crypto Server stack and encrypt secure element parts keys using the AWS KMS key from stack output <code>MicrochipPartsTableKey</code> and put them into the DynamoDB table from output <code>MicrochipPartsTable</code>. You can do it in the following way:</p>
<ol>
<li>Create a file <code>input.json</code> with the following contents: <code>{&quot;KeyId&quot;: &quot;&lt;MicrochipPartsTableKey&gt;&quot;, &quot;Plaintext&quot;: &quot;&lt;SecureElementKeyValueInBase64&gt;&quot;}</code></li>
<li><code>aws kms encrypt --cli-input-json file://input.json</code>. It is important to use the input json file so that secret value doesn&rsquo;t stay in history</li>
<li>Change the contents of <code>input.json</code> to <code>{&quot;TableName&quot;: &quot;&lt;MicrochipPartsTableKey&gt;&quot;, &quot;Item&quot;: {&quot;part_number&quot;: {&quot;S&quot;: &quot;&lt;PartNumber&gt;&quot;}, &quot;psk_root_keys_encrypted&quot;: {&quot;S&quot;: &quot;&lt;CiphertextBlobFromKMSEncrypt&gt;&quot;}}}</code></li>
<li><code>aws dynamodb put-item --cli-input-json file://input.json</code></li>
<li><code>rm input.json</code></li>
</ol>
<p>At this point interoperability should be working. It might be required to restart the containers before they pick up new configuration.</p>
<h1 id="identity-server-interoperability">Identity Server interoperability</h1>
<p>As opposed to Join Server interoperability, this setup doesn&rsquo;t expect you to use two accounts.</p>
<h3 id="step-1-deploy-the-things-stack-1">Step 1: deploy The Things Stack</h3>
<p>Deploy The Things Stack normally.</p>
<h3 id="step-2-add-certificates-1">Step 2: add certificates</h3>
<p>For the server certificate:</p>
<ul>
<li>if you use <code>server-only-authentication</code>, AWS Load Balancer will use existing certificate</li>
<li>if you use <code>mutual-authentication</code>, then use the certbot task to request a certificate. It will be put into AWS Secrets Manager, and then fetched by The Things Stack</li>
</ul>
<p>If you&rsquo;re using <code>mutual-authentication</code>, you need to populate client certificates stored in the interop config bucket, created in template <code>2-4b-routing-s3</code>. In this bucket you need to place a file <code>config.yml</code>, which contains a map <code>&lt;net-id&gt;: &lt;ca.pem&gt;</code>. Example configuration:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">000000</span><span class="p">:</span><span class="w"> </span>ca<span class="m">-000000.</span>pem<span class="w">
</span><span class="w"></span><span class="k">000009</span><span class="p">:</span><span class="w"> </span>ca<span class="m">-000009.</span>pem<span class="w">
</span></code></pre></div><h3 id="step-3-activate-the-connection">Step 3: activate the connection</h3>
<p>Go through the stack and turn on switches for Interop:</p>
<ul>
<li><code>3-2-load-balancer</code>: set <code>InteropEnabled</code> to value other than <code>disabled</code></li>
<li><code>5-3a-ecs-is-service</code>: set <code>InteropEnabledIS</code> to the same value as previously <code>InteropEnabled</code></li>
<li><code>5-4-ecs-services</code>:
<ul>
<li>leave <code>InteropEnabledJS</code> as <code>disabled</code>, since you&rsquo;re setting up Identity Server, not Join Server interoperability</li>
<li>leave <code>CryptoServerDNSName</code> empty, as Crypto Server is not used by the Identity Server</li>
<li>set <code>InteropPacketBrokerEnabled</code> to a value relevant for your use case</li>
<li>set <code>InteropPacketBrokerTokenIssuer</code> to a value relevant for your use case</li>
</ul>
</li>
</ul>
        </div>
        
          <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/getting-started/aws/ecs/deployment/">← Deployment</a>
<a class="button is-pulled-right" href="/docs/getting-started/aws/ecs/troubleshooting/">Troubleshooting AWS ECS Deployment →</a>
</div>

          <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#tls-termination-by-the-aws-load-balancer'>TLS termination by the AWS Load Balancer</a></li>
    
      
      <li><a href='#tls-termination-by-the-things-stack'>TLS termination by The Things Stack</a></li>
    
      
      <li><a href='#deployment'>Deployment</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/ttn-network/v3/90">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Nejra Selimović on 23 Dec 2021.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/530b661ab3deed325cab8e675a402da28e5083ff">
      doc: Remove $ character from code blocks, add variables (#678)
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/getting-started/aws/ecs/interop/_index.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.79500656c3860a54b3b38e5f5770a5130bc57306ebb67ca9b057e494f6f4b454.js" integrity="sha256-eVAGVsOGClSzs45fV3ClEwvFcwbrtnypsFfklPb0tFQ=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
