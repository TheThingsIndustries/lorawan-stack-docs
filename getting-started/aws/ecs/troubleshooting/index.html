<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.96.0" />
  <title>Troubleshooting AWS ECS Deployment | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/troubleshooting/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.8afd1a9ba4c2f5b2a5910c50125ba2636f89937b2e7f5ca55766ed500a2a1e4f.css" integrity="sha256-iv0am6TC9bKlkQxQEluiY2&#43;Jk3suf1ylV2btUAoqHk8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Troubleshooting AWS ECS Deployment">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Troubleshooting AWS ECS Deployment">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/troubleshooting/">
  <meta name="twitter:title" content="Troubleshooting AWS ECS Deployment" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
</head>


<body><nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.23.2</p>
      </a><div class="navbar-item navbar-search-menu" id="search-input-menu">
          </div>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a>

      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://accounts.thethingsindustries.com/fee-calculator">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
  <script type="text/javascript">
    docsearch({
      appId: "608OILUBK2",
      apiKey: "39082cdce449b93b2aa806b44f6af4d2",
      indexName: "thethingsstack",
      container: '#search-input-menu',
      debug: false, 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Getting Started</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/getting-started/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/quick-start/" class="">Quick Start</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/what-is-tts/" class="">What Is The Things Stack?</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/console/" class="">Console</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/billing-and-subscription-management/" class="">Subscription and Billing Management</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/cli/" class="">Command-line Interface</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/installation/" class="">Installing The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/upgrading/" class="">Upgrading The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/" class="">Migrating to The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/cloud-hosted/" class="">The Things Stack Cloud</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/" class="">The Things Stack AWS Launcher</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ami/" class="">AWS Marketplace AMI</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/" class="">AWS ECS</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/architecture/" class="">Architecture</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/prerequisites/" class="">Prerequisites</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/deployment/" class="">Deployment</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/database-operations/" class="">Database Operations</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/monitoring/" class="">Monitoring</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/updating/" class="">Updating</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/best-practices/" class="">Best Practices</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/interop/" class="">Interoperability</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/mutual-tls/" class="">Mutual TLS</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/troubleshooting/" class="is-active">Troubleshooting AWS ECS Deployment</a>
    
    



    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/changelog/" class="">Template Changelog</a>
    
  </li>

</ul>


    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/ttn/" class="">The Things Network</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/server-addresses/" class="">Server Addresses</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/packet-broker/" class="">Packet Broker</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/sso/" class="">Single Sign-On</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/user-management/" class="">Users and Organizations</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/api/" class="">Using the API</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/events/" class="">Working with Events</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/troubleshooting/" class="">Troubleshooting Getting Started</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">Troubleshooting AWS ECS Deployment
          
        </h1>
        
        <div class="content">
          <p>This section contains information to troubleshoot The Things Stack deployment.</p>
<h2 id="ecs-pulled-wrong-image-version">ECS pulled wrong image version</h2>
<p>The image tags starting with <code>3.x</code> contain the latest patch version. For this reason, you should use images starting with <code>3.x.y</code>, where you specify the desired patch version yourself. Otherwise, when for some reason an ECS task restarts, it can pull the <code>3.x</code> image again, which could be in the meantime updated to a new patch version.</p>
<h2 id="identity-server-fails-with-errorpkgidentityserverstoredatabase-database-error">Identity Server fails with <code>error:pkg/identityserver/store:database (database error)</code></h2>
<p>This error is usually caused by a network failure. In this case, and in case of similar connection errors, we recommend:</p>
<ol>
<li>Restarting relevant ECS tasks</li>
<li>Waiting for all startup processes to complete, as sometimes certain elements might start in wrong order</li>
</ol>
<p>If this doesn&rsquo;t help, please start troubleshooting the network connection (for example, in this case between the Identity Server and the Aurora database).</p>
<h2 id="the-session-information-is-lost-for-all-devices-and-the-uplinks-are-dropped-by-the-network-server">The session information is lost for all devices, and the uplinks are dropped by the Network Server</h2>
<p>While intuitively ElastiCache seems to be just cache, in fact it is a fully capable database, and The Things Stack uses it as such. In particular, among other things, Network Server uses it for storing the session information for devices. If there is any issue with the Redis database, it causes loss of devices session data.</p>
<p>This is why, by default, we enable periodic backups. If you&rsquo;re experiencing data loss, restore the database from one of automatic snapshots, by entering the snapshot ID into relevant parameter in the Redis CloudFormation template.</p>
<h2 id="i-have-an-issue-with-certain-aws-resources">I have an issue with certain AWS resources</h2>
<p>It is assumed that customers who wish to deploy their own AWS ECS setup already have in-depth knowledge about AWS. We do not offer support on AWS itself. In order to receive best support from us, before reaching out please narrow down your issue to particular elements of The Things Stack. For help on AWS itself, please refer to:</p>
<p><a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/troubleshooting.html">https://docs.aws.amazon.com/AmazonECS/latest/developerguide/troubleshooting.html</a></p>
<h2 id="i-get-a-pkgscriptingjavascriptscript_timeout-script-timeout-error">I get a <code>pkg/scripting/javascript:script_timeout (script timeout)</code> error</h2>
<p>The current deadline for executing a Javascript payload decoder is 100 milliseconds. The payload decoder execution time increases in cases of high CPU usage and appearance of traffic bursts in The Things Stack deployment. If the process of decoding a payload exceeds the deadline, the payload decoder execution process is stopped and the uplink is sent with raw payload only.</p>
<p>This error can be resolved by doubling CPU and memory for the Application Server tasks.</p>

        </div>
        
          <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/getting-started/aws/ecs/mutual-tls/">← Mutual TLS</a>
<a class="button is-pulled-right" href="/docs/getting-started/aws/ecs/changelog/">Template Changelog →</a>
</div>

          <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#ecs-pulled-wrong-image-version'>ECS pulled wrong image version</a></li>
    
      
      <li><a href='#identity-server-fails-with-errorpkgidentityserverstoredatabase-database-error'>Identity Server fails with error:pkg/identityserver/store:database (database error)</a></li>
    
      
      <li><a href='#the-session-information-is-lost-for-all-devices-and-the-uplinks-are-dropped-by-the-network-server'>The session information is lost for all devices, and the uplinks are dropped by the Network Server</a></li>
    
      
      <li><a href='#i-have-an-issue-with-certain-aws-resources'>I have an issue with certain AWS resources</a></li>
    
      
      <li><a href='#i-get-a-pkgscriptingjavascriptscript_timeout-script-timeout-error'>I get a pkg/scripting/javascript:script_timeout (script timeout) error</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/ttn-network/v3/90">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Nejra Selimović on 20 Jul 2022.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/31b317e7de281e442fcfd7d81c6339e5149b2f35">
      doc: Add troubleshooting entry for AWS ECS (#917)
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/getting-started/aws/ecs/troubleshooting/_index.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.a32708c8796e7e8713fa926212adddbbf5c15cdd97676d898ecfc17bc6d9ed4f.js" integrity="sha256-oycIyHlufocT&#43;pJiEq3du/XBXN2XZ22Jjs/Be8bZ7U8=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
