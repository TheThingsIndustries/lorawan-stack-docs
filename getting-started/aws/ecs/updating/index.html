<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.96.0" />
  <title>Updating | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/updating/" />
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.74b07de880ad60ffdf0f356535e15d45e05de3df7f1c738e63521f7d8d731e53.css" integrity="sha256-dLB96ICtYP/fDzVlNeFdReBd499/HHOOY1IffY1zHlM=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Updating">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Updating">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/updating/">
  <meta name="twitter:title" content="Updating" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
</head>


<body><nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.19.2</p>
      </a><div class="navbar-item navbar-search-brand">
        <div class="field has-addons has-addons-centered">
          <div class="control">
            <input id="search-input-brand" class="input search-bar" type="text" placeholder="Search the docs..." type="text">
          </div>
        </div>
      </div>
      
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a><div class="navbar-item navbar-search-menu">
            <div class="field has-addons has-addons-centered">
              <div class="control">
                <input id="search-input-menu" class="input search-bar" type="text" placeholder="Search the docs..." type="text">
              </div>
            </div>
          </div></div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="https://accounts.thethingsindustries.com/fee-calculator">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript">
    docsearch({
      apiKey: "4372282a02970d8402d43457bf95d486",
      indexName: "thethingsstack",
      inputSelector: '#search-input-brand',
      debug: false 
    });
    docsearch({
      apiKey: "4372282a02970d8402d43457bf95d486",
      indexName: "thethingsstack",
      inputSelector: '#search-input-menu',
      debug: false 
    });
  </script><div class="container" role="document">
  <div class="columns my-0 ">
      
      <div class="column is-3 is-2-desktop sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Getting Started</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/getting-started/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/quick-start/" class="">Quick Start</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/what-is-tts/" class="">What Is The Things Stack?</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/console/" class="">Console</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/cli/" class="">Command-line Interface</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/installation/" class="">Installing The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/upgrading/" class="">Upgrading The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/" class="">Migrating to The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/cloud-hosted/" class="">The Things Stack Cloud</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/" class="">The Things Stack AWS Launcher</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ami/" class="">AWS Marketplace AMI</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/" class="">AWS ECS</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/architecture/" class="">Architecture</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/prerequisites/" class="">Prerequisites</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/deployment/" class="">Deployment</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/database-operations/" class="">Database Operations</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/monitoring/" class="">Monitoring</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/updating/" class="is-active">Updating</a>
    
    



    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/best-practices/" class="">Best Practices</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/interop/" class="">Interoperability</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/troubleshooting/" class="">Troubleshooting AWS ECS Deployment</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/changelog/" class="">Template Changelog</a>
    
  </li>

</ul>


    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/ttn/" class="">The Things Network</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/server-addresses/" class="">Server Addresses</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/packet-broker/" class="">Packet Broker</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/sso/" class="">Single Sign-On</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/user-management/" class="">Users and Organizations</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/api/" class="">Using the API</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/events/" class="">Working with Events</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/troubleshooting/" class="">Troubleshooting Getting Started</a>
  </li>
</ul>



</nav>








      </div>
      
      <div class="column is-9 is-8-desktop sidebar-middle">
        <div class="docs-content">
        <h1 class="title is-size-2">Updating
          
        </h1>
        
        <div class="content">
          <p>This page describes the steps for updating The Things Stack on AWS ECS.</p>
<p>From AWS&rsquo; point of view, updating The Things Stack implies three operations described in the subsections below.</p>
<h2 id="updating-cloudformation-stacks">Updating CloudFormation Stacks</h2>
<p>Updating CloudFormation stacks can be done via the AWS console, using the <strong>Create changeset</strong> functionality. All stacks need to be updated in their numbering order. For example, a stack using template <code>1-1-vpc</code> needs to be updated before <code>1-2-bastion</code>, which needs to be updated before <code>2-1-db-aurora-master</code>.</p>
<p>Not all stacks require a replacement in each version update.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  Please refer to <a href="https://thethingsindustries.s3.amazonaws.com/public/cloud/3.x/UPGRADING.md">https://thethingsindustries.s3.amazonaws.com/public/cloud/3.x/UPGRADING.md</a> (replace <code>3.x</code> with the current minor version), which contains per-version changes in templates. Only templates mentioned in that file have changed in given version. Moreover use that file as a general guideline what changes to expect.
</div>

<p>Make sure deployed templates correspond to your The Things Stack version. When updating, pay extra attention to:</p>
<ul>
<li>new parameters</li>
<li>removed parameters</li>
<li>parameters with changed possible values</li>
</ul>
<p>as default parameters might not be valid in context of your deployment.</p>
<p>There are two templates that have a non-standard update procedure:</p>
<h3 id="2-5-db-timescale"><code>2-5-db-timescale</code></h3>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  As AMI, we use the newest Amazon Linux 2 image. This means that AMI ID is most likely going to change between two consecutive releases of The Things Stack, and upon update AWS will try to replace the EC2 machine. If there are no notes in <code>UPGRADING.md</code> and new template differs only by AMI ID, consider simply upgrading the software on the machine instead of updating this particular stack via CloudFormation, especially prior to version 3.15.0. Always remember to backup your data before update.
</div>

<h4 id="updating-before-version-3150">Updating before version 3.15.0</h4>
<p>If you&rsquo;re updating to a version lower than 3.15.0, simple CloudFormation update will fail because CloudFormation doesn&rsquo;t propely remount EBS volumes. It is advised that you skip this template, or inspect and apply relevant changes manually.</p>
<h4 id="updating-to-3150-or-higher">Updating to 3.15.0 or higher</h4>
<p>In version 3.15.0 the <code>2-5-db-timescale</code> template has been reworked to allow smoother update.</p>
<h5 id="updating-from-version-lower-than-3150">Updating from version lower than 3.15.0</h5>
<p>It is strongly advised to backup your data before performing this update.</p>
<ol>
<li>Before update, set the <code>ApplicationServerStorageEnabled</code> parameter in <code>5-2-ecs-ops</code> and <code>5-4-ecs-services</code> to <code>false</code>. This will turn off storage integration.</li>
<li>Terminate the EC2 machine hosting TimescaleDB.</li>
<li>Update the <code>2-5-db-timescale</code> template. Make sure that there are no changes to <code>Volume</code> (potential data loss). If you can&rsquo;t avoid updating <code>Volume</code>, make a snapshot and then use the <code>VolumeSnapshotID</code> parameter to recreate the volume from a snapshot.</li>
<li>Continue with the update as normal. When you reach <code>5-2-ecs-ops</code> and <code>5-4-ecs-services</code>, set <code>ApplicationServerStorageEnabled</code> parameter back to <code>true</code>.</li>
</ol>
<h5 id="updating-from-version-3150-or-higher">Updating from version 3.15.0 or higher</h5>
<p>You can update the template as any other. Make sure that the Change Set doesn&rsquo;t contain any changes to <code>Volume</code>, or you might experience data loss.</p>
<p>Storage integration may report failures for a brief moment before new EC2 machine starts up (about two minutes) and Application Server picks up new DNS entry (TTL one minute).</p>
<h3 id="5-1-ecs-cluster"><code>5-1-ecs-cluster</code></h3>
<p>In this template we use an autoscaling group. Updates to <code>LaunchConfiguration</code> do not cause any effect on already running machines that were created using said <code>LaunchConfiguration</code>. This means that if this template contains changes, e.g. different <code>UserData</code> or an updated AMI image, you should examine changes and apply them manually.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  Make sure to remember that both <code>5-1-ecs-cluster</code> and <code>2-5-db-timescale</code> use standard Amazon Linux 2 images. This should make it easy to decide whether you actually need to update the machines, and if yes, how exactly. There is no non-standard software on these machines beyond what&rsquo;s in the <code>UserData</code> section of respective template, therefore you can follow standard update procedures.
</div>

<h2 id="changing-docker-images">Changing Docker Images</h2>
<p>Templates <code>5-x</code> create ECS services, and they use Docker images. For this reason, when updating <code>5-x</code> stacks, do not forget to change used Docker images to newer ones. Since <code>5-x</code> stacks have images as parameters, do not forget to update them, even if they are not mentioned in <code>UPGRADING.md</code>.</p>
<p>Please go through <a href="https://www.thethingsindustries.com/docs/whats-new/">Release Notes</a> to get familiar with changes between the versions you&rsquo;re updating from and to, including changes introduced in the in-between releases.</p>
<h2 id="migrations">Migrations</h2>
<p>When updating The Things Stack to a newer version, the <a href="https://www.thethingsindustries.com/docs/whats-new/">Release Notes</a> might mention that a migration is needed. When updating an ECS-deployed The Things Stack, the right moment to perform these migrations is right after updating <code>5-2-ecs-ops</code> stack. You might need to perform these migrations:</p>
<ul>
<li><code>is-db</code></li>
<li><code>dcs-db</code></li>
<li><code>ns-db</code></li>
<li><code>as-db</code></li>
<li><code>storage-db</code></li>
</ul>
<p>Migrations are performed using <code>migrate</code> commands. Those can be run similarly to <code>init</code> commands during initial deployment.</p>
<blockquote>
<p>See <a href="/docs/getting-started/aws/ecs/database-operations/">Database Operations</a> for detailed info about migrations.</p>
</blockquote>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  When updating from a version that is more than one minor behind your target version you need to perform all migrations mentioned in release notes between your current and target version. If a migration is mentioned more than one time, then you only need to apply it once, using the target version image.
</div>
        </div>
        
          <div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/getting-started/aws/ecs/monitoring/">← Monitoring</a>
<a class="button is-pulled-right" href="/docs/getting-started/aws/ecs/best-practices/">Best Practices →</a>
</div>

          <script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
        </div>
      </div>
      
      <div class="column is-hidden-touch is-2-desktop sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#updating-cloudformation-stacks'>Updating CloudFormation Stacks</a></li>
    
      
      <li><a href='#changing-docker-images'>Changing Docker Images</a></li>
    
      
      <li><a href='#migrations'>Migrations</a></li>
    
  </ul>


  </nav>

      </div>
      
  </div>
</div>



<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/ttn-network/v3/90">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Michał Borkowski on 29 Mar 2022.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/b184fc0846cb56292d397640e37df47cfc73e030">
      doc: Add note about migrations (#823)
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/getting-started/aws/ecs/updating/_index.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.a32708c8796e7e8713fa926212adddbbf5c15cdd97676d898ecfc17bc6d9ed4f.js" integrity="sha256-oycIyHlufocT&#43;pJiEq3du/XBXN2XZ22Jjs/Be8bZ7U8=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
