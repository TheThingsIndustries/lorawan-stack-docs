<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.70.0" />
  <title>Certificates | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/getting-started/installation/certificates/" />
  <link rel="alternate icon" href="/docs/favicon.ico">
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.cf9447944fbcc7bdf6a5140d8d9c5c7c741f08af5d17e0b1c3bd26da8cd08507.css" integrity="sha256-z5RHlE&#43;8x732pRQNjZxcfHQfCK9dF&#43;Cxw70m2ozQhQc=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Certificates">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Certificates">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/getting-started/installation/certificates/">
  <meta name="twitter:title" content="Certificates" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
</head>
<body><nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.13</p>
      </a>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a>
      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="/docs/download/">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav>
<section class="search-container">
    <div class="container">
      <div class="columns is-vcentered">
        <div class="column">
          <div class="field has-addons has-addons-centered">
            <div class="control">
              <input class="input search-bar" id="search-input" type="text" placeholder="Search" type="text">
            </div>
          </div>
        </div>
      </div>
    </div>
</section>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
apiKey: "4372282a02970d8402d43457bf95d486",
indexName: "thethingsstack",
inputSelector: '#search-input',
debug: false 
});
</script>
<div class="container" role="document">
  <div class="columns my-0">
      <div class="column is-one-fifth-tablet is-one-third sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Getting Started</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/getting-started/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/quick-start/" class="">Quick Start</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/what-is-tts/" class="">What Is The Things Stack?</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/cli/" class="">Command-line Interface</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/console/" class="">Console</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/installation/" class="">Installing The Things Stack</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/installation/configuration/" class="">Configuration</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/installation/certificates/" class="is-active">Certificates</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/installation/running-the-stack/" class="">Running The Things Stack</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/installation/troubleshooting/" class="">Troubleshooting Installation</a>
    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/" class="">Migrating to The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/ttn/" class="">The Things Network</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/" class="">The Things Stack AWS Launcher</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/cloud-hosted/" class="">The Things Stack Cloud</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/troubleshooting/" class="">Troubleshooting Getting Started</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/upgrading/" class="">Upgrading The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/user-management/" class="">Users and Organizations</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/api/" class="">Using the API</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/events/" class="">Working with Events</a>
  </li>
</ul>



</nav>








      </div>
      <div class="column sidebar-middle">

<div class="docs-content">
<h1 class="title is-size-2">Certificates
  
  
  
  
</h1>

<div class="content">
  <p>The Things Stack needs to be configured with Transport Layer Security (TLS) and HTTPS. This requires a TLS certificate and a corresponding key.</p>
<p>In this guide, we show you how to request a free, trusted certificate from <a href="https://letsencrypt.org/getting-started/">Let&rsquo;s Encrypt</a>, but if you already have a certificate (<code>cert.pem</code>) and a corresponding key (<code>key.pem</code>), you can also use those. For local deployments, you can set up your own Certificate Authority and issue a certificate-key pair.</p>
<h2 id="automatic-certificate-management">Automatic Certificate Management</h2>
<p>The Things Stack can be configured to automatically retrieve and update Let&rsquo;s Encrypt certificates. Assuming you followed the <a href="/docs/getting-started/installation/configuration/">configuration</a> steps, create an <code>acme</code> directory where The Things Stack can store the certificate data:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ mkdir ./acme
$ sudo chown 886:886 ./acme
</code></pre></div><div class="notification is-warning is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Warning:</h5>
  <code>886</code> is the <code>UID</code> and the <code>GID</code> of the user that runs The Things Stack in the Docker container. If you don&rsquo;t set these permissions, you may encounter an error resembling <code>open /var/lib/acme/acme_account+key&lt;...&gt;: permission denied</code>.
</div>

<p>The directory hierarchy should look like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">acme/
docker-compose.yml          <span class="c1"># defines Docker services for running The Things Stack</span>
config/
└── stack/
    └── ttn-lw-stack-docker.yml    <span class="c1"># configuration file for The Things Stack</span>
</code></pre></div><p>Certificates will automatically be requested the first time you access The Things Stack. You will notice that the page takes some time to load while certificates are obtained in the background.</p>
<h3 id="using-custom-certificates">Using Custom Certificates</h3>
<p>To use <a href="#certificates-from-a-certificate-authority">CA certificates you already have</a> or <a href="#custom-certificate-authority">self-signed certificates</a>, you will need to uncomment the custom certificates section of <code>docker-compose.yml</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="c"># If using custom certificates:</span><span class="w">
</span><span class="w">    </span><span class="k">secrets</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- ca.pem<span class="w">
</span><span class="w">      </span>- cert.pem<span class="w">
</span><span class="w">      </span>- key.pem<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># If using custom certificates:</span><span class="w">
</span><span class="w"></span><span class="k">secrets</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">ca.pem</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">file</span><span class="p">:</span><span class="w"> </span>./ca.pem<span class="w">
</span><span class="w">  </span><span class="k">cert.pem</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">file</span><span class="p">:</span><span class="w"> </span>./cert.pem<span class="w">
</span><span class="w">  </span><span class="k">key.pem</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">file</span><span class="p">:</span><span class="w"> </span>./key.pem</code></pre></td></tr></table>
</div>
</div>
<p>You will also need to comment out the Let&rsquo;s Encrypt section of <code>ttn-lw-stack-docker.yml</code>, and uncomment the custom certificates section:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># If using custom certificates:</span><span class="w">
</span><span class="w"></span><span class="k">tls</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">source</span><span class="p">:</span><span class="w"> </span>file<span class="w">
</span><span class="w">  </span><span class="k">root-ca</span><span class="p">:</span><span class="w"> </span>/run/secrets/ca.pem<span class="w">
</span><span class="w">  </span><span class="k">certificate</span><span class="p">:</span><span class="w"> </span>/run/secrets/cert.pem<span class="w">
</span><span class="w">  </span><span class="k">key</span><span class="p">:</span><span class="w"> </span>/run/secrets/key.pem<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># Let&#39;s encrypt for &#34;thethings.example.com&#34;</span><span class="w">
</span><span class="w"></span><span class="c"># tls:</span><span class="w">
</span><span class="w"></span><span class="c">#   source: &#39;acme&#39;</span><span class="w">
</span><span class="w"></span><span class="c">#   acme:</span><span class="w">
</span><span class="w"></span><span class="c">#     dir: &#39;/var/lib/acme&#39;</span><span class="w">
</span><span class="w"></span><span class="c">#     email: &#39;you@thethings.example.com&#39;</span><span class="w">
</span><span class="w"></span><span class="c">#     hosts: [&#39;thethings.example.com&#39;]</span><span class="w">
</span><span class="w"></span><span class="c">#     default-host: &#39;thethings.example.com&#39;</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="certificates-from-a-certificate-authority">Certificates from a Certificate Authority</h3>
<p>If you want to use the certificate (<code>cert.pem</code>) and key (<code>key.pem</code>) that you already have, you also need to set these permissions.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ sudo chown 886:886 ./cert.pem ./key.pem
</code></pre></div><div class="notification is-warning is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Warning:</h5>
  If you don&rsquo;t set these permissions, you may encounter an error resembling <code>/run/secrets/key.pem: permission denied</code>.
</div>

<p>The directory hierarchy should look like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">cert.pem
key.pem
docker-compose.yml          <span class="c1"># defines Docker services for running The Things Stack</span>
config/
└── stack/
    └── ttn-lw-stack-docker.yml    <span class="c1"># configuration file for The Things Stack</span>
</code></pre></div><p>Be sure to configure <code>docker-compose.yml</code> and <code>ttn-lw-stack-docker.yml</code> for your custom certificates, as shown in <a href="#using-custom-certificates">using custom certificates</a>.</p>
<h2 id="custom-certificate-authority">Custom Certificate Authority</h2>
<p>To use TLS on a local or offline deployment, you can use your own Certificate Authority. In order to set that up, you can use <code>cfssl</code>, CloudFlare&rsquo;s PKI/TLS toolkit. The <code>cfssl</code> installation instructions can be found <a href="https://github.com/cloudflare/cfssl#installation">here</a>.</p>
<p>Write the configuration for your CA to <code>ca.json</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;names&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="nt">&#34;C&#34;</span><span class="p">:</span> <span class="s2">&#34;NL&#34;</span><span class="p">,</span> <span class="nt">&#34;ST&#34;</span><span class="p">:</span> <span class="s2">&#34;Noord-Holland&#34;</span><span class="p">,</span> <span class="nt">&#34;L&#34;</span><span class="p">:</span> <span class="s2">&#34;Amsterdam&#34;</span><span class="p">,</span> <span class="nt">&#34;O&#34;</span><span class="p">:</span> <span class="s2">&#34;The Things Demo&#34;</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div><p>Then use the following command to generate the CA key and certificate:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ cfssl genkey -initca ca.json <span class="p">|</span> cfssljson -bare ca
</code></pre></div><p>Now write the configuration for your certificate to <code>cert.json</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;hosts&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;thethings.example.com&#34;</span><span class="p">],</span>
  <span class="nt">&#34;names&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="nt">&#34;C&#34;</span><span class="p">:</span> <span class="s2">&#34;NL&#34;</span><span class="p">,</span> <span class="nt">&#34;ST&#34;</span><span class="p">:</span> <span class="s2">&#34;Noord-Holland&#34;</span><span class="p">,</span> <span class="nt">&#34;L&#34;</span><span class="p">:</span> <span class="s2">&#34;Amsterdam&#34;</span><span class="p">,</span> <span class="nt">&#34;O&#34;</span><span class="p">:</span> <span class="s2">&#34;The Things Demo&#34;</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div><div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  Remember to replace <code>thethings.example.com</code> with your server address!
</div>

<p>Then, run the following command to generate the server key and certificate:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ cfssl gencert -ca ca.pem -ca-key ca-key.pem cert.json <span class="p">|</span> cfssljson -bare cert
</code></pre></div><p>The next steps assume the certificate key is called <code>key.pem</code>, so you&rsquo;ll need to rename <code>cert-key.pem</code> to <code>key.pem</code>.</p>
<p>At the end, your directory should look like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">cert.pem
key.pem
ca.pem
docker-compose.yml          <span class="c1"># defines Docker services for running The Things Stack</span>
config/
└── stack/
    └── ttn-lw-stack-docker.yml    <span class="c1"># configuration file for The Things Stack</span>
</code></pre></div><p>Be sure to configure <code>docker-compose.yml</code> and <code>ttn-lw-stack-docker.yml</code> for your custom certificates, as shown in <a href="#using-custom-certificates">using custom certificates</a>.</p>
</div>
<div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/getting-started/installation/configuration/">← Configuration</a>
<a class="button is-pulled-right" href="/docs/getting-started/installation/running-the-stack/">Running The Things Stack →</a>
</div>

<script>window.emojicom_widget = { campaign: "NEDHszRC2r2KaGj1mhj7" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
</div>


      </div>
      <div class="column is-hidden-touch is-one-quarter is-one-fifth-widescreen sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#automatic-certificate-management'>Automatic Certificate Management</a></li>
    
      
      <li><a href='#custom-certificate-authority'>Custom Certificate Authority</a></li>
    
  </ul>


  </nav>

      </div>
  </div>
</div>


<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/network-and-routing/v3">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Ben Olayinka on 22 Mar 2021.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/98e1435432f82ed8cb2d237cea436ba2d05a925a">
      doc: Add ACME localhost note and improve certs docs
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/getting-started/installation/certificates.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.af1cdce2271a42369c7c022fb683df665bf882e1fdc766a89a6ee99196bc4f9e.js" integrity="sha256-rxzc4icaQjacfAIvtoPfZlv4guH9x2aomm7pkZa8T54=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "pp8esr7h",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pp8esr7h';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
